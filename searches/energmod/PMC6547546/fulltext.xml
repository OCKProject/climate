<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Archiving and Interchange DTD v1.2 20190208//EN" "JATS-archivearticle1.dtd"> 
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article"><?properties open_access?><?DTDIdentifier.IdentifierValue -//Springer-Verlag//DTD A++ V2.4//EN?><?DTDIdentifier.IdentifierType public?><?SourceDTD.DTDName A++V2.4.dtd?><?SourceDTD.Version 2.4?><?ConverterInfo.XSLTName springer2nlmx2.xsl?><?ConverterInfo.Version 1?><front><journal-meta><journal-id journal-id-type="nlm-ta">J Neuroeng Rehabil</journal-id><journal-id journal-id-type="iso-abbrev">J Neuroeng Rehabil</journal-id><journal-title-group><journal-title>Journal of NeuroEngineering and Rehabilitation</journal-title></journal-title-group><issn pub-type="epub">1743-0003</issn><publisher><publisher-name>BioMed Central</publisher-name><publisher-loc>London</publisher-loc></publisher></journal-meta><article-meta><article-id pub-id-type="pmcid">6547546</article-id><article-id pub-id-type="publisher-id">526</article-id><article-id pub-id-type="doi">10.1186/s12984-019-0526-8</article-id><article-categories><subj-group subj-group-type="heading"><subject>Research</subject></subj-group></article-categories><title-group><article-title>Model-based control for exoskeletons with series elastic actuators evaluated on sit-to-stand movements</article-title></title-group><contrib-group><contrib contrib-type="author" corresp="yes"><contrib-id contrib-id-type="orcid">http://orcid.org/0000-0001-9539-6236</contrib-id><name><surname>Vantilt</surname><given-names>Jonas</given-names></name><address><email>jonas.vantilt@kuleuven.be</email></address><xref ref-type="aff" rid="Aff1">1</xref><xref ref-type="aff" rid="Aff4">4</xref></contrib><contrib contrib-type="author"><name><surname>Tanghe</surname><given-names>Kevin</given-names></name><address><email>kevin.tanghe@kuleuven.be</email></address><xref ref-type="aff" rid="Aff1">1</xref></contrib><contrib contrib-type="author"><name><surname>Afschrift</surname><given-names>Maarten</given-names></name><address><email>maarten.afschrift@kuleuven.be</email></address><xref ref-type="aff" rid="Aff2">2</xref><xref ref-type="aff" rid="Aff4">4</xref></contrib><contrib contrib-type="author"><name><surname>Bruijnes</surname><given-names>Amber K.B.D</given-names></name><address><email>amber.bruijnes@kuleuven.be</email></address><xref ref-type="aff" rid="Aff2">2</xref></contrib><contrib contrib-type="author"><name><surname>Junius</surname><given-names>Karen</given-names></name><address><email>kjunius@vub.ac.be</email></address><xref ref-type="aff" rid="Aff3">3</xref></contrib><contrib contrib-type="author"><name><surname>Geeroms</surname><given-names>Joost</given-names></name><address><email>joost.geeroms@vub.ac.be</email></address><xref ref-type="aff" rid="Aff3">3</xref></contrib><contrib contrib-type="author"><name><surname>Aertbeli&#x000eb;n</surname><given-names>Erwin</given-names></name><address><email>erwin.aertbelien@kuleuven.be</email></address><xref ref-type="aff" rid="Aff1">1</xref></contrib><contrib contrib-type="author"><name><surname>De Groote</surname><given-names>Friedl</given-names></name><address><email>friedl.degroote@kuleuven.be</email></address><xref ref-type="aff" rid="Aff2">2</xref></contrib><contrib contrib-type="author"><name><surname>Lefeber</surname><given-names>Dirk</given-names></name><address><email>dlefber@vub.ac.be</email></address><xref ref-type="aff" rid="Aff3">3</xref></contrib><contrib contrib-type="author"><name><surname>Jonkers</surname><given-names>Ilse</given-names></name><address><email>ilse.jonkers@kuleuven.be</email></address><xref ref-type="aff" rid="Aff2">2</xref></contrib><contrib contrib-type="author"><name><surname>De Schutter</surname><given-names>Joris</given-names></name><address><email>joris.deschutter@kuleuven.be</email></address><xref ref-type="aff" rid="Aff1">1</xref></contrib><aff id="Aff1"><label>1</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 0668 7884</institution-id><institution-id institution-id-type="GRID">grid.5596.f</institution-id><institution>the Robotics Research Group, the Department of Mechanical Engineering, KU Leuven, </institution></institution-wrap>Celestijnenlaan 300, Leuven, Belgium </aff><aff id="Aff2"><label>2</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 0668 7884</institution-id><institution-id institution-id-type="GRID">grid.5596.f</institution-id><institution>Department of Kinesiology, KU Leuven, </institution></institution-wrap>Tervuursevest 101, Leuven, Belgium </aff><aff id="Aff3"><label>3</label><institution-wrap><institution-id institution-id-type="ISNI">0000 0001 2290 8069</institution-id><institution-id institution-id-type="GRID">grid.8767.e</institution-id><institution>Robotics and Multibody Mechanics Research Group, Department of Mechanical Engineering, VUB, </institution></institution-wrap>Pleinlaan 2, Brussels, Belgium </aff><aff id="Aff4"><label>4</label><institution-wrap><institution-id institution-id-type="GRID">grid.434127.7</institution-id><institution>Flanders Make, </institution></institution-wrap>Lommel 3920, Belgium </aff></contrib-group><pub-date pub-type="epub"><day>3</day><month>6</month><year>2019</year></pub-date><pub-date pub-type="pmc-release"><day>3</day><month>6</month><year>2019</year></pub-date><pub-date pub-type="collection"><year>2019</year></pub-date><volume>16</volume><elocation-id>65</elocation-id><history><date date-type="received"><day>24</day><month>1</month><year>2018</year></date><date date-type="accepted"><day>29</day><month>4</month><year>2019</year></date></history><permissions><copyright-statement>&#x000a9; The Author(s) 2019</copyright-statement><license license-type="OpenAccess"><license-p><bold>Open Access</bold> This article is distributed under the terms of the Creative Commons Attribution 4.0 International License(<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/">http://creativecommons.org/licenses/by/4.0/</ext-link>), which permits unrestricted use, distribution, and reproduction in any medium, provided you give appropriate credit to the original author(s) and the source, provide a link to the Creative Commons license, and indicate if changes were made. The Creative Commons Public Domain Dedication waiver(<ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/publicdomain/zero/1.0/">http://creativecommons.org/publicdomain/zero/1.0/</ext-link>) applies to the data made available in this article, unless otherwise stated.</license-p></license></permissions><abstract id="Abs1"><sec><title>Background</title><p>Currently, control of exoskeletons in rehabilitation focuses on imposing desired trajectories to promote relearning of motions. Furthermore, assistance is often provided by imposing these desired trajectories using impedance controllers. However, lower-limb exoskeletons are also a promising solution for mobility problems of individuals in daily life. To develop an assistive exoskeleton which allows the user to be autonomous, i.e. in control of his motions, remains a challenge. This paper presents a model-based control method to tackle this challenge.</p></sec><sec><title>Methods</title><p>The model-based control method utilizes a dynamic model of the exoskeleton to compensate for its own dynamics. After this compensation of the exoskeleton dynamics, the exoskeleton can provide a desired assistance to the user. While dynamic models of exoskeletons used in the literature focus on gravity compensation only, the need for modelling and monitoring of the ground contact impedes their widespread use. The control strategy proposed here relies on modelling of the full exoskeleton dynamics and of the contacts with the environment. A modelling strategy and general control scheme are introduced.</p></sec><sec><title>Results</title><p>Validation of the control method on 15 non-disabled adults performing sit-to-stand motions shows that muscle effort and joint torques are similar in the conditions with dynamically compensated exoskeleton and without exoskeleton. The condition with exoskeleton in which the compensating controller was not active showed a significant increase in human joint torques and muscle effort at the knee and hip. Motor saturation occurred during the assisted condition, which limited the assistance the exoskeleton could deliver.</p></sec><sec><title>Conclusions</title><p>This work presents the modelling steps and controller design to compensate the exoskeleton dynamics. The validation seems to indicate that the presented model-based controller is able to compensate the exoskeleton.</p></sec></abstract><kwd-group xml:lang="en"><title>Keywords</title><kwd>Model-based control</kwd><kwd>Exoskeleton</kwd><kwd>Sit-to-stand</kwd><kwd>Assistive robots</kwd><kwd>Series elastic actuator</kwd><kwd>Paraplegia</kwd><kwd>Muscle weakness</kwd></kwd-group><funding-group><award-group><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100003132</institution-id><institution>Agentschap voor Innovatie door Wetenschap en Technologie</institution></institution-wrap></funding-source><award-id>IWT-SBO 131381</award-id></award-group></funding-group><funding-group><award-group><funding-source><institution>Agentschap voor Innovatie door Wetenschap en Technologie (BE)</institution></funding-source><award-id>IWT-SBO</award-id></award-group></funding-group><funding-group><award-group><funding-source><institution>Agentschap voor Innovatie door Wetenschap en Technologie (BE)</institution></funding-source><award-id>MIRAD, IWT-SBO 120057</award-id></award-group></funding-group><funding-group><award-group><funding-source><institution-wrap><institution-id institution-id-type="FundRef">http://dx.doi.org/10.13039/501100003130</institution-id><institution>Fonds Wetenschappelijk Onderzoek</institution></institution-wrap></funding-source><award-id>11Z1815N</award-id></award-group></funding-group><custom-meta-group><custom-meta><meta-name>issue-copyright-statement</meta-name><meta-value>&#x000a9; The Author(s) 2019</meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="Sec1"><title>Background</title><p>Performing activities of daily living (ADL) is a challenge for people affected by muscle weakness or neurologic disorders, like paraplegia. Crutches and wheelchairs provide help to perform ADL. However, these devices do not encourage the normal use of muscles and they lead to disuse and further deterioration of lower-limb muscle function for ADL. In contrast, assistive lower-limb robots have the potential to support ADL and to encourage active participation of the user, making them valuable additions to or replacements of wheelchairs and crutches. To narrow the focus, this paper looks at assistive devices that are not stationary, i.e. fixed to the ground, and therefore allow overground walking. To achieve this, these devices need to be compact, lightweight and need to have energy autonomy. These requirements have a large impact on both design and control decisions. Assistive robots allowing overground walking, worn on the lower limbs and covering all joints are referred to as exoskeletons in this paper. The term actuated orthoses on the other hand refers to assistive robots that span only one or two joints in this paper.</p><p>Young and Ferris [<xref ref-type="bibr" rid="CR1">1</xref>] point out the variety in control methods and the absence of convergence towards one or a class of controller methods. The variety in control strategies in assistive robotics is further backed up by the review work of Yan et al. [<xref ref-type="bibr" rid="CR2">2</xref>]. They classify six groups of assistive controllers of which predefined trajectory and model-based control strategies are the most common. Predefined trajectory controllers are often used for gait trainers and exoskeletons for complete paraplegic persons. These predefined trajectories are enforced with position or impedance control [<xref ref-type="bibr" rid="CR3">3</xref>, <xref ref-type="bibr" rid="CR4">4</xref>]. For example, devices for spinal cord injuries move the user&#x02019;s limbs according to these predefined trajectories. In rehabilitation robotics, the enforced trajectories train muscle strength and coordination [<xref ref-type="bibr" rid="CR5">5</xref>&#x02013;<xref ref-type="bibr" rid="CR8">8</xref>]. Here, the impedance controller is widely used: the more the subject deviates from the desired trajectory, the more assistance the rehabilitation device delivers to guide the user back to the desired trajectory, which increases user involvement during training [<xref ref-type="bibr" rid="CR9">9</xref>, <xref ref-type="bibr" rid="CR10">10</xref>]. In contrast, enforcing a trajectory with an impedance controller is undesirable in an exoskeleton supporting voluntary capabilities.</p><p>Our work focusses on exoskeletons that assist the voluntary capabilities of people suffering from mild forms of paraplegia or muscle weakness. Enforcing a trajectory with an impedance controller is undesirable in such exoskeletons [<xref ref-type="bibr" rid="CR1">1</xref>], because these exoskeletons need to keep the user in charge of the motion. Model-based control strategies, as described by Yan et al. [<xref ref-type="bibr" rid="CR2">2</xref>], are more appropriate for exoskeletons assisting the voluntary capabilities of the user. These methods rely on human-exoskeleton models and can often compensate gravity, determine the assistance and even incorporate balance criteria. Also controllers utilizing the muscle activity [<xref ref-type="bibr" rid="CR11">11</xref>, <xref ref-type="bibr" rid="CR12">12</xref>] are classified as model-based controller in the work of Yan et al. [<xref ref-type="bibr" rid="CR2">2</xref>]. In this paper, model-based control relies on physical models of the dynamics and contacts of the system (exoskeleton and human) to determine the actuation from the motors. In many cases, such controllers only use exoskeleton gravity compensation [<xref ref-type="bibr" rid="CR8">8</xref>, <xref ref-type="bibr" rid="CR10">10</xref>], even though the influence of the dynamics cannot be ignored [<xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR14">14</xref>]. Only a few controllers compensate the complete exoskeleton dynamics [<xref ref-type="bibr" rid="CR14">14</xref>, <xref ref-type="bibr" rid="CR15">15</xref>], as this requires a full dynamic model of the exoskeleton. The output of these model-based controllers are the torque needed at each joint.</p><p>The widely used Series Elastic Actuators (SEA) [<xref ref-type="bibr" rid="CR6">6</xref>, <xref ref-type="bibr" rid="CR7">7</xref>, <xref ref-type="bibr" rid="CR13">13</xref>] facilitates torque control in exoskeletons. This type of actuator has a spring(like) element in series with the actuator. By measuring the extension and impression of the springs, the SEAs transform the torque/force control problem to a position control problem using their compliance. This facilitates a torque-based control strategy [<xref ref-type="bibr" rid="CR16">16</xref>&#x02013;<xref ref-type="bibr" rid="CR18">18</xref>]. In addition, these actuators increase user safety and comfort, which is important in applications directly involving human interaction. The spring acts as a buffer for impact and reduces the actuator inertia felt by the user. An added advantage is that the springs are able to store energy. Although SEAs are unable to lock this stored energy, they do allow to reduce peak motor power when designed properly [<xref ref-type="bibr" rid="CR19">19</xref>]. These advantages of SEAs come at a cost in the form of a reduced positioning bandwidth and an increased number of mechanical parts, which may increase the overall weight.</p><p>When exoskeletons or orthoses already have low mass and inertia by design, compensating them is less crucial to achieve beneficial results. Only a few ankle orthoses have shown to be effective, as evidenced by a reduced metabolic cost for walking or running [<xref ref-type="bibr" rid="CR20">20</xref>&#x02013;<xref ref-type="bibr" rid="CR22">22</xref>]. All these orthoses have low mass and rotational inertia, either by putting the motors on a separate control station [<xref ref-type="bibr" rid="CR20">20</xref>, <xref ref-type="bibr" rid="CR21">21</xref>] or because they have no motors at all [<xref ref-type="bibr" rid="CR22">22</xref>]. However, for complete exoskeletons, which need to carry their own batteries and actuators, the mass and rotational inertia is much higher, requiring a substantial part of the actuators capabilities. If the exoskeleton dynamics are not compensated for by the controller, the effective assistance provided to the user is reduced.</p><p>In contrast to the different control strategies in assistive robotics [<xref ref-type="bibr" rid="CR2">2</xref>], in humanoid robotics, a model-based control strategy that accounts for the full robot dynamics is common practice [<xref ref-type="bibr" rid="CR23">23</xref>&#x02013;<xref ref-type="bibr" rid="CR25">25</xref>]. Additionally, these models can also estimate ground reaction forces [<xref ref-type="bibr" rid="CR26">26</xref>, <xref ref-type="bibr" rid="CR27">27</xref>], needed as input to the dynamics models. In order to achieve model-based control, humanoid robots are almost always torque-controlled, often using force cells. The fundamental difference between humanoid robots and exoskeletons is the presence of the human, which greatly impacts design and control. The weight and size limits for exoskeletons result in actuators which operate close to their limits. On top of that, the human contributes to the actuation, possibly affecting stability. Furthermore, the exoskeleton needs to adapt itself to the motions of the human operator and their execution speed.</p><p>The similarity between humanoid robots and exoskeletons provides a motivation to also move towards model-based control in exoskeletons. The work of Yan et al. [<xref ref-type="bibr" rid="CR2">2</xref>] contains different types of models that are used in a variety of ways. This makes a comparison between controllers difficult [<xref ref-type="bibr" rid="CR1">1</xref>]. Irrespective of the used assistive control strategy [<xref ref-type="bibr" rid="CR2">2</xref>], the device attached to the person also consumes part of the actuation. If this is not compensated for, the provided assistance is affected. A model-based control strategy can compensate these actuation needed by the exoskeleton dynamics. In this way, the exoskeleton follows the motions of the human such that the human does not feel the extra weight and inertia of the exoskeleton. Compensating the exoskeleton in a model-based way allows us to more properly compare different assistance strategies for exoskeletons.</p><p>A key element in the model-based exoskeleton dynamics compensation is the contact modelling with the environment. A change in contact situation leads to a change in the compensation controller. In the literature, Finite State Machines (FSM) are often used to specify different (discrete) states of the controller [<xref ref-type="bibr" rid="CR1">1</xref>]. Depending on the phase of the motion, different states are defined which can have their own control strategy. In this way, position and force control can be interchanged depending on the phase of motion [<xref ref-type="bibr" rid="CR6">6</xref>, <xref ref-type="bibr" rid="CR14">14</xref>]. Many of the states of the FSMs implicitly relate to the contact with the environment. For example, the swing and stance phases of gait indicate if the foot makes contact with the ground. In this work, the states of the FSM are directly linked to the contact situations with the environment.</p><p>The computation of the assistive torques can also rely on a model-based strategy. Such a model-based approach relies on a musculoskeletal model of the user, comprising two parts. First, the skeletal, dynamics model calculates the torques required at each joint for a given task. Second, the muscle model estimates the torque which the user is able to deliver with his muscles. The work of Carmichael et al. [<xref ref-type="bibr" rid="CR28">28</xref>] shows a method to estimate the assistance needs of a person with respect to the task at hand relying on muscle models. Hence, human capability is expressed at muscle level and accounts for the changing lever arms of the muscles, the muscle force-length and force-velocity properties, and the effect of bi-articular muscles. This makes the model usable for any activity at any speed. How the muscle strength needs to be identified is not tackled, nor is the influence of muscle fatigue accounted for. A model that is less computationally intensive expresses human capability at the joint level by imposing joint torque limits. However, this last model neglects the mentioned muscle effects. Hence, these joint torque limits are only valid for a specific motion at a specific speed and hence are not generalizable.</p><p>In order to achieve both the compensation of the exoskeleton dynamics and the user-specific assistance, this paper presents a novel model-based torque control approach for exoskeletons. The focus lies on the compensation of the exoskeleton dynamics, the model-based assistance is computed off-line and the assistance is not the focus of this paper. Both the model-based exoskeleton dynamics compensation and the model-based human assistance are generalizable to other motions, because the models are usable in any contact situation. The first contribution is the extensive modelling of the exoskeleton and its interactions with the environment. The boundaries of the models and assumptions made during modelling are presented. The modelling starts from a model-based control scheme and modelling procedure. The second contribution is the design of the feedforward control signal for the SEA. This feedforward signal is important to obtain good torque tracking, since the bandwidth of the feedback position control is limited. The third contribution is the validation of the control method on an exoskeleton for sit-to-stand motions. A sit-to-stand motion is chosen as validation because this motion is less reported on in the literature and it is not a cyclic motion such as overground walking. The absence of the cyclic characteristic makes forces and torques harder to predict.</p><p>The Methods section presents the model-based control approach for assistive robots. The general control scheme, modelling of exoskeleton and environment and the feedforward for SEAs are presented. The Sit-to-stand Exoskeleton section explains the implementation of the model-based control methods on an exoskeleton for standing up and sitting down. The used exoskeleton hardware and sensor are also presented. The experiments and results are described in the next section, followed by the discussion and conclusion.</p></sec><sec id="Sec2"><title>Methods: Model-based Control</title><p>Because all controllers do depend on hardware to some extent, modelling procedures and assumptions behind the control design are of great importance for other researchers working on different hardware. However, for many existing exoskeletons, a detailed description of the control strategy is not available, as pointed out in [<xref ref-type="bibr" rid="CR1">1</xref>]. To encourage the use of and reporting of dynamic models of assistive devices in control, a systematic modelling procedure is presented in Table&#x000a0;<xref rid="Tab1" ref-type="table">1</xref>, focusing on a single activity (like walking). The contact with the environment plays a key role in the modelling procedure. Although the modelling procedure presented in Table&#x000a0;<xref rid="Tab1" ref-type="table">1</xref> is obvious, the importance of the contact situations of the exoskeleton cannot be emphasized enough. The different contact situations directly influence controllers.
<table-wrap id="Tab1"><label>Table 1</label><caption><p>Modelling procedure for an activity on an existing exoskeleton (hardware is given)</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">step no.</th><th align="left">name</th><th align="left">description</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">list sensors</td><td align="justify">list all sensor information available for the exoskeleton controller</td></tr><tr><td align="left">2</td><td align="left">contact</td><td align="justify">determine and characterize the different environment contact situations in the activity</td></tr><tr><td align="left">3</td><td align="left">detect</td><td align="justify">decide how to detect the transition in environment contact using the available sensor data</td></tr><tr><td align="left">4</td><td align="left">model</td><td align="justify">model the dynamic models of each different environment contact situation and their transitions</td></tr></tbody></table></table-wrap></p><p>This modelling procedure is supplemented by a general control scheme in Fig.&#x000a0;<xref rid="Fig1" ref-type="fig">1</xref>. This control scheme differs from other control schemes, like the one of Tucker et al. [<xref ref-type="bibr" rid="CR29">29</xref>], by having a strong link with the modelling procedure. Our control scheme has four control levels: actuator, low-level, mid-level, and high-level control as indicated in the figure. Their relation with the modelling steps is explained as follows. The actuator control level uses the model of one actuator, the low-level controller uses the model of the whole exoskeleton and the mid- and high-level controller relate to modelling the ground contact of the exoskeleton.
<fig id="Fig1"><label>Fig. 1</label><caption><p>General control scheme for an exoskeleton. The physical system in red is separated from the control by the dashed line. The control is divided into four hierarchical levels, with a few keywords to indicate their function. The thin lines represent data flow from the available exoskeleton sensors. The thick lines represent the control/decision commands to a lower control level. The assistance block in green transforms the sensor data to desired assistance in the low-level control block</p></caption><graphic xlink:href="12984_2019_526_Fig1_HTML" id="MO1"/></fig></p><p>The lowest control level is the <italic>actuator level</italic>, which sends commands to a single actuator unit, consisting of a motor and possibly a spring. Our focus is on electric motors. Typical control approaches use velocity controllers or torque controllers. The choice between a velocity or torque controller influences how the dynamic models are used in the low-level control, as the control commands and feedforward commands differ. The inputs of the actuator controller are the sensor data of the actuated joint and the desired reference control signal.</p><p>The <italic>low-level</italic> controller sends reference commands to all actuator controllers. The control strategy is either force, impedance or position control. This control level utilizes dynamic models of the exoskeleton and contact models with the environment. The high complexity and the lack of information make it impractical to model every part of the physical world in Fig.&#x000a0;<xref rid="Fig1" ref-type="fig">1</xref>. However, it is usually feasible to model the exoskeleton and its changing interactions with the environment, which is the result of modelling step 4. Inputs of this control level are control gains and modelling parameters supplied by the mid-level controller, together with sensor data of the whole exoskeleton.</p><p>The assistance depends on the control strategy and, consequently, is part of the low-level controller. In impedance control, the assistance is directly related to the chosen impedance and the error with respect to the imposed reference trajectory. In force control, the assistance is a force or torque which the assistive robot provides to the human. In this work, the assistance torque complies with the assistance-as-needed paradigm. Relying on the musculoskeletal model of the human and the sensor data of the exoskeleton, the capability gap [<xref ref-type="bibr" rid="CR28">28</xref>, <xref ref-type="bibr" rid="CR30">30</xref>] is calculated. This capability gap is the difference between the torque demanded by the motion of the human and the torque available by the human muscles.</p><p>The <italic>mid-level</italic> controller decides which model the low-level controller should use, depending on the contact. To achieve this, the mid-level controller changes control gains, models and/or model parameters of the low-level controller. In addition, the mid-level controller also triggers when to start and stop giving assistance when this assistance is not always active such as in the capability gap calculated assistance. The mid-level controller is an FSM, a discrete controller. The states are related to the different contact situations of the activity, which is an outcome of modelling step 2 in Table&#x000a0;<xref rid="Tab1" ref-type="table">1</xref>. The inputs of this control level are the events (important occurrences) detected by the high-level controller.</p><p>While the mid-level controller implements how the contact models should change, the <italic>high-level</italic> controller implements <italic>when</italic> these changes need to occur. The high-level controller does this by sending events to switch the state of the FSM in the mid-level controller. The events are related to the current and future contact situation with the environment. Hence, the high-level controller consists of several intent and event estimators, which are the outcome of modelling step 3. These estimators detect or predict an upcoming change in contact using all the available sensor data. The predictions are needed to ensure a continuous transition in the models used in the low-level controller.</p><p>The following subsections present the modelling steps of the exoskeleton and the contact situations and how to compensate the exoskeleton dynamics in the controller. In the first subsection, the exoskeleton dynamics model is presented and the compensation of the exoskeleton dynamics is derived. In the second subsection, the impact of the contact on the dynamics is shown and the contact modelling step is explained. The third subsection tackles the feedforward control command for the actuator control level to improve the performance of the controller.</p><sec id="Sec3"><title>Modelling and Compensation of the Exoskeleton Dynamics</title><p>The controller needs to actively compensate the dynamics of the exoskeleton, as these dynamics have a negative effect on the performance. Any exoskeleton which physically interacts with a person unavoidably adds mass and rotational inertia to the person. When the controller compensates for these added dynamics, the exoskeleton delivers the torques to move itself. As the person observes a reduced exoskeleton mass and rotational inertia, this control mode is referred to as transparent control. The exoskeleton dynamics compensation does not limit itself to gravitational effects [<xref ref-type="bibr" rid="CR8">8</xref>, <xref ref-type="bibr" rid="CR10">10</xref>, <xref ref-type="bibr" rid="CR12">12</xref>, <xref ref-type="bibr" rid="CR31">31</xref>], but encompasses the whole dynamics including inertial effects, which are not negligible [<xref ref-type="bibr" rid="CR13">13</xref>, <xref ref-type="bibr" rid="CR14">14</xref>].</p><p>A floating base dynamic model [<xref ref-type="bibr" rid="CR32">32</xref>], see Fig.&#x000a0;<xref rid="Fig2" ref-type="fig">2</xref>, is chosen to calculate the exoskeleton torques through inverse dynamics. This model is characterized by a virtual kinematic chain that connects the floating base to the ground. This virtual chain represents all degrees of freedom (dof) of the <italic>floating</italic> base, but is not actuated. In order to move the exoskeleton in the world, additional actuated paths towards the ground are needed. Such an actuation path is a chain of exoskeleton links connected to the ground and running up to the base link. Each ground contact applies constraints to the dynamic model and introduces constraint wrenches, consisting of forces and moments. Because most exoskeletons are only actuated in the sagittal plane, a 2D dynamic model suffices to describe them.
<fig id="Fig2"><label>Fig. 2</label><caption><p>Floating base model of the exoskeleton. The floating base representation of an exoskeleton is characterized by a virtual, unactuated chain. This chain consists of six dofs: three translations and three rotations in 3D. When using a 2D model this reduces to two translations and one rotation, shown by the filled dofs. These actuators lie in one plane, the sagittal plane, shown in blue</p></caption><graphic xlink:href="12984_2019_526_Fig2_HTML" id="MO2"/></fig></p><p>SEAs are often used in exoskeletons and thus have to be modelled. An SEA consists of a spring in series with the motor as seen in Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>. The motor moves the lever arm with respect to the reference link and a spring between the lever arm and moving link pulls or pushes the moving link. The angles of the lever arm and moving link relative to the reference link are <italic>&#x003b8;</italic><sub><italic>i</italic></sub> and <italic>&#x003d5;</italic><sub><italic>i</italic></sub> respectively. The lever arm angle <italic>&#x003b8;</italic><sub><italic>i</italic></sub> is the same as the motor angle after transmission. From here on we will use the term lever arm angle. The angle over which the rotary spring is compressed or extended is <italic>&#x003b1;</italic><sub><italic>i</italic></sub>=<italic>&#x003b8;</italic><sub><italic>i</italic></sub>&#x02212;<italic>&#x003d5;</italic><sub><italic>i</italic></sub>. The torque generated by the spring is the actuation torque for driving the moving link, as seen in Eq. (<xref rid="Equ1" ref-type="">1</xref>). SEAs are introduced to the exoskeleton dynamics model by combining a reduced flexible joint dynamic model [<xref ref-type="bibr" rid="CR33">33</xref>] with a floating base dynamic model [<xref ref-type="bibr" rid="CR32">32</xref>]: 
<disp-formula id="Equ1"><label>1</label><alternatives><tex-math id="M1">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \mathbf{M}(\boldsymbol{q}) \ddot{\boldsymbol{q}} + \mathbf{C}(\boldsymbol{q},\dot{\boldsymbol{q}}) \dot{\boldsymbol{q}} + \mathbf{G}(\boldsymbol{q}) = \mathbf{S}^{T} \boldsymbol{\tau}_{spr} + \mathbf{J}_{c}^{T}(\boldsymbol{q}) \boldsymbol{w}_{c} + \boldsymbol{f}_{h},   $$ \end{document}</tex-math><mml:math id="M2"><mml:mi mathvariant="bold">M</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold-italic">q</mml:mi><mml:mo>)</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mi mathvariant="bold">C</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold-italic">q</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>)</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mi mathvariant="bold">G</mml:mi><mml:mo>(</mml:mo><mml:mi mathvariant="bold-italic">q</mml:mi><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">S</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msubsup><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:mo>(</mml:mo><mml:mi mathvariant="bold-italic">q</mml:mi><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">f</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12984_2019_526_Article_Equ1.gif" position="anchor"/></alternatives></disp-formula>
</p><p>
<disp-formula id="Equ2"><label>2</label><alternatives><tex-math id="M3">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \mathbf{B} \ddot{\boldsymbol{\theta}} + \boldsymbol{\tau}_{spr} = \boldsymbol{\tau}_{motor},   $$ \end{document}</tex-math><mml:math id="M4"><mml:mi mathvariant="bold">B</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">motor</mml:mtext></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12984_2019_526_Article_Equ2.gif" position="anchor"/></alternatives></disp-formula>
<fig id="Fig3"><label>Fig. 3</label><caption><p>Schematic model of an SEA. An SEA consists of a motor, a transmission, a spring and the outgoing link, as shown by the top schematic. All variables are referenced against the previous link as shown by the dashed line in the lower figure. <inline-formula id="IEq1"><alternatives><tex-math id="M5">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\theta _{i}^{*}$\end{document}</tex-math><mml:math id="M6"><mml:msubsup><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>&#x02217;</mml:mo></mml:mrow></mml:msubsup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq1.gif"/></alternatives></inline-formula> is the motor angle before transmission. <italic>&#x003b1;</italic><sub><italic>i</italic></sub>=<italic>&#x003b8;</italic><sub><italic>i</italic></sub>&#x02212;<italic>&#x003d5;</italic><sub><italic>i</italic></sub> is the spring deflection angle</p></caption><graphic xlink:href="12984_2019_526_Fig3_HTML" id="MO3"/></fig>
</p><p>with the assumption that no energy is dissipated in the contacts (e.g. by sliding friction) and with the following definitions: 
<list list-type="bullet"><list-item><p><inline-formula id="IEq2"><alternatives><tex-math id="M7">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\boldsymbol {q}, \dot {\boldsymbol {q}}, \ddot {\boldsymbol {q}} \in \mathbb {R}^{r \times 1}$\end{document}</tex-math><mml:math id="M8"><mml:mi mathvariant="bold-italic">q</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq2.gif"/></alternatives></inline-formula>: the state vector, consisting of three floating base variables (<italic>p</italic><sub><italic>x</italic></sub>,<italic>p</italic><sub><italic>y</italic></sub> and <italic>&#x003c8;</italic>) and <italic>n</italic> joint angles <italic>&#x003d5;</italic><sub><italic>i</italic></sub>, i.e. <bold><italic>q</italic></bold>=[<italic>p</italic><sub><italic>x</italic></sub>
<italic>p</italic><sub><italic>y</italic></sub>
<italic>&#x003c8;</italic>
<italic>&#x003d5;</italic><sub>1</sub> &#x02026; <italic>&#x003d5;</italic><sub><italic>n</italic></sub>]<sup><italic>T</italic></sup>, see Fig.&#x000a0;<xref rid="Fig4" ref-type="fig">4</xref> for the definition of all variables,
</p></list-item><list-item><p><inline-formula id="IEq3"><alternatives><tex-math id="M9">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\boldsymbol {\theta }, \dot {\boldsymbol {\theta }}, \ddot {\boldsymbol {\theta }} \in \mathbb {R}^{n \times 1}$\end{document}</tex-math><mml:math id="M10"><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq3.gif"/></alternatives></inline-formula>: the lever arm state vector,</p></list-item><list-item><p><inline-formula id="IEq4"><alternatives><tex-math id="M11">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbf {M} \in \mathbb {R}^{r \times r}$\end{document}</tex-math><mml:math id="M12"><mml:mi mathvariant="bold">M</mml:mi><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq4.gif"/></alternatives></inline-formula>: the inertia matrix,</p></list-item><list-item><p><inline-formula id="IEq5"><alternatives><tex-math id="M13">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbf {C} \in \mathbb {R}^{r \times r}$\end{document}</tex-math><mml:math id="M14"><mml:mi mathvariant="bold">C</mml:mi><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq5.gif"/></alternatives></inline-formula>: the Coriolis and centrifugal matrix,</p></list-item><list-item><p><inline-formula id="IEq6"><alternatives><tex-math id="M15">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbf {G} \in \mathbb {R}^{r \times 1}$\end{document}</tex-math><mml:math id="M16"><mml:mi mathvariant="bold">G</mml:mi><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq6.gif"/></alternatives></inline-formula>: the gravitational vector,</p></list-item><list-item><p><inline-formula id="IEq7"><alternatives><tex-math id="M17">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\boldsymbol {\tau }_{spr} \in \mathbb {R}^{n \times 1}$\end{document}</tex-math><mml:math id="M18"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq7.gif"/></alternatives></inline-formula>: the spring torques,</p></list-item><list-item><p><bold>S</bold>=[<bold>0</bold><sub><italic>n</italic>&#x000d7;3</sub>
<bold>I</bold><sub><italic>n</italic>&#x000d7;<italic>n</italic></sub>]: the actuation selection matrix,</p></list-item><list-item><p><inline-formula id="IEq8"><alternatives><tex-math id="M19">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\boldsymbol {w}_{c} \in \mathbb {R}^{k}$\end{document}</tex-math><mml:math id="M20"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq8.gif"/></alternatives></inline-formula>: the vector of all contact forces/moments,</p></list-item><list-item><p><inline-formula id="IEq9"><alternatives><tex-math id="M21">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbf {J}_{c} \in \mathbb {R}^{k \times r}$\end{document}</tex-math><mml:math id="M22"><mml:msub><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mi>r</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq9.gif"/></alternatives></inline-formula>: the contact/constraint Jacobian,</p></list-item><list-item><p><inline-formula id="IEq10"><alternatives><tex-math id="M23">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\boldsymbol {f}_{h} \in \mathbb {R}^{r \times 1}$\end{document}</tex-math><mml:math id="M24"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">f</mml:mi></mml:mrow><mml:mrow><mml:mi>h</mml:mi></mml:mrow></mml:msub><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq10.gif"/></alternatives></inline-formula>: the vector of human interaction forces/torques,</p></list-item><list-item><p><inline-formula id="IEq11"><alternatives><tex-math id="M25">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\mathbf {B} \in \mathbb {R}^{n \times n}$\end{document}</tex-math><mml:math id="M26"><mml:mi mathvariant="bold">B</mml:mi><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq11.gif"/></alternatives></inline-formula>: the diagonal motor inertia matrix after transmission,</p></list-item><list-item><p><inline-formula id="IEq12"><alternatives><tex-math id="M27">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\boldsymbol {\tau }_{motor} \in \mathbb {R}^{n \times 1}$\end{document}</tex-math><mml:math id="M28"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">motor</mml:mtext></mml:mrow></mml:msub><mml:mo>&#x02208;</mml:mo><mml:msup><mml:mrow><mml:mi>&#x0211d;</mml:mi></mml:mrow><mml:mrow><mml:mi>n</mml:mi><mml:mo>&#x000d7;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq12.gif"/></alternatives></inline-formula>: the motor joint torques after transmission.</p></list-item></list>
<fig id="Fig4"><label>Fig. 4</label><caption><p>Definition of frames, angles and floating base states variables of the exoskeleton. The thick black lines represent the link of one leg of the exoskeleton viewed from the side (sagittal plane). The joints (hip, knee and ankle are indicated by black circles. The lever arms of the actuated joints are indicated by purple bars. The frame of each link is shown in a different color with all z-axes pointing outward of the paper. The link angles <italic>&#x003d5;</italic><sub><italic>i</italic></sub> and the lever arm angles <italic>&#x003b8;</italic><sub><italic>i</italic></sub> are defined starting from the previous link (=reference link) and according to the right hand rule. The knee joint and lever arm angle are thus negative in this configuration. <italic>p</italic><sub><italic>x</italic></sub> and <italic>p</italic><sub><italic>y</italic></sub> represent the position of the center of mass of the floating base link, the pelvis link. The angle <italic>&#x003c8;</italic> is the angle of the floating base with respect to the world frame</p></caption><graphic xlink:href="12984_2019_526_Fig4_HTML" id="MO4"/></fig></p><p>The parameters in <bold>M</bold>,<bold>C</bold>,<bold>G</bold> and <bold>B</bold> consist of the masses, center of masses, rotational inertias and lengths of the exoskeleton links, which are derived from CAD models or are experimentally identified [<xref ref-type="bibr" rid="CR34">34</xref>, <xref ref-type="bibr" rid="CR35">35</xref>]. From here on, the dependence of matrices and vectors on <bold><italic>q</italic></bold> or <inline-formula id="IEq13"><alternatives><tex-math id="M29">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\boldsymbol {\dot {q}}$\end{document}</tex-math><mml:math id="M30"><mml:mstyle mathvariant="bold-italic"><mml:mover accent="true"><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mstyle></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq13.gif"/></alternatives></inline-formula> is omitted in the equations. The number of actuated joints of the robot is <italic>n</italic>; <italic>r</italic>=<italic>n</italic>+3 is the number of the floating base model states and <italic>k</italic> is the dimension of the independent contact constraints. For example, with one non-sliding foot flat on the ground <italic>k</italic>=3; with two non-sliding feet flat on the floor <italic>k</italic>=6. When making contact with the ground, the kinematics at the contact points are constrained using the additional equations: 
<disp-formula id="Equ3"><label>3</label><alternatives><tex-math id="M31">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \dot{\boldsymbol{p}}_{c} = \mathbf{J}_{c} \dot{\boldsymbol{q}} = 0,   $$ \end{document}</tex-math><mml:math id="M32"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12984_2019_526_Article_Equ3.gif" position="anchor"/></alternatives></disp-formula></p><p>
<disp-formula id="Equ4"><label>4</label><alternatives><tex-math id="M33">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$ \ddot{\boldsymbol{p}}_{c} = \mathbf{J}_{c} \ddot{\boldsymbol{q}} + \dot{\mathbf{J}}_{c} \dot{\boldsymbol{q}} = \mathbf{J}_{c} \ddot{\boldsymbol{q}} + \left(\sum_{j=1}^{r} \frac{\partial \mathbf{J}_{c}}{\partial q_{j}} \dot{q}_{j} \right) \dot{\boldsymbol{q}} = 0,   $$ \end{document}</tex-math><mml:math id="M34"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:munderover><mml:mrow><mml:mo>&#x02211;</mml:mo></mml:mrow><mml:mrow><mml:mi>j</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:munderover><mml:mfrac><mml:mrow><mml:mi>&#x02202;</mml:mi><mml:msub><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>&#x02202;</mml:mi><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfenced><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo></mml:math><graphic xlink:href="12984_2019_526_Article_Equ4.gif" position="anchor"/></alternatives></disp-formula>
</p><p>with <bold><italic>p</italic></bold><sub><italic>c</italic></sub>=[<italic>x</italic><sub><italic>left</italic></sub>
<italic>y</italic><sub><italic>left</italic></sub>
<italic>&#x003a8;</italic><sub><italic>left</italic></sub>
<italic>x</italic><sub><italic>right</italic></sub>
<italic>y</italic><sub><italic>right</italic></sub>
<italic>&#x003a8;</italic><sub><italic>right</italic></sub>]<sup><italic>T</italic></sup> representing the positions and angle of both feet with respect to the world frame.</p><p>The human is modelled as an <bold>independent</bold> disturbance <bold><italic>f</italic></bold><sub><italic>h</italic></sub> acting on the exoskeleton at joint level, as seen in Eq. (<xref rid="Equ1" ref-type="">1</xref>). This human input consists of two forces and one moment at the floating base and <italic>n</italic> human joint torques. Another way of modelling the interaction between exoskeleton and human is to identify every interaction point and measure every interaction force and moment. This is not a practical solution, because it requires expensive force cells at every link, potentially multiple ones if single axis force cells are used. These force cells add weight and consume space. The human interactions <bold><italic>f</italic></bold><sub><italic>h</italic></sub> represent the assistance delivered by the exoskeleton to the human. To calculate the transparent control torques, the human interactions <bold><italic>f</italic></bold><sub><italic>h</italic></sub> are set to zero. When the exoskeleton needs to provide assistance, a desired vector of interaction forces and torques <bold><italic>f</italic></bold><sub><italic>h,d</italic><italic>e</italic><italic>s</italic></sub> is added to the exoskeleton dynamics compensation torques. From here on, we only consider assistance at the joints, referred to as assistance torques <bold><italic>&#x003c4;</italic></bold><sub><italic>assist</italic></sub>. When no interaction forces are desired, the exoskeleton acts transparently.</p><p>The spring torques required to compensate the exoskeleton dynamics are derived from the <italic>n</italic> lower rows of Eq. (<xref rid="Equ1" ref-type="">1</xref>): 
<disp-formula id="Equ5"><label>5</label><alternatives><tex-math id="M35">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \boldsymbol{\tau}_{dyn} = &#x00026; \beta_{in} \widehat{\mathbf{M}}_{jo} \ddot{\boldsymbol{q}} + \beta_{in} \widehat{\mathbf{C}}_{jo} \dot{\boldsymbol{q}} + \widehat{\mathbf{G}}_{jo} - \widehat{\mathbf{J}}_{c,jo}^{T} \widehat{\boldsymbol{w}}_{c},  \end{array} $$ \end{document}</tex-math><mml:math id="M36"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">dyn</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="align-2"><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">in</mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">in</mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ5.gif" position="anchor"/></alternatives></disp-formula></p><p>with <italic>jo</italic> indicating the <italic>n</italic> lower rows of the corresponding matrices and vector, which relate to the actuated joints. The hats on top of the matrices and contact wrench indicates these are now relying on estimated values (dynamic parameters) and the measured state vector. This way of compensating the non-linear dynamics is a form of feedback linearisation [<xref ref-type="bibr" rid="CR36">36</xref>, <xref ref-type="bibr" rid="CR37">37</xref>], also called computed torque-like control [<xref ref-type="bibr" rid="CR15">15</xref>, <xref ref-type="bibr" rid="CR38">38</xref>]. The gain <italic>&#x003b2;</italic><sub><italic>in</italic></sub> is introduced to reduce the inertial effects in the exoskeleton dynamics compensation control for stability reasons. A complete compensation of the inertial terms of the exoskeleton is not feasible, due to modelling errors and delays. These delays are unavoidable when working with derivatives of measured variables, except when dealing with quasi-cyclic motions [<xref ref-type="bibr" rid="CR39">39</xref>, <xref ref-type="bibr" rid="CR40">40</xref>]. Therefore, the <italic>&#x003b2;</italic><sub><italic>in</italic></sub> gain is held constant between 0 and 1, close to 1. The gravitational term has no such gain, as it is less prone to modelling errors and does not depend on derivatives of joint angles. When the exoskeleton also has to provide assistance the desired spring torque becomes: 
<disp-formula id="Equ6"><label>6</label><alternatives><tex-math id="M37">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \boldsymbol{\tau}_{des,spr} = &#x00026; \boldsymbol{\tau}_{dyn} + \boldsymbol{\tau}_{assist}.  \end{array} $$ \end{document}</tex-math><mml:math id="M38"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="align-2"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">dyn</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">assist</mml:mtext></mml:mrow></mml:msub><mml:mi>.</mml:mi><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ6.gif" position="anchor"/></alternatives></disp-formula></p><p>Torque control of SEAs often relies on position (and velocity) controllers at the actuator level [<xref ref-type="bibr" rid="CR41">41</xref>&#x02013;<xref ref-type="bibr" rid="CR43">43</xref>]. Hence, the desired spring torque is converted into a desired spring angle using the torque angle relation: 
<disp-formula id="Equ7"><label>7</label><alternatives><tex-math id="M39">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \tau_{spr,i} = f_{i}(\alpha_{i}) \Rightarrow \alpha_{des,i} = f_{i}^{-1} (\tau_{spr,i}),  \end{array} $$ \end{document}</tex-math><mml:math id="M40"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mi>&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>&#x021d2;</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ7.gif" position="anchor"/></alternatives></disp-formula></p><p>with <italic>f</italic> being the non-linear torque-angle relation. The spring characteristic <italic>f</italic><sub><italic>i</italic></sub> only depends on joint <italic>i</italic>. These inverse spring calculations are represented by: 
<disp-formula id="Equ8"><label>8</label><alternatives><tex-math id="M41">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \boldsymbol{\alpha}_{des} = F_{inv}(\boldsymbol{\tau}_{des,spr}).  \end{array} $$ \end{document}</tex-math><mml:math id="M42"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>F</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">inv</mml:mtext></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo><mml:mi>.</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ8.gif" position="anchor"/></alternatives></disp-formula></p><p>The spring angle is then enforced by a closed loop position controller. The desired motor angle for each joint is the sum of the spring deflection and the measured joint angle: <inline-formula id="IEq14"><alternatives><tex-math id="M43">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\theta _{des,i} = \alpha _{des,i} + \widehat {\phi }_{i}$\end{document}</tex-math><mml:math id="M44"><mml:msub><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi>&#x003d5;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq14.gif"/></alternatives></inline-formula>, or in vector notation: 
<disp-formula id="Equ9"><label>9</label><alternatives><tex-math id="M45">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \boldsymbol{\theta}_{des} = \boldsymbol{\alpha}_{des} + \mathbf{S} \widehat{\boldsymbol{q}},  \end{array} $$ \end{document}</tex-math><mml:math id="M46"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mi mathvariant="bold">S</mml:mi><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ9.gif" position="anchor"/></alternatives></disp-formula></p><p>with the hat indicating a measured variable and with the selection Matrix <bold>S</bold> only taking the <italic>n</italic> joint angles <italic>&#x003d5;</italic><sub><italic>i</italic></sub> from the state vector <bold><italic>q</italic></bold>: [<italic>&#x003d5;</italic><sub>1</sub> &#x02026; <italic>&#x003d5;</italic><sub><italic>n</italic></sub>]<sup><italic>T</italic></sup>=<bold>S</bold><bold><italic>q</italic></bold>.</p></sec><sec id="Sec4"><title>Environment Contact Modelling</title><p>Any contact with the environment imposes constraints on the kinematics in Eqs. (<xref rid="Equ3" ref-type="">3</xref>-<xref rid="Equ4" ref-type="">4</xref>) and results in constraint forces and moments <bold><italic>w</italic></bold><sub><italic>c</italic></sub> on the dynamics in Eq. (<xref rid="Equ1" ref-type="">1</xref>). Jacobian <bold>J</bold><sub><italic>c</italic></sub> represents information about the nature and location of the ground contact. This contact information is derived from sensor data, the exoskeleton kinematics and a model of the environment.</p><p>Suitable sensors to detect contact locations are contact switches, pressure sensors, force/torque sensors, or even distance sensors. When none of these sensors are available, at least one absolute orientation measurement from an Inertial Measurement Unit (IMU) is needed to estimate the contact information. Using the exoskeleton kinematics and some mild assumptions about the ground, for example flat surface, the absolute orientation measurement allows to estimate the position and angle of the feet with respect to the ground. This, in turn, allows to estimate the contact information.</p><p>The contact wrenches <bold><italic>w</italic></bold><sub><italic>c</italic></sub> can be obtained from either measurement or estimation. The first method uses force cells to directly measure the forces and moments. Although these sensors are capable of accurately measuring the wrenches, they have several disadvantages: they need to be placed at all contact locations, they need to be calibrated, and are expensive when high accuracy and repeatability is required. Overloading force cells should also be avoided. Often when a force cell is able to be overloaded more, its resolution is lowered. In the exoskeleton used to validate the developed control methods, no force sensors are available. However, the springs in the SEAs can be seen as simple force cells that allow to measure joint torques. The second method estimates the contact wrenches using the floating base part of the dynamics given by the top three equations of Eq. (<xref rid="Equ1" ref-type="">1</xref>) and the constraint equations (<xref rid="Equ3" ref-type="">3</xref>) and (<xref rid="Equ4" ref-type="">4</xref>). These equations enable us to solve three contact wrench components. Whenever the number of wrench components <italic>k</italic> exceeds three, e.g. when both feet are on the ground, the contact wrenches cannot be solved unambiguously and a contact wrench distribution needs to be found. In humanoid robotics, this is solved by minimizing a weighted combination of contact forces and joint torques [<xref ref-type="bibr" rid="CR26">26</xref>, <xref ref-type="bibr" rid="CR27">27</xref>]. In this paper, we use a similar method [<xref ref-type="bibr" rid="CR44">44</xref>] in which the weights of the minimization are determined by the stiffness of the exoskeleton parts.</p><p>Although contacts are generally modelled with a contact Jacobian and a contact wrench, some contact situations allow alternative modelling approaches. Alternative modelling is required when the contact wrench is hard to obtain or the contact Jacobian cannot be constructed. The contact between an exoskeleton and a chair/stool in a sit-to-stand (STS) motion is a contact that is hard to model and measure. In this case, the stool is supporting the weight of the exoskeleton, reducing the load on the leg actuators. Hence, the stool contact can be modelled by setting the gravity part of the dynamics to zero. When the exoskeleton leaves the stool, the gravity part is again active. This alternative modelling is achieved by adding a changing gravity gain scalar <italic>&#x003b2;</italic><sub><italic>g</italic></sub> to the exoskeleton dynamics compensation joint torques in Eq. (<xref rid="Equ5" ref-type="">5</xref>): 
<disp-formula id="Equ10"><label>10</label><alternatives><tex-math id="M47">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \boldsymbol{\tau}_{dyn} = \beta_{in} \left(\widehat{\mathbf{M}}_{jo} {\ddot{\boldsymbol{q}}} + \widehat{\mathbf{C}}_{jo} {\dot{\boldsymbol{q}}} \right) + \beta_{g} \widehat{\mathbf{G}}_{jo} - \widehat{\mathbf{J}}_{c,jo}^{T} \widehat{\boldsymbol{w}}_{c},  \end{array} $$ \end{document}</tex-math><mml:math id="M48"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">dyn</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">in</mml:mtext></mml:mrow></mml:msub><mml:mfenced close=")" open="(" separators=""><mml:mrow><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow></mml:mfenced><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ10.gif" position="anchor"/></alternatives></disp-formula></p><p>where the gain <italic>&#x003b2;</italic><sub><italic>g</italic></sub> lies between 0 and 1.</p></sec><sec id="Sec5"><title>Robot Dynamics in feedforward</title><p>This way of compensating the non-linear dynamics is a form of feedback linearisation [<xref ref-type="bibr" rid="CR36">36</xref>, <xref ref-type="bibr" rid="CR37">37</xref>], also called computed torque-like control [<xref ref-type="bibr" rid="CR15">15</xref>, <xref ref-type="bibr" rid="CR38">38</xref>].</p><p>Computed torque-like control [<xref ref-type="bibr" rid="CR38">38</xref>] is a form of feedback linearisation [<xref ref-type="bibr" rid="CR36">36</xref>, <xref ref-type="bibr" rid="CR37">37</xref>]. It relies on a good torque control loop in order to compensate the non-linearities and achieve linear error dynamics. SEAs allow to convert a torque control to a position control problem using Eq. (<xref rid="Equ7" ref-type="">7</xref>). However, feedback position control of the SEAs is insufficient to compensate the exoskeleton dynamics, since the bandwidth of this position controller is always lower than the underlying motor velocity or current control loop. Moreover, the varying inertia (and stiffness) seen by each actuator requires conservative tuning of the feedback gain, which further limits the bandwidth of the position control loop. Therefore, feedforward is essential in SEA control to reduce the torque tracking errors in case of rapidly changing torques.</p><p>In order to be as effective as possible, the feedforward signal should enter at the lowest possible level in the actuator controller. This <italic>actuator control level</italic> consists of a current control loop inside the velocity control loop. Current feedforward is directly related to the joint torques, because of the linear relationship between torque and current for electric motors, given by the motor constant <italic>K</italic><sub><italic>T</italic></sub> (neglecting magnetic saturation). This feedforward also depends on the efficiency of the motor and gear <italic>&#x003b7;</italic>, which is not a constant, and the transmission ratio of the gears, <italic>t</italic><sub><italic>r</italic></sub>. The current feedforward <italic>I</italic><sub><italic>ff</italic></sub> is based on the work of Paine et al. [<xref ref-type="bibr" rid="CR45">45</xref>], but extended using Eq. (<xref rid="Equ2" ref-type="">2</xref>) to also take the motor inertia <bold>B</bold><sub><italic>ii</italic></sub> into account to give for actuator <italic>i</italic>: 
<disp-formula id="Equ11"><label>11</label><alternatives><tex-math id="M49">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} I_{ff,i} = \frac{\tau_{motor,i}}{(t_{r} \cdot \eta \cdot K_{T})_{i}} = \frac{\tau_{spr,i} + \mathbf{B}_{ii} \ddot{\theta}_{i}}{(t_{r} \cdot \eta \cdot K_{T})_{i}}.  \end{array} $$ \end{document}</tex-math><mml:math id="M50"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ff</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">motor</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>&#x000b7;</mml:mo><mml:mi>&#x003b7;</mml:mi><mml:mo>&#x000b7;</mml:mo><mml:msub><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ii</mml:mtext></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi>t</mml:mi></mml:mrow><mml:mrow><mml:mi>r</mml:mi></mml:mrow></mml:msub><mml:mo>&#x000b7;</mml:mo><mml:mi>&#x003b7;</mml:mi><mml:mo>&#x000b7;</mml:mo><mml:msub><mml:mrow><mml:mi>K</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mi>.</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ11.gif" position="anchor"/></alternatives></disp-formula></p><p>If the actuator controller allows no access to the current control loop, the low-level controller needs to provide a feedforward signal on velocity level. Velocity feedforward requires a time derivative of the desired spring deflection angle <italic>&#x003b1;</italic>. By taking the time-derivative of the torque-angle characteristic in Eq. (<xref rid="Equ7" ref-type="">7</xref>): 
<disp-formula id="Equ12"><label>12</label><alternatives><tex-math id="M51">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \frac{d \tau_{spr,i}}{dt} = \frac{\partial f_{i}}{\partial \alpha_{i}} \cdot \frac{d \alpha_{i}}{d t},  \end{array} $$ \end{document}</tex-math><mml:math id="M52"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext><mml:mo>,</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">dt</mml:mtext></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>&#x02202;</mml:mi><mml:msub><mml:mrow><mml:mi>f</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mi>&#x02202;</mml:mi><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac><mml:mo>&#x000b7;</mml:mo><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:msub><mml:mrow><mml:mi>&#x003b1;</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">dt</mml:mtext></mml:mrow></mml:mfrac><mml:mo>,</mml:mo></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ12.gif" position="anchor"/></alternatives></disp-formula></p><p>and combining this in a diagonal stiffness matrix <bold>K</bold>(<italic>&#x003b1;</italic>)=<italic>diag</italic>(<italic>&#x02202;</italic><italic>f</italic><sub><italic>i</italic></sub>/<italic>&#x02202;</italic><italic>&#x003b1;</italic><sub><italic>i</italic></sub>), the motor velocity feedforward is written as: 
<disp-formula id="Equ13"><label>13</label><alternatives><tex-math id="M53">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \dot{\boldsymbol{\theta}}_{ff} = \mathbf{S} \dot{\boldsymbol{q}} + \mathbf{K}^{-1}(\alpha) \dot{\boldsymbol{\tau}}_{des,spr}.  \end{array} $$ \end{document}</tex-math><mml:math id="M54"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ff</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="bold">S</mml:mi><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:msup><mml:mrow><mml:mi mathvariant="bold">K</mml:mi></mml:mrow><mml:mrow><mml:mo>&#x02212;</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo>(</mml:mo><mml:mi>&#x003b1;</mml:mi><mml:mo>)</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mi>.</mml:mi></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ13.gif" position="anchor"/></alternatives></disp-formula></p><p>The derivative of the spring torque <inline-formula id="IEq15"><alternatives><tex-math id="M55">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {\boldsymbol {\tau }}_{des,spr}$\end{document}</tex-math><mml:math id="M56"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq15.gif"/></alternatives></inline-formula> is computed by deriving the desired spring torques in Eq. (<xref rid="Equ6" ref-type="">6</xref>), in which the exoskeleton dynamics compensation torque for STS of Eq. (<xref rid="Equ10" ref-type="">10</xref>) are substituted: 
<disp-formula id="Equ14"><label>14</label><alternatives><tex-math id="M57">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document} $$\begin{array}{*{20}l} \dot{\boldsymbol{\tau}}_{des,spr} =&#x00026; \beta_{in} ({\widehat{\dot{\mathbf{M}}}}_{jo} \ddot{\boldsymbol{q}} + \widehat{\mathbf{M}}_{jo} \dddot{\boldsymbol{q}} + {\widehat{\dot{\mathbf{C}}}}_{jo} \dot{\boldsymbol{q}} + \widehat{\mathbf{C}}_{jo} \ddot{\boldsymbol{q}}) + \beta_{g} {\widehat{\dot{\mathbf{G}}}}_{jo}  \\ &#x00026; + \dot{\beta}_{g} \widehat{\mathbf{G}}_{jo} - {\widehat{\dot{\mathbf{J}}}}_{c,jo}^{T} \widehat{\boldsymbol{w}}_{c} - \widehat{\mathbf{J}}_{c,jo}^{T} {\widehat{\dot{\boldsymbol{w}}}}_{c} + \dot{\boldsymbol{\tau}}_{assist}.  \end{array} $$ \end{document}</tex-math><mml:math id="M58"><mml:mtable class="align" columnalign="left"><mml:mtr><mml:mtd class="align-1"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo></mml:mtd><mml:mtd class="align-2"><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">in</mml:mtext></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">M</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mi>...</mml:mi></mml:mover><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">C</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover><mml:mo>)</mml:mo><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mspace width="2em"/></mml:mtd><mml:mtd><mml:mspace width="2em"/></mml:mtd></mml:mtr><mml:mtr><mml:mtd class="align-1"/><mml:mtd class="align-2"><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msubsup><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">J</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">w</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>c</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">assist</mml:mtext></mml:mrow></mml:msub><mml:mi>.</mml:mi><mml:mspace width="2em"/></mml:mtd></mml:mtr></mml:mtable></mml:math><graphic xlink:href="12984_2019_526_Article_Equ14.gif" position="anchor"/></alternatives></disp-formula></p><p>The rate of change of gain <italic>&#x003b2;</italic><sub><italic>g</italic></sub> has an important influence on the feedforward signal, as the gravity is multiplied by the time derivative of the gain terms <inline-formula id="IEq16"><alternatives><tex-math id="M59">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {\beta }_{g}$\end{document}</tex-math><mml:math id="M60"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq16.gif"/></alternatives></inline-formula>, which results in a large contribution to the feedforward signal, <inline-formula id="IEq17"><alternatives><tex-math id="M61">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {\beta }_{g} \mathbf {G}_{jo}$\end{document}</tex-math><mml:math id="M62"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b2;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>g</mml:mi></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi mathvariant="bold">G</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">jo</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq17.gif"/></alternatives></inline-formula>. Hence, the influence of changing parameters in the dynamics can be an important contribution to the feedforward command, as shown by the derivative of the spring torque in Eq. (<xref rid="Equ14" ref-type="">14</xref>). The gain for the inertial parameters <italic>&#x003b2;</italic><sub><italic>in</italic></sub> is a constant and hence no time derivative is needed.</p><p>When no desired trajectory is imposed, the exoskeleton needs to follow the human as closely as possible. In this case, the inputs of the velocity feedforward of the low-level controller are based on <italic>measured</italic> state variables and their derivatives: <inline-formula id="IEq18"><alternatives><tex-math id="M63">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\boldsymbol {q}}, {\widehat {\dot {\boldsymbol {q}}}}$\end{document}</tex-math><mml:math id="M64"><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover><mml:mo>,</mml:mo><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq18.gif"/></alternatives></inline-formula> and <inline-formula id="IEq19"><alternatives><tex-math id="M65">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}${\widehat {\ddot {\boldsymbol {q}}}}$\end{document}</tex-math><mml:math id="M66"><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq19.gif"/></alternatives></inline-formula>. To prevent instability due to modelling errors and noise, the feedforward gain needs to be set (slightly) smaller than 100% and the third order derivatives of the measured state vector <inline-formula id="IEq20"><alternatives><tex-math id="M67">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}${\widehat {\dddot {\boldsymbol {q}}}}$\end{document}</tex-math><mml:math id="M68"><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">q</mml:mi></mml:mrow><mml:mi>...</mml:mi></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq20.gif"/></alternatives></inline-formula> are omitted, because of their noise sensitivity. Only when working with predefined trajectories or predictions of the desired feedforward, the <bold><italic>q</italic></bold><italic>...</italic> term is usable when these signals are derivable at least three times. When no desired trajectory is at hand, the exact (full) feedforward cannot be attained in practice.</p></sec></sec><sec id="Sec6"><title>Sit-to-stand Exoskeleton</title><p>The contributions of this paper are validated on a bilateral lower-limb exoskeleton for STS, shown in Fig.&#x000a0;<xref rid="Fig5" ref-type="fig">5</xref>, developed in the MIRAD project. The design of the MIRAD exoskeleton focuses on the hip, knee and ankle joints in the sagittal plane [<xref ref-type="bibr" rid="CR46">46</xref>]. The range of motion and torques of these joints are largest in the sagittal plane for most activities of daily life. Standing up and sitting down demand high hip extension and knee extension power [<xref ref-type="bibr" rid="CR47">47</xref>], while the range of joint motion during this activity is large. On the other hand, walking demands high ankle plantarflexion power. Therefore, the exoskeleton only has rotational joints corresponding to the sagittal hip, knee and ankle joints. These joints are equipped with MACCEPA actuators [<xref ref-type="bibr" rid="CR48">48</xref>], which are SEAs capable of changing their stiffness, i.e. Variable Stiffness Actuators. The MACCEPA actuator uses linear compression springs with a non-linear lever-arm system, but the spring behavior at the joint level is modelled as a non-linear rotary spring according to Eq. (<xref rid="Equ7" ref-type="">7</xref>) and Fig.&#x000a0;<xref rid="Fig3" ref-type="fig">3</xref>. As the human joints outside the sagittal plane also exhibit small motions, flexibility of the mechanical frame allows small, out-of-plane motions. This makes the exoskeleton significantly more wearable. Additionally, the links are adjustable in length to increase the range of potential users.
<fig id="Fig5"><label>Fig. 5</label><caption><p>The MIRAD sit-to-stand exoskeleton. A side view of the MIRAD sit-to-stand exoskeleton is shown. The power and communication cables for each joint are not present to avoid overload of the photograph. The MACCEPA actuators are placed at the hip, knee and ankle of a commercial lower limb brace</p></caption><graphic xlink:href="12984_2019_526_Fig5_HTML" id="MO5"/></fig></p><p>The MACCEPA actuator used in the exoskeleton is shown in Fig.&#x000a0;<xref rid="Fig6" ref-type="fig">6</xref>. The lever arm and flat cable transform the linear translation spring into a non-linear stiffening rotational spring behaviour. In addition, the pretension controls the rotational stiffness. More pretension results in higher rotational stiffness. The pretension is kept the same during all motions. The drawback of the lever arm and cable system is the introduction of backlash around the alignment of the lever arm and output link. The motor in this MACCEPA is a Maxon EC 45 flat 50W motor with a Maxon Spur Gearhead GS 45 A and a toothed belt transmission, resulting in a transmission ratio of 188. The nominal torque and nominal velocity at the output of the toothed belt are 11.2Nm and 28rpm (=2.93rad/s) respectively. The peak torque can reach up to 15Nm when overloading the motor.
<fig id="Fig6"><label>Fig. 6</label><caption><p>The MACCEPA actuator. The motor is connected to the lever arm with a toothed belt transmission. A flat cable connects the lever arm with the compression spring located in the moving output link. When the lever arm and output link are aligned, the torque generated by the MACCEPA is zero. The pretension screws allow to give the spring a pretension to change the stiffness relationship of the actuator</p></caption><graphic xlink:href="12984_2019_526_Fig6_HTML" id="MO6"/></fig></p><p>The actuator is equipped with an absolute magnetic encoder (AMS, AS5048A, SPI, 6 pins, 5V, 14bits) to measure the lever arm angle with respect to the motor link <italic>&#x003b8;</italic><sub><italic>i</italic></sub>. A relative optical encoder (US Digital HUBDISK-2-2000-625-IE, module: EM1-2-2000-I, DI/O, 5 pins, 5V) measures the angle of the output link with respect to the motor link <italic>&#x003d5;</italic><sub><italic>i</italic></sub>. The motor velocity is estimated from the hall sensors and also motor current is measured. All motor data and sensor data is captured by the communication board on every joint and send to the central processing unit over EtherCAT [<xref ref-type="bibr" rid="CR49">49</xref>]. In order to have an additional absolute measure of the floating base states (<italic>p</italic><sub><italic>x</italic></sub>,<italic>p</italic><sub><italic>y</italic></sub> and <italic>p</italic><sub><italic>z</italic></sub>) and their derivatives, an IMU of Xsens [<xref ref-type="bibr" rid="CR50">50</xref>] provides accelerations, angular rotations and the orientation of the sensor.</p><p>The designed actuators including sensors, motor controller and communication boards are mounted on commercial available braces [<xref ref-type="bibr" rid="CR46">46</xref>]. The mass, center of mass coordinates and the rotational inertia of each part of the exoskeleton are shown in Table&#x000a0;<xref rid="Tab2" ref-type="table">2</xref>. These dynamic parameters are identified in previous work [<xref ref-type="bibr" rid="CR35">35</xref>].
<table-wrap id="Tab2"><label>Table 2</label><caption><p>Dynamic parameters of the STS exoskeleton with all leg lengths set to <italic>L</italic>=0.42<italic>m</italic></p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">part</th><th align="left">mass</th><th align="left">center of mass (x,y) w.r.t. joint</th><th align="left">rotational inertia</th></tr></thead><tbody><tr><td align="left">left foot</td><td align="left">1.21<italic>kg</italic></td><td align="left">(0.09217,&#x02212;0.0690)<italic>m</italic></td><td align="left">0.00849<italic>kg</italic><italic>m</italic><sup>2</sup></td></tr><tr><td align="left">left lower leg</td><td align="left">1.88<italic>kg</italic></td><td align="left">(0.1883,0.0109)<italic>m</italic></td><td align="left">0.0105<italic>kg</italic><italic>m</italic><sup>2</sup></td></tr><tr><td align="left">left upper leg</td><td align="left">2.53<italic>kg</italic></td><td align="left">(0.2268,0.0088)<italic>m</italic></td><td align="left">0.01529<italic>kg</italic><italic>m</italic><sup>2</sup></td></tr><tr><td align="left">right foot</td><td align="left">1.19<italic>kg</italic></td><td align="left">(0.09121,&#x02212;0.0686)<italic>m</italic></td><td align="left">0.00792<italic>kg</italic><italic>m</italic><sup>2</sup></td></tr><tr><td align="left">right lower leg</td><td align="left">1.96<italic>kg</italic></td><td align="left">(0.1826,&#x02212;0.0067)<italic>m</italic></td><td align="left">0.0118<italic>kg</italic><italic>m</italic><sup>2</sup></td></tr><tr><td align="left">right upper leg</td><td align="left">2.47<italic>kg</italic></td><td align="left">(0.2301,0.0152)<italic>m</italic></td><td align="left">0.01568<italic>kg</italic><italic>m</italic><sup>2</sup></td></tr><tr><td align="left">pelvis</td><td align="left">1.59<italic>kg</italic></td><td align="left">(0.113,&#x02212;0.072)<italic>m</italic></td><td align="left">0.0072<italic>kg</italic><italic>m</italic><sup>2</sup></td></tr></tbody></table></table-wrap></p><p>Most exoskeletons that have assisted sit-to-stand motion focus on paraplegic patients [<xref ref-type="bibr" rid="CR51">51</xref>] [<xref ref-type="bibr" rid="CR52">52</xref>] or focus on gravity compensation of the person [<xref ref-type="bibr" rid="CR53">53</xref>]. Nakamura et al. [<xref ref-type="bibr" rid="CR53">53</xref>] showed a reduction in human EMG when they assisted with a simplified human model to compensate part of the human weight. The MIRAD exoskeleton is intended for people who still have voluntary motion capabilities, and uses the model-based torque control presented in the Methods section. The modelling procedure in Table&#x000a0;<xref rid="Tab1" ref-type="table">1</xref> is illustrated on the STS activity.</p><sec id="Sec7"><title>Modelling Step 1: List sensor data available to the exoskeleton controller</title><p>The following measured variables are available to the exoskeleton controller: 
<list list-type="bullet"><list-item><p>relative rotary encoders measure all joint angles <italic>&#x003d5;</italic><sub><italic>i</italic></sub>,</p></list-item><list-item><p>the joint angular velocity <inline-formula id="IEq21"><alternatives><tex-math id="M69">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {\phi }_{i}$\end{document}</tex-math><mml:math id="M70"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003d5;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq21.gif"/></alternatives></inline-formula> of each joint is obtained by counting the number of high frequency clock pulses between two encoder pulses,</p></list-item><list-item><p>absolute encoders measure the lever arm angles <italic>&#x003b8;</italic><sub><italic>i</italic></sub>,</p></list-item><list-item><p>hall sensors measure the lever arm angular velocities <inline-formula id="IEq22"><alternatives><tex-math id="M71">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {\theta }_{i}$\end{document}</tex-math><mml:math id="M72"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq22.gif"/></alternatives></inline-formula>,</p></list-item><list-item><p>an IMU of Xsens placed at the pelvis returns the floating base angle <italic>&#x003c8;</italic>, its derivative <inline-formula id="IEq23"><alternatives><tex-math id="M73">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {\psi }$\end{document}</tex-math><mml:math id="M74"><mml:mover accent="true"><mml:mrow><mml:mi>&#x003c8;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq23.gif"/></alternatives></inline-formula> and the accelerations <italic>a</italic><sub><italic>x</italic></sub> and <italic>a</italic><sub><italic>y</italic></sub> at the sensor location, which are related to <inline-formula id="IEq24"><alternatives><tex-math id="M75">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\ddot {p}_{x}$\end{document}</tex-math><mml:math id="M76"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq24.gif"/></alternatives></inline-formula> and <inline-formula id="IEq25"><alternatives><tex-math id="M77">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\ddot {p}_{y}$\end{document}</tex-math><mml:math id="M78"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>p</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>y</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq25.gif"/></alternatives></inline-formula>,</p></list-item><list-item><p>a second IMU at the sternum monitors the human trunk.</p></list-item></list></p><p>The kinematic constraints in Eq. (<xref rid="Equ3" ref-type="">3</xref>) and (<xref rid="Equ4" ref-type="">4</xref>) enable us to estimate the floating base states and derivatives from the joint angle measurements. However, small deflections out of the 2D plane and noise on higher derivatives of the joint angles, make the floating base derivatives unreliable. Furthermore, the exoskeleton requires at least one absolute measurement to know its orientation in the world. Therefore, an IMU placed at the pelvis provides this additional information. The IMU measurements are fused together with the floating base estimates based on the kinematic constraints. This is done by considering all the IMU measurements and the kinematic constraint estimates as inputs of a Kalman filter with a constant acceleration motion model. The accelerations of the joint angles <inline-formula id="IEq26"><alternatives><tex-math id="M79">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\ddot {\phi _{i}}$\end{document}</tex-math><mml:math id="M80"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>&#x003d5;</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq26.gif"/></alternatives></inline-formula> and lever arm angles <inline-formula id="IEq27"><alternatives><tex-math id="M81">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\ddot {\theta }_{i}$\end{document}</tex-math><mml:math id="M82"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq27.gif"/></alternatives></inline-formula> are obtained also by relying on a Kalman Filter for each joint with a constant acceleration motion model.</p></sec><sec id="Sec8"><title>Modelling Step 2: Determine contact situations</title><p>The STS activity is characterized by two different contact situations: contact and no contact with the stool, as shown by Fig.&#x000a0;<xref rid="Fig7" ref-type="fig">7</xref>. In the first case, the exoskeleton has three contacts with the environment: both feet at the ground and the pelvis and upper limbs at the stool. In the second case, only the feet still touch the ground. Seat-off is defined by the instance at which the exoskeleton and person no longer touch the stool and it separates the two contact situations.
<fig id="Fig7"><label>Fig. 7</label><caption><p>Different contact situation of the sit-to-stand motion. In the sit-to-stand motion, seat-off is the key event for modelling. In the sit state, the exoskeleton is supported by the stool and only the inertial, centrifugal and Coriolis terms are compensated for (only the trunk can move). In the stand state, the exoskeleton is no longer supported by the stool and needs to support its own gravity</p></caption><graphic xlink:href="12984_2019_526_Fig7_HTML" id="MO7"/></fig></p><p>The two different contact situations are directly related to two discrete states, the sit state and the stand state, in the FSM of the mid-level controller in Fig.&#x000a0;<xref rid="Fig8" ref-type="fig">8</xref>. The sit state and stand state are accompanied by two additional states for transition between the contact states: a standing-up state and a sitting-down state. The implementation of the action at each state depends on the modelling of the contact situations and follows in step 4. A separate FSM in the standing-up state allows to independently start and stop the assistance. The transition between states is triggered by events, as shown by the arrows in Fig.&#x000a0;<xref rid="Fig8" ref-type="fig">8</xref>.
<fig id="Fig8"><label>Fig. 8</label><caption><p>Mid-level controller of the exoskeleton. The Finite State Machine of the sit-to-stand motion has four main states: sit, stand, standing-up and sitting-down. Four events trigger the change from state to state. In the sit state only the inertial and Coriolis compensation of the exoskeleton is active. In the standing-up state, the gravity compensation is gradually turned on before the seat-off. When the compensation gets one or when the seat-off is detected, the gravity compensation is completely on. When the event to start the assistance is detected, the assistance is switched to active. In the stand state the exoskeleton is completely compensated. In the sitting-down state, gravity compensation is gradually reduced to zero until the person sits back on the stool</p></caption><graphic xlink:href="12984_2019_526_Fig8_HTML" id="MO8"/></fig></p></sec><sec id="Sec9"><title>Modelling Step 3: Detect and predict contact transitions</title><p>The events that change the state of the FSM are presented in Table&#x000a0;<xref rid="Tab3" ref-type="table">3</xref>. All these events are monitored or predicted by the high-level controller. The start of the STS motion is detected by looking at the velocity of the hip angle. When this hip velocity exceeds 14.3 deg/<italic>s</italic> (0.25 <italic>rad</italic>/<italic>s</italic>) the STS motion starts. Other events are explained in Table&#x000a0;<xref rid="Tab3" ref-type="table">3</xref>. The seat-off event is predicted using statistical methods and is described in more detail in the work of Tanghe et al. [<xref ref-type="bibr" rid="CR54">54</xref>]. Briefly explained, a statistical model is constructed relying on measurements of hip, knee and ankle angles during STS motions of non-disable persons without exoskeleton. During these STS movements in the lab, a force plate underneath the stool measured the ground reaction forces. The force plate data was the ground truth for the seat-off event, but this information is not available for the exoskeleton controller. The hip angles were found to hold most information to predict the seat-off event. A method to detect the start of assistance based on Artificial Neural Networks (ANN) is also presented in their work. All predictions and estimations rely on joint measurements, as sensors to detect contact with the stool are not available. Only the joint angles related to stand <italic>q</italic><sub><italic>i,s</italic><italic>t</italic><italic>a</italic><italic>n</italic><italic>d</italic></sub> for determining the end of the STS motion are tuned for each person individually. This is done by capturing these angles when the person is standing upright before the experiments start. All other parameters are generalized and thus used for all participants.
<table-wrap id="Tab3"><label>Table 3</label><caption><p>High-level controller: event detection/prediction</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">event</th><th align="left">detection/prediction</th></tr></thead><tbody><tr><td align="left">e_start_sit_to_stand</td><td align="left">
<inline-formula id="IEq28"><alternatives><tex-math id="M83">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {q}_{hip} &#x0003e; 14.3 \deg /s$\end{document}</tex-math><mml:math id="M84"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">hip</mml:mtext></mml:mrow></mml:msub><mml:mo>&#x0003e;</mml:mo><mml:mn>14.3</mml:mn><mml:mo>deg</mml:mo><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq28.gif"/></alternatives></inline-formula>
</td></tr><tr><td align="left">predict seat-off time <italic>t</italic><sub><italic>so</italic></sub></td><td align="left"><italic>t</italic><italic>@</italic> max(<italic>q</italic><sub><italic>h</italic><italic>i</italic><italic>p,p</italic><italic>r</italic><italic>e</italic><italic>d</italic><italic>i</italic><italic>c</italic><italic>t</italic><italic>e</italic><italic>d</italic></sub>)</td></tr><tr><td align="left">e_seatoff_detected</td><td align="left">max(<italic>q</italic><sub><italic>h</italic><italic>i</italic><italic>p,b</italic><italic>u</italic><italic>f</italic><italic>f</italic><italic>e</italic><italic>r</italic><italic>e</italic><italic>d</italic></sub>[<italic>t</italic>])== max(<italic>q</italic><sub><italic>h</italic><italic>i</italic><italic>p,b</italic><italic>u</italic><italic>f</italic><italic>f</italic><italic>e</italic><italic>r</italic><italic>e</italic><italic>d</italic></sub>[<italic>t</italic> + 1])</td></tr><tr><td align="left">e_detect_start_assistance</td><td align="left"><italic>t</italic><sub><italic>so</italic></sub>&#x02212;<italic>t</italic><sub><italic>current</italic></sub>&#x0003c;0.11<italic>s</italic> or ANN [<xref ref-type="bibr" rid="CR54">54</xref>]</td></tr><tr><td align="left">e_assistance_done</td><td align="left"><italic>&#x003c4;</italic><sub><italic>as</italic></sub>==0</td></tr><tr><td align="left">e_finish_sit_to_stand</td><td align="left"><italic>q</italic><sub><italic>i</italic></sub> close to <italic>q</italic><sub><italic>i,s</italic><italic>t</italic><italic>a</italic><italic>n</italic><italic>d</italic></sub></td></tr><tr><td align="left">e_start_stand_to_sit</td><td align="left"><italic>q</italic><sub><italic>knee</italic></sub>&#x0003c;&#x02212;28.6 deg and <inline-formula id="IEq29"><alternatives><tex-math id="M85">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {q}_{knee} &#x0003c; -17.2 \deg /s$\end{document}</tex-math><mml:math id="M86"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">knee</mml:mtext></mml:mrow></mml:msub><mml:mo>&#x0003c;</mml:mo><mml:mo>&#x02212;</mml:mo><mml:mn>17.2</mml:mn><mml:mo>deg</mml:mo><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq29.gif"/></alternatives></inline-formula></td></tr><tr><td align="left">e_seatdown_detected</td><td align="left"><italic>q</italic><sub><italic>knee</italic></sub>&#x0003c;&#x02212;68.8 deg</td></tr><tr><td align="left">e_finish_stand_to_sit</td><td align="left"><italic>q</italic><sub><italic>knee</italic></sub>&#x0003c;&#x02212;77.3 deg and <inline-formula id="IEq30"><alternatives><tex-math id="M87">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$|\dot {q}_{knee}| &#x0003c; 5.7 \deg /s$\end{document}</tex-math><mml:math id="M88"><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">knee</mml:mtext></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:mo>&#x0003c;</mml:mo><mml:mn>5.7</mml:mn><mml:mo>deg</mml:mo><mml:mo>/</mml:mo><mml:mi>s</mml:mi></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq30.gif"/></alternatives></inline-formula></td></tr><tr><td align="left">e_error</td><td align="left">any encoder, controller or prediction error</td></tr></tbody></table></table-wrap></p></sec><sec id="Sec10"><title>Modelling Step 4: Model the exoskeleton for each situation</title><p>The dynamic model for the exoskeleton is a floating base model in both contact situations. In both cases, we assume that both feet stay in contact with the ground, hence no foot is lifted or moved. The contact Jacobian and contact wrench of the feet are constructed with the contact location at the heel. As each foot is also assumed flat on the ground, the contact wrench of each foot consists of two forces and one moment. These contact wrenches cannot be solved with the three floating base equations alone. An optimization based on the stiffness of the exoskeleton [<xref ref-type="bibr" rid="CR44">44</xref>] is used to solve the six contact wrench components, as described in the Methods section. As the stool contact is both hard to locate and measure, it is modelled by introducing gain parameters in the dynamics, see Eq. (<xref rid="Equ10" ref-type="">10</xref>). When the exoskeleton and human are seated, the stool supports almost all the weight. Hence, the exoskeleton model is a floating base model without gravity by setting <italic>&#x003b2;</italic><sub><italic>g</italic></sub> to 0. When the stool contact is broken, the exoskeleton is required to compensate its own weight and the gain <italic>&#x003b2;</italic><sub><italic>g</italic></sub> is set to 1.</p><p>The exoskeleton gravity compensation gain <italic>&#x003b2;</italic><sub><italic>g</italic></sub> should not be turned on and off instantaneously. From measurements of the human-stool interaction forces we know that the reaction force on the stool decreases almost linearly, starting approximately 0.3s before seat-off until seat-off [<xref ref-type="bibr" rid="CR54">54</xref>]. Hence, the model of the exoskeleton has to change linearly from a model without gravity at 0.3s before seat-off to a model with full gravity at seat-off, i.e. the exoskeleton gravity compensation gain <italic>&#x003b2;</italic><sub><italic>g</italic></sub> needs to increase linearly from zero to one in approximately 0.3s. This linear increase of <italic>&#x003b2;</italic><sub><italic>g</italic></sub> is implemented in the standing-up state in Fig.&#x000a0;<xref rid="Fig8" ref-type="fig">8</xref>. The increase in <italic>&#x003b2;</italic><sub><italic>g</italic></sub> is made dependent of the time until the current predicted seat-off: <italic>&#x003b2;</italic><sub><italic>g</italic></sub>=1&#x02212;<italic>t</italic><sub><italic>untillseat</italic>&#x02212;<italic>o</italic><italic>f</italic><italic>f,p</italic><italic>r</italic><italic>e</italic><italic>d</italic><italic>i</italic><italic>c</italic><italic>t</italic><italic>e</italic><italic>d</italic></sub>/0.3<italic>s</italic> when <italic>t</italic><sub><italic>untillseat</italic>&#x02212;<italic>o</italic><italic>f</italic><italic>f,p</italic><italic>r</italic><italic>e</italic><italic>d</italic><italic>i</italic><italic>c</italic><italic>t</italic><italic>e</italic><italic>d</italic></sub>&#x0003e;0.3<italic>s</italic>, with <italic>t</italic><sub><italic>untillseat</italic>&#x02212;<italic>o</italic><italic>f</italic><italic>f,p</italic><italic>r</italic><italic>e</italic><italic>d</italic><italic>i</italic><italic>c</italic><italic>t</italic><italic>e</italic><italic>d</italic></sub> is the predicted time until seat-off. This ensures that the exoskeleton gravity compensation is built up faster when the seat-off is reached faster. This shows the importance of the two additional states standing-up and sitting-down in the FSM. The gain <italic>&#x003b2;</italic><sub><italic>g</italic></sub> used to switch the contact model is shown in the FSM.</p></sec><sec id="Sec11"><title>Overview of the low-level controller</title><p>Figure&#x000a0;<xref rid="Fig9" ref-type="fig">9</xref> gives an overview of the continuous control loops for the STS exoskeleton. The focus lies on the actuator and low-level controllers, as the mid-level and high-level controllers are already shown in Fig.&#x000a0;<xref rid="Fig8" ref-type="fig">8</xref> and Table&#x000a0;<xref rid="Tab3" ref-type="table">3</xref> respectively. The control loops are shown for an exoskeleton with velocity controlled SEAs. In the low-level controller the dynamic model generates the spring torque <bold><italic>&#x003c4;</italic></bold><sub><italic>dyn</italic></sub> required to compensate the exoskeleton dynamics. The inertial and Coriolis and centrifugal parts of the dynamics are only partially compensated by setting <italic>&#x003b2;</italic><sub><italic>in</italic></sub> to a constant gain of 0.75. A full dynamic compensation of the exoskeleton is not feasible due to modelling errors, filtering delays, closure of the loop with measured variables and the play in the Maccepa actuators around zero torque. The joints are filtered with independent constant acceleration Kalman filters.
<fig id="Fig9"><label>Fig. 9</label><caption><p>Overview of the exoskeleton controllers. The control loops of the exoskeleton are given. The actuator controller is a velocity controller of the motor angle <bold><italic>&#x003b8;</italic></bold>. The input of this actuator controller comes from the low-level controller: the desired velocity and the velocity feedforward. Both signals use the dynamic model and the model of the spring. The feedforward <inline-formula id="IEq31"><alternatives><tex-math id="M89">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {\boldsymbol {\theta }}_{ff}$\end{document}</tex-math><mml:math id="M90"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ff</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq31.gif"/></alternatives></inline-formula> is obtained from Eq. (<xref rid="Equ13" ref-type="">13</xref>-<xref rid="Equ14" ref-type="">14</xref>)</p></caption><graphic xlink:href="12984_2019_526_Fig9_HTML" id="MO9"/></fig></p><p>The spring torques of the exoskeleton dynamics compensation <bold><italic>&#x003c4;</italic></bold><sub><italic>dyn</italic></sub> are combined with the assistance torques <bold><italic>&#x003c4;</italic></bold><sub><italic>assist</italic></sub> to give the desired joint torques <bold><italic>&#x003c4;</italic></bold><sub><italic>des</italic></sub>. These torques <bold><italic>&#x003c4;</italic></bold><sub><italic>des</italic></sub> are transformed to desired motor angle <bold><italic>&#x003b8;</italic></bold><sub><italic>des</italic></sub> inputs for each actuator controller, using Eqs. (<xref rid="Equ7" ref-type="">7</xref>-<xref rid="Equ9" ref-type="">9</xref>) in the low-level controller. This is followed by a closed-loop proportional position control (orange) with a gain <italic>P</italic> of 10<italic>s</italic><sup>&#x02212;1</sup>, which results in a position bandwidth around 1.6Hz. This low gain keeps the system conservatively stable under the changing inertia of the non-linear exoskeleton dynamics and under the non-linear spring. To make up for the low position bandwidth, velocity feedforward <inline-formula id="IEq32"><alternatives><tex-math id="M91">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\dot {\boldsymbol {\theta }}_{ff}$\end{document}</tex-math><mml:math id="M92"><mml:msub><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x002d9;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">ff</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq32.gif"/></alternatives></inline-formula> is introduced using Eqs. (<xref rid="Equ13" ref-type="">13</xref>-<xref rid="Equ14" ref-type="">14</xref>). The signal enters the velocity control loop as the motor current control is not accessible. The feedforward, which relies on measured variables in this STS motion, is set to 90%, to prevent instability. Also, the third order derivative of position <bold><italic>q</italic></bold><italic>...</italic> of Eq. (<xref rid="Equ14" ref-type="">14</xref>) is not considered due to the high influence of noise on higher derivatives.</p></sec></sec><sec id="Sec12"><title>Experiments and Results</title><p>We validated the exoskeleton dynamics compensation controller on non-disabled individuals. If the model-based compensation of the exoskeleton dynamics is successful, there should be no difference between muscle effort during STS when no exoskeleton is worn and when the exoskeleton, controlled for near-full (<italic>&#x003b2;</italic><sub><italic>in</italic></sub>= 0.75) exoskeleton dynamics compensation, is worn. Ideally, this compensation of the exoskeleton dynamics should be 1 (100%), but could not be attained in practise. Also the human kinematics and dynamics should be similar in both cases. In addition, we also verified how well the torque controller was able to deliver the demanded spring torque. The stand-to-sit motion was not analysed in depth, because we focused on standing up. No walker or any other support was used during the STS experiments.</p><sec id="Sec13"><title>Participants</title><p>The exoskeleton was tested on 15 young adults (10 males, 5 females, 26.4&#x000b1;3.3 years, 71.3&#x000b1;9.2<italic>kg</italic>). The participants had no prior experience with exoskeletons. The exoskeleton link lengths were adjusted to each participant and the exoskeleton joints were aligned with the participant&#x02019;s joints. All subjects gave informed consent in accordance to the ethical committee of UZ Leuven before participating in the study.</p></sec><sec id="Sec14"><title>Assistance</title><p>The provided assistance torques are additional torques in addition to the exoskeleton dynamics compensation torques. As the non-disabled participants do not need this assistance, the goal of the assistance is to reduce the contribution of the participants compared to the case when no assistance is given. The assistance is an off-line computed assistance-as-needed (AAN) torque. Hence, this was a precomputed torque profile that was given as assistance in the assistance-as-needed condition. The start of the off-line generated assistance was learnt using artificial neural networks [<xref ref-type="bibr" rid="CR54">54</xref>]. These neural networks learned to map the start of assistance on the human torques needed during standing up. The network was trained on data from the initial tests on several volunteers to only predict when the off-line generated assistance needed to start. Training the network on several persons allowed to use the network on multiple participants without having to calibrate for every individual. However, when the motion deviates a lot from the demonstrated motions (elderly or disabled), the neural network needs retraining.</p><p>To compute this assistance, data from an earlier study [<xref ref-type="bibr" rid="CR30">30</xref>] was used. Marker data of several participants of this study was used to scale musculoskeletal models in OpenSim 3.2 [<xref ref-type="bibr" rid="CR55">55</xref>]. To simulate muscle weakness, the muscles were artificially weakened in the musculoskeletal models. The same kinematics and force plate data was applied to the models. Because of the muscle weakening, the models were no longer able to generate the required torques to perform the recorded motion in simulation. Subtracting the simulated muscle-generated torques from the required torques, prescribed by the human dynamics, leads to the assistance-as-needed torques. Eventually, this should be calculated on-line while moving with the exoskeleton. However, in these first experiments, these calculation were simulated off-line and averaged over the seven non-disabled participants of the earlier study.</p></sec><sec id="Sec15"><title>Protocol</title><p>Each participant came once to the measurement lab for the full experimental protocol. The measurement involved standing up from and sitting down on a stool, set to 100% knee height. Each STS movement (with or without exoskeleton) was characterized as follows. The participant was instructed to wait for a verbal signal before standing up. After the verbal signal the participant could choose freely when to stand up at a self selected speed, but was requested to do so fluently. After the participant was standing, he was instructed to sit down after approximately three seconds.</p><p>Four different conditions were analysed: condition <bold>without exoskeleton N</bold>, <bold>passive P</bold> condition (exoskeleton is unpowered), <bold>transparent T</bold> condition (exoskeleton is compensated, no assistance) and off-line <bold>assistance-as-needed A</bold> condition, always performed in that order. The passive condition was evaluated to Because adjusting the exoskeleton to the participant and putting on the exoskeleton takes almost half an hour, the motions without exoskeleton were always performed first. The participant had to stand up and sit down five times in condition <bold>N</bold>. Next, the exoskeleton was put on and the exoskeleton IMU sensors were calibrated. For each exoskeleton condition, 21 motions were performed, of which the first, middle and last three were recorded. This way, we could analyse if the user would require some time to adapt to the control method in each condition. However, a required adaptation time was not perceived. In this paper, only the last three motions of each condition were used. Between each exoskeleton condition, a short break of 5min. was introduced to prevent fatigue and to let the participant fill out a questionnaire.</p></sec><sec id="Sec16"><title>Kinematics and kinetics</title><p>To validate the exoskeleton controller, the motions of the participant and exoskeleton were recorded with a reflective marker motion capture system consisting of ten cameras (Vicon Motion Systems, Oxford Metrics, UK) sampled at 100Hz. A total of 34 markers were placed on bony landmarks of the participant. In addition, clusters with three markers were placed on lower and upper arms and upper legs, and a head band with four markers was worn by the participant. In the exoskeleton condition, the markers on the participant&#x02019;s pelvis were removed due to incompatibility with the exoskeleton pelvis module. Four markers placed on the exoskeleton pelvis module were used to locate the participant&#x02019;s pelvis.</p><p>Three force plates (AMTI, Waterworn, USA) placed under both feet and a stool respectively captured the ground reaction forces at a sample frequency of 1000Hz. The way the force plates were set up in the lab prevented the participants from placing their feet in a self-selected position. As a result, the right leg was placed slightly more outward compared to a self-selecting <italic>normal</italic> sitting position. Attention was paid to make sure the feet were placed in the same positions in every condition. Placing the feet in a non self-selected position might have an impact on the kinematics, torques and muscle usage. Because the foot placement was kept the same for every condition, any deviation due to a non self-selected foot placement is present in every measured condition. In addition, the data used for the off-line assistance torques [<xref ref-type="bibr" rid="CR30">30</xref>] was also recorded with the same foot placement.</p><p>All marker data and force plate data were low-pass second order Butterworth filtered with zero-phase lag at 6Hz. Inverse kinematics of the marker data resulted in the joint kinematics using OpenSim 3.2. A participant model was created by scaling the standard OpenSim generic_92_23 model to the weight and size of the participant. The exoskeleton dynamic model was added to this scaled participant model. The inverse dynamics were calculated in OpenSim 3.2 using this total model, the calculated joint kinematics and force plate data. This resulted in the total joint torques of both participant and exoskeleton. The marker and force plate data were synchronized with the exoskeleton data, which was recorded at 500Hz. This allowed to subtract the exoskeleton torque contribution (Eq. (<xref rid="Equ7" ref-type="">7</xref>)) from the total joint torques to give the participant&#x02019;s joint torques.</p></sec><sec id="Sec17"><title>Electromyography</title><p>The different control conditions were also compared by looking at muscle usage. We measured surface electromyography (EMG) signals of the rectus femoris (RF), vastus lateralis (VL), biceps femoris (BF), medial hamstrings (MH), tibialis anterior (TA), gastrocnemius lateralis (GL), soleus (So) and vastus medialis (VM) bilaterally. The self-adhesive electrodes were placed two centimetres apart and in the fibre direction on the belly of each muscle in accordance with the Seniam guidelines [<xref ref-type="bibr" rid="CR56">56</xref>]. EMG signals of the 14 muscles were sampled at 1000 Hz using a wireless EMG system (ZeroWire, Aurion). The raw EMG signals were band pass filtered between 20 and 400Hz with a second order Butterworth filter. The signal was then rectified and low pass filtered at 10Hz with a second order Butterworth filter. The EMG processing is done according to the Seniam guidelines [<xref ref-type="bibr" rid="CR56">56</xref>] The muscle effort was approximated by the time integral of the rectified and filtered EMG values during the STS motion. Since there was a resting period between the measured conditions, the EMG was not corrected for fatigue between conditions.</p></sec><sec id="Sec18"><title>Statistics</title><p>The relative change in muscle effort in the passive condition compared to the transparent condition and in the condition without exoskeleton compared to the transparent condition was evaluated with a Wilcoxon Signed Rank Test [<xref ref-type="bibr" rid="CR57">57</xref>]. The statistical tests of the 14 muscles are one family of tests. Hence, p-values of the muscles tests were corrected for multiple comparisons with Bonferroni-Holm [<xref ref-type="bibr" rid="CR58">58</xref>] correction. The 14 p-values from comparing two conditions are ordered from low to high. The p-value on rank <italic>i</italic> is Bonferroni corrected for 14&#x02212;<italic>i</italic>+1 tests (<italic>p</italic><sub><italic>B</italic><italic>o</italic><italic>n</italic><italic>f</italic><italic>e</italic><italic>r</italic><italic>r</italic><italic>o</italic><italic>n</italic><italic>i,i</italic></sub>=(14&#x02212;<italic>i</italic>+1)&#x000d7;<italic>p</italic>) and compared to the significance level (here 0.05). When the Bonferroni corrected p-value of rank <italic>i</italic> is not significant, the test stops and all following p-values (<italic>i</italic>+1 to 14) are also not significant. There are three families of muscle tests: passive, transparent and without exoskeleton. The multiple testing of the three conditions is corrected by a simple Bonferroni correction by multiplying all p-values by 3.</p><p>To compare the human joint angles and torques between the different conditions, a one dimensional Statistical Parametric Mapping (SPM) Friedman&#x02019;s ANOVA was used [<xref ref-type="bibr" rid="CR59">59</xref>]. This method also corrects for multiple tests. When significance was reached, a post-hoc test was needed to find between which groups the differences were significant. This is done with a two-sample t-test between the combination of conditions N vs T and P vs T, again correcting for multiple testing.</p></sec><sec id="Sec19"><title>Results</title><p>The main objective of the experiments was to show the effectiveness of the model-based compensation of the exoskeleton dynamics. Therefore, the muscle efforts of fourteen muscles were compared in Fig.&#x000a0;<xref rid="Fig10" ref-type="fig">10</xref>. Especially the quadriceps muscles, of which the vastus medialis, vastus lateralis and the rectus femoris were measured, contribute to the STS motion. Eight out of the fourteen muscles required significantly (Bonferroni-Holm corrected p &#x0003c;0.05) more effort in the passive condition P relative to the transparent condition T, as Fig.&#x000a0;<xref rid="Fig10" ref-type="fig">10</xref>a and Table&#x000a0;<xref rid="Tab4" ref-type="table">4</xref> show. All of the recorded quadriceps muscles (RF, VL and VM) showed significant difference. In contrast, in the muscle effort of the condition without exoskeleton N compared to condition T, no significant differences were detected in any muscle, as Table&#x000a0;<xref rid="Tab5" ref-type="table">5</xref> and Fig.&#x000a0;<xref rid="Fig10" ref-type="fig">10</xref>b show.
<fig id="Fig10"><label>Fig. 10</label><caption><p>Comparison of muscle effort in three conditions: passive, transparent and without exoskeleton. The average muscle effort (time integral of the muscle activity) is shown relative to the transparent condition by the gray bars and the corresponding standard deviation across all fifteen participants is shown by the error bars. Each muscle is scaled separately relative to the corresponding average muscle effort in the transparent condition. The black dotted line represents this relative muscle activity in the transparent condition, scaled to one. In the left subfigure (a) the muscle effort of the passive condition is compared to the transparent condition. In the right subfigure (b) the effort of the condition without exoskeleton is compared to the transparent condition. When the plotted bars and error bars lie above one, the muscle effort is larger than in the transparent condition. Significant differences between the without exoskeleton and transparent condition are marked with a black star (<italic>p</italic><sub><italic>Bonferroni</italic>&#x02212;<italic>Holm</italic></sub>&#x0003c;0.05)</p></caption><graphic xlink:href="12984_2019_526_Fig10_HTML" id="MO10"/></fig>
<table-wrap id="Tab4"><label>Table 4</label><caption><p>Bonferroni-Holm corrected p-values P vs T</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">left muscle</th><th align="left">corrected p-value</th><th align="left">uncorrected p-value</th><th align="left">right muscle</th><th align="left">corrected p-value</th><th align="left">uncorrected p-value</th></tr></thead><tbody><tr><td align="justify">BF L</td><td align="justify">0.7632</td><td align="justify">0.1272</td><td align="justify">BF R</td><td align="justify">0.0945</td><td align="justify">0.0052</td></tr><tr><td align="justify">GL L</td><td align="justify">0.0293</td><td align="justify">0.0012</td><td align="justify">GL R</td><td align="justify">0.3926</td><td align="justify">0.0327</td></tr><tr><td align="justify">MH L</td><td align="justify">0.7632</td><td align="justify">0.1272</td><td align="justify">MH R</td><td align="justify">0.4449</td><td align="justify">0.0494</td></tr><tr><td align="justify">RF L</td><td align="justify">0.0051</td><td align="justify">0.0001</td><td align="justify">RF R</td><td align="justify">0.0293</td><td align="justify">0.0012</td></tr><tr><td align="justify">TA L</td><td align="justify">0.1465</td><td align="justify">0.0098</td><td align="justify">TA R</td><td align="justify">0.0081</td><td align="justify">0.0002</td></tr><tr><td align="justify">VL L</td><td align="justify">0.0081</td><td align="justify">0.0002</td><td align="justify">VL R</td><td align="justify">0.0051</td><td align="justify">0.0001</td></tr><tr><td align="justify">VM L</td><td align="justify">0.0073</td><td align="justify">0.0002</td><td align="justify">VM R</td><td align="justify">0.0048</td><td align="justify">0.0001</td></tr></tbody></table></table-wrap>
<table-wrap id="Tab5"><label>Table 5</label><caption><p>Bonferroni-Holm corrected p-values N vs T</p></caption><table frame="hsides" rules="groups"><thead><tr><th align="left">left muscle</th><th align="left">corrected p-value</th><th align="left">uncorrected p-value</th><th align="left">right muscle</th><th align="left">corrected p-value</th><th align="left">uncorrected p-value</th></tr></thead><tbody><tr><td align="justify">BF L</td><td align="justify">1</td><td align="justify">1</td><td align="justify">BF R</td><td align="justify">1</td><td align="justify">0.1040</td></tr><tr><td align="justify">GL L</td><td align="justify">1</td><td align="justify">0.0494</td><td align="justify">GL R</td><td align="justify">1</td><td align="justify">0.3757</td></tr><tr><td align="justify">MH L</td><td align="justify">1</td><td align="justify">0.0923</td><td align="justify">MH R</td><td align="justify">1</td><td align="justify">0.6355</td></tr><tr><td align="justify">RF L</td><td align="justify">1</td><td align="justify">0.2412</td><td align="justify">RF R</td><td align="justify">1</td><td align="justify">0.1909</td></tr><tr><td align="justify">TA L</td><td align="justify">0.5333</td><td align="justify">0.0137</td><td align="justify">TA R</td><td align="justify">1</td><td align="justify">0.1272</td></tr><tr><td align="justify">VL L</td><td align="justify">1</td><td align="justify">0.0419</td><td align="justify">VL R</td><td align="justify">1</td><td align="justify">0.1531</td></tr><tr><td align="justify">VM L</td><td align="justify">0.3384</td><td align="justify">0.0081</td><td align="justify">VM R</td><td align="justify">1</td><td align="justify">0.0676</td></tr></tbody></table></table-wrap></p><p>To further examine the effectiveness of the transparent control, we compared human kinematics and joint torques of the hip, knee and ankle during the STS motions computed by SPM in Fig.&#x000a0;<xref rid="Fig11" ref-type="fig">11</xref>. The reference posture for the human joint kinematics (Fig.&#x000a0;<xref rid="Fig11" ref-type="fig">11</xref>a to <xref rid="Fig11" ref-type="fig">11</xref>c) is standing upright (zero angles). The comparison of kinematics between the transparent condition T in red and the passive condition P in black showed significant differences (<italic>p</italic><sub><italic>corrected</italic></sub>&#x0003c;0.05) in the hip (<italic>p</italic><sub><italic>corrected</italic></sub>=0.008) and knee (<italic>p</italic><sub><italic>corrected</italic></sub>&#x0003c;0.001) angle around 50% of the STS motion, indicated by a blue bar. This could be expected as in condition P, the hip (more flexion) and knee angle (more flexion) evolved slower to the angles of standing upright. No significant differences (<italic>p</italic><sub><italic>corrected</italic></sub>&#x0003e;0.05) were found in the kinematics between the condition T in red and condition without exoskeleton N in blue during STS. The human joint torques (Fig.&#x000a0;<xref rid="Fig11" ref-type="fig">11</xref>d to <xref rid="Fig11" ref-type="fig">11</xref>f) showed significant differences (<italic>p</italic><sub><italic>corrected</italic></sub>&#x0003c;0.05) between condition P and T in the hip (<italic>p</italic><sub><italic>corrected</italic></sub>=0.007) and knee torque (<italic>p</italic><sub><italic>corrected</italic></sub>&#x0003c;0.001), indicated by a green bar. In condition P, the external hip torque was more negative (more flexion torque) from 40 to 50% of the motion, while the external knee torque was significantly larger (more flexion torque) from 30 to 65% of the STS motion. No significant differences (<italic>p</italic><sub><italic>corrected</italic></sub>&#x0003e;0.05) were found in the hip, knee and ankle for condition T and condition N, during the STS motions.
<fig id="Fig11"><label>Fig. 11</label><caption><p>Comparison of human joint kinematics and dynamics in three conditions: passive, transparent and without exoskeleton. The human kinematics and joint torques of the hip, knee and ankle are shown in three conditions: without exoskeleton (N) in green, the transparent exoskeleton condition (T) in red and the passive exoskeleton condition (P) in black. The top three subfigures (a to c) represent the joint angles, while the lower three subfigures (d to f) represent the joint torques, normalized with respect to the mass of each participant. Both the average and standard deviation (band of &#x000b1;<italic>&#x003c3;</italic> are shown in each graph. The blue bars indicate time periods with a significant difference between the passive and transparent condition of the post-hoc two-sample t-test. The corrected p-values are 0.008, &#x0003c;0.001, 0.007 and &#x0003c;0.001 for the hip angle, knee angle, hip torque and knee torque respectively</p></caption><graphic xlink:href="12984_2019_526_Fig11_HTML" id="MO11"/></fig></p><p>As the focus is on the compensation of the exoskeleton, Fig.&#x000a0;<xref rid="Fig12" ref-type="fig">12</xref> shows the effectiveness of the torque control loop. The desired <bold><italic>&#x003c4;</italic></bold><sub><italic>d</italic><italic>e</italic><italic>s,s</italic><italic>p</italic><italic>r</italic></sub> and measured <inline-formula id="IEq33"><alternatives><tex-math id="M93">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\boldsymbol {\tau }}_{spr}$\end{document}</tex-math><mml:math id="M94"><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq33.gif"/></alternatives></inline-formula> spring torques of the hip, knee and ankle joints are compared in the transparent control condition T. The controller is able to track the desired <bold><italic>&#x003c4;</italic></bold><sub><italic>d</italic><italic>e</italic><italic>s,s</italic><italic>p</italic><italic>r</italic></sub> spring torques. This is also confirmed by the low torque errors <inline-formula id="IEq34"><alternatives><tex-math id="M95">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\boldsymbol {\tau }_{error} =(\boldsymbol {\tau }_{des,spr} - \widehat {\boldsymbol {\tau }}_{spr})$\end{document}</tex-math><mml:math id="M96"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">error</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq34.gif"/></alternatives></inline-formula> in Fig.&#x000a0;<xref rid="Fig12" ref-type="fig">12</xref>d to <xref rid="Fig12" ref-type="fig">12</xref>f.
<fig id="Fig12"><label>Fig. 12</label><caption><p>Exoskeleton transparent control evaluation. The joint torque analysis for the transparent condition is shown (condition T). The top three subfigures (a to c) show the joint torque for the hip, knee and ankle for one STS motion. The desired joint torque <bold><italic>&#x003c4;</italic></bold><sub><italic>d</italic><italic>e</italic><italic>s,s</italic><italic>p</italic><italic>r</italic></sub> is shown in blue. This desired spring torque is torque needed to compensate the exoskeleton. The measured spring torque <inline-formula id="IEq35"><alternatives><tex-math id="M97">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\boldsymbol {\tau }}_{spr}$\end{document}</tex-math><mml:math id="M98"><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq35.gif"/></alternatives></inline-formula> is represented in red. The torque to accelerate the motor inertia is given in yellow. Seat-off occurs at the black dashed line. The lower three subfigures (d to f) show the average error (difference) and the band of standard deviation (&#x000b1;<italic>&#x003c3;</italic>) between the desired <bold><italic>&#x003c4;</italic></bold><sub><italic>d</italic><italic>e</italic><italic>s,s</italic><italic>p</italic><italic>r</italic></sub> and the delivered <inline-formula id="IEq36"><alternatives><tex-math id="M99">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\boldsymbol {\tau }}_{spr}$\end{document}</tex-math><mml:math id="M100"><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq36.gif"/></alternatives></inline-formula> spring torques for all the STS motions of condition T</p></caption><graphic xlink:href="12984_2019_526_Fig12_HTML" id="MO12"/></fig></p><p>The results of Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref> show the desired and delivered torques at the hip, knee and ankle joint in the assistance-as-needed condition (A). During the largest part of the STS motion, the desired <bold><italic>&#x003c4;</italic></bold><sub><italic>d</italic><italic>e</italic><italic>s,s</italic><italic>p</italic><italic>r</italic></sub> in blue and measured (=delivered) <inline-formula id="IEq37"><alternatives><tex-math id="M101">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\boldsymbol {\tau }}_{spr}$\end{document}</tex-math><mml:math id="M102"><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq37.gif"/></alternatives></inline-formula> in red spring torque overlap in Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>a to <xref rid="Fig13" ref-type="fig">13</xref>c, and the average errors <inline-formula id="IEq38"><alternatives><tex-math id="M103">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\boldsymbol {\tau }_{error} =(\boldsymbol {\tau }_{des,spr} - \widehat {\boldsymbol {\tau }}_{spr})$\end{document}</tex-math><mml:math id="M104"><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">error</mml:mtext></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>(</mml:mo><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">des</mml:mtext><mml:mo>,</mml:mo><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>&#x02212;</mml:mo><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub><mml:mo>)</mml:mo></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq38.gif"/></alternatives></inline-formula> remain small in Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>d to <xref rid="Fig13" ref-type="fig">13</xref>f. However, the measured hip torque <inline-formula id="IEq39"><alternatives><tex-math id="M105">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\boldsymbol {\tau }}_{spr}$\end{document}</tex-math><mml:math id="M106"><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq39.gif"/></alternatives></inline-formula> is lower than the desired one <bold><italic>&#x003c4;</italic></bold><sub><italic>d</italic><italic>e</italic><italic>s,s</italic><italic>p</italic><italic>r</italic></sub> around seat-off in Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>a, which means the assistance is not given completely. This is also indicated by the large average error <bold><italic>&#x003c4;</italic></bold><sub><italic>error</italic></sub> in Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>d. At this location, the motor measured acceleration torque <inline-formula id="IEq40"><alternatives><tex-math id="M107">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\mathbf {B}}_{mot} {\widehat {\ddot {\boldsymbol {\theta }}}}$\end{document}</tex-math><mml:math id="M108"><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">mot</mml:mtext></mml:mrow></mml:msub><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq40.gif"/></alternatives></inline-formula> (in orange) of the hip is very high leading to saturation of the hip motor. In contrast, the knee torque is able to follow the desired torque around seat-off, which means the assistance is given completely. Important to note is that the required steep build-up of torque at the knee before seat-off is achieved by the controller.
<fig id="Fig13"><label>Fig. 13</label><caption><p>Exoskeleton joint torque control evaluation. The joint torque analysis for the offline assistance-as-needed is shown (condition A). The top three subfigures (a to c) show the joint torque for the hip, knee and ankle for one STS motion. The desired joint torque <bold><italic>&#x003c4;</italic></bold><sub><italic>d</italic><italic>e</italic><italic>s,s</italic><italic>p</italic><italic>r</italic></sub> is shown in blue. This desired spring torque is the sum of the exoskeleton dynamics compensation torque <bold><italic>&#x003c4;</italic></bold><sub><italic>dyn</italic></sub>, shown by the light blue curve, and the desired assistance indicated by the blue area between <bold><italic>&#x003c4;</italic></bold><sub><italic>dyn</italic></sub> and <bold><italic>&#x003c4;</italic></bold><sub><italic>d</italic><italic>e</italic><italic>s,s</italic><italic>p</italic><italic>r</italic></sub>. The realised spring torque <inline-formula id="IEq41"><alternatives><tex-math id="M109">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\boldsymbol {\tau }}_{spr}$\end{document}</tex-math><mml:math id="M110"><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq41.gif"/></alternatives></inline-formula> is represented in red. The torque to accelerate the motor inertia is given in yellow. Seat-off occurs at the black dashed line. The lower three subfigures (d to f) show the average error (difference) and the band of standard deviation (&#x000b1;<italic>&#x003c3;</italic>) between the desired and the delivered spring torques for all the STS motions of condition A</p></caption><graphic xlink:href="12984_2019_526_Fig13_HTML" id="MO13"/></fig></p></sec></sec><sec id="Sec20" sec-type="discussion"><title>Discussion</title><p>In order to compensate the exoskeleton dynamics, modelling the contacts of the exoskeleton with the environment are crucial. These contacts play a major role in the controller, as they largely affect the exoskeleton dynamics. Modelling these contacts is often not tackled but evaded by utilizing different dynamic models for every contact situation [<xref ref-type="bibr" rid="CR14">14</xref>] or changing the control strategy [<xref ref-type="bibr" rid="CR1">1</xref>, <xref ref-type="bibr" rid="CR7">7</xref>]. In this work, effort is put in modelling the contacts and using the same dynamic model (floating base) in the different contact situations.</p><p>The STS motion demonstrated the importance of good contact modelling: the stool contact changes, which greatly influenced the exoskeleton dynamics. While on the stool, the exoskeleton is supported and the actuators do not need to compensate the weight of the exoskeleton. The stool contact is modelled by setting the gravity of the exoskeleton to zero with gain <italic>&#x003b2;</italic><sub><italic>g</italic></sub>=0. When the exoskeleton leaves the stool, it needs to compensate its whole dynamics. All the weight of the exoskeleton is transferred to the exoskeleton feet and <italic>&#x003b2;</italic><sub><italic>g</italic></sub> is set to 1. The inertial term <italic>&#x003b2;</italic><sub><italic>in</italic></sub> was active in both contact situations. This allowed to also compensate the exoskeleton when the person moves his trunk forward while sitting on the stool. The distribution of the forces over both feet while not on the stool is performed with a model-based method [<xref ref-type="bibr" rid="CR44">44</xref>] that account for the stiffness of the exoskeleton.</p><p>Modelling all contact situations and relying on a floating base model makes the model-based exoskeleton compensation easier generalizable to other contact situations. Modelling the contact results in a limited number of gain factors to capture the change of the dynamics. Only one gain factor <italic>&#x003b2;</italic><sub><italic>g</italic></sub> models the stool contact in the two situations. The prescribed variation of <italic>&#x003b2;</italic><sub><italic>g</italic></sub> is directly linked to the change of the vertical ground reaction force when the stool contact changes [<xref ref-type="bibr" rid="CR54">54</xref>]. The difference with prescribing joint trajectories in impedance controllers [<xref ref-type="bibr" rid="CR3">3</xref>, <xref ref-type="bibr" rid="CR4">4</xref>] is that <italic>&#x003b2;</italic><sub><italic>g</italic></sub> is not a motion trajectory, but it is one parameter modelling the time variation of the gravity term of the exoskeleton. Furthermore, prescribing <italic>&#x003b2;</italic><sub><italic>g</italic></sub> is no longer needed when a low-cost pressure sensor would track the change of contact pressure at the stool. The change in pressure could be directly mapped on <italic>&#x003b2;</italic><sub><italic>g</italic></sub>.</p><p>In the passive condition (P), the human needed to move the exoskeleton as the controller was not actuating the exoskeleton motors. This is validated by a significant increase in hip and knee flexion torque to stand up in condition P, compared to transparent condition T (see Fig.&#x000a0;<xref rid="Fig11" ref-type="fig">11</xref>). Especially the human knee torque was larger in condition P, because the exoskeleton needed larger knee torques (see purple dashed line in Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>b). The analysis of muscle effort backs up this increase in joint torque in condition P. The quadriceps muscles, of which VM, VL and RF were measured, were significantly (Bonferroni-Holm corrected p &#x0003c;0.05) more recruited in condition P compared to condition T, as seen in Fig.&#x000a0;<xref rid="Fig10" ref-type="fig">10</xref>a and Table&#x000a0;<xref rid="Tab4" ref-type="table">4</xref>. The significant difference in joint kinematics between condition P and T around 50% of the STS motion can be explained by a slower first half of the STS motion in condition P.</p><p>In the transparent condition (T), the exoskeleton had to compensate its own dynamics, taking into account the changing stool contact. If the contact was modelled in the wrong way, such that the controller would compensate the exoskeleton too early or too late, significant differences in human joint torques and muscle effort was expected. However, no significant differences (<italic>p</italic><sub><italic>corrected</italic></sub>&#x0003e;0.05) were found for the joint torques or the muscle efforts between condition T and the condition without exoskeleton N. The uncorrected p-values of the muscle effort between conditions T and N are found in Table&#x000a0;<xref rid="Tab5" ref-type="table">5</xref>. These values illustrate the non-significance of the differences between N and T. This indicates the contact modelling of the stool using <italic>&#x003b2;</italic><sub><italic>g</italic></sub> is on time. Although the absence of significant differences does not prove statistical similarity between condition T and N, the human joint torques show great similarity in Fig.&#x000a0;<xref rid="Fig11" ref-type="fig">11</xref>. Evaluation of the control errors <bold><italic>&#x003c4;</italic></bold><sub><italic>error</italic></sub> in Fig.&#x000a0;<xref rid="Fig12" ref-type="fig">12</xref> d to Fig.&#x000a0;<xref rid="Fig12" ref-type="fig">12</xref>f indicates that the controller is able to track the desired spring torque to compensate the exoskeleton and provide assistance. Hence, the model-based controller seems to be able to compensate the exoskeleton dynamics.</p><p>Prior to the seat-off, a steep build-up of knee torque for the exoskeleton dynamics compensation and assistance is demanded in Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>b. This steep build-up of spring torque at the knee would be impossible by the SEA position control loop alone because it has a low bandwidth (see Subsection Overview of the low-level controller). The torque needs to be build up fast as in less than 0.3s after the seat-off prediction the peak torques at the knee have to be reached. The feedforward control command from Eqs. (<xref rid="Equ13" ref-type="">13</xref>-<xref rid="Equ14" ref-type="">14</xref>) is crucial to prevent tracking errors in the spring compression, which would result in less torque generated.</p><p>The error between the desired and measured knee torque right after the assistance (Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>b) and the large error at the hip torque around seat-off (Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>a) can be explained by motor saturation. The motor inertial torque <inline-formula id="IEq42"><alternatives><tex-math id="M111">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\mathbf {B}} {\widehat {\ddot {\boldsymbol {\theta }}}}$\end{document}</tex-math><mml:math id="M112"><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq42.gif"/></alternatives></inline-formula> and the measured spring torque <inline-formula id="IEq43"><alternatives><tex-math id="M113">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\boldsymbol {\tau }}_{spr}$\end{document}</tex-math><mml:math id="M114"><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq43.gif"/></alternatives></inline-formula> add up to about 15<italic>Nm</italic> which is the motor torque limit when overloading the motor. The high hip motor acceleration and high motor inertia, due to a high transmission ratio, led to a high motor inertial torque <inline-formula id="IEq44"><alternatives><tex-math id="M115">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\mathbf {B}} {\widehat {\ddot {\boldsymbol {\theta }}}}$\end{document}</tex-math><mml:math id="M116"><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq44.gif"/></alternatives></inline-formula> as shown in Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>a. This shows the importance of the transmission ratio in the design of the exoskeleton. The high motor inertial torque <inline-formula id="IEq45"><alternatives><tex-math id="M117">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\mathbf {B}} {\widehat {\ddot {\boldsymbol {\theta }}}}$\end{document}</tex-math><mml:math id="M118"><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold">B</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover><mml:mover accent="false"><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003b8;</mml:mi></mml:mrow><mml:mo>&#x000a8;</mml:mo></mml:mover></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq45.gif"/></alternatives></inline-formula> drained most of the available motor torque, preventing the spring torque <inline-formula id="IEq46"><alternatives><tex-math id="M119">\documentclass[12pt]{minimal}
				\usepackage{amsmath}
				\usepackage{wasysym} 
				\usepackage{amsfonts} 
				\usepackage{amssymb} 
				\usepackage{amsbsy}
				\usepackage{mathrsfs}
				\usepackage{upgreek}
				\setlength{\oddsidemargin}{-69pt}
				\begin{document}$\widehat {\boldsymbol {\tau }}_{spr}$\end{document}</tex-math><mml:math id="M120"><mml:msub><mml:mrow><mml:mover accent="false"><mml:mrow><mml:mi mathvariant="bold-italic">&#x003c4;</mml:mi></mml:mrow><mml:mo>&#x0005e;</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext mathvariant="italic">spr</mml:mtext></mml:mrow></mml:msub></mml:math><inline-graphic xlink:href="12984_2019_526_Article_IEq46.gif"/></alternatives></inline-formula> from reaching its desired value <bold><italic>&#x003c4;</italic></bold><sub><italic>d</italic><italic>e</italic><italic>s,s</italic><italic>p</italic><italic>r</italic></sub>. The motor saturation did not influence stability. The saturation only prevented to provide proper hip assistance even though the assistance was low (6Nm). When no assistance was needed (in condition T), no motor saturation occurred, as Fig.&#x000a0;<xref rid="Fig12" ref-type="fig">12</xref> shows. In order to overcome this saturation limit, the motor and transmission ratio should be redesigned to reduce the reflected motor inertia after transmission and/or to deliver higher torques.</p><p>The motor saturation indicates the importance of a proper motor and transmission design in the early design stages. To this end, not only the desired assistance but also the dynamics of the exoskeleton itself needs to be accounted for. Although the exact mechanical design of the exoskeleton might still be unknown in the early design stages, a rough estimate is needed to simulate the motor torques needed to move the exoskeleton based on human kinematics. In addition, the selection of motor and transmission have to be solved concurrently, as the transmission affects both the torque and the motor inertia presented at the joint level. The selected motor and transmission will affect the exoskeleton inertia and thus alter the torques needed to move the exoskeleton. Hence, an iterative design procedure will be needed where motor and transmission selection and exoskeleton dynamics simulation will have to be repeated until convergence to a valid solution.</p><p>The high standard deviation on the spring torque error <bold><italic>&#x003c4;</italic></bold><sub><italic>error</italic></sub> in Fig.&#x000a0;<xref rid="Fig13" ref-type="fig">13</xref>d to <xref rid="Fig13" ref-type="fig">13</xref>f is partially caused by the difficulty in defining the end of an STS motion. The STS motion ends when the person is standing upright. The joint angles need to be close to a defined set of angles related to standing and the joint velocities should be low. Because there is a difference in how fast the person executes the last part of the STS motion, the seat-off instance (where for example the hip torque error is largest) is occurring at slightly different normalized times for every participant. Therefore, the time normalized torque error curves show larger variance between subjects.</p><p>The study has three main limitations. First, the exoskeleton actuators (motor and transmission) were not able to assist the hip at the required dynamic profile, leading to motor saturation. Although compensation of the exoskeleton dynamics was possible, the motors were close to or at saturation and unable to deliver any higher assistance torques. Because the assistance was small, the assistance condition did not differ greatly from the transparent control control condition. Consequently, comparisons of muscle effort did not result in significant differences between the transparent and assisted conditions. These analysis are left out of the paper. Second, the control method was not directly compared to the impedance controller, which is a commonly used method in the literature. Such an impedance controller imposes a desired trajectory, which is difficult to provide in non-cyclic motions and while keeping the user in charge. Also, the detailed implementation of the impedance controllers is not documented in depth and these controllers have more gains that require tuning, which prevents an proper comparison. The third limitation is that only sit-to-stand motions were examined. In order to further validate the controller methodology to compensate the exoskeleton and model contacts with the ground, other tasks, such as walking, should be examined in the future.</p></sec><sec id="Sec21" sec-type="conclusion"><title>Conclusion</title><p>The present study proposed a model-based control to compensate the dynamics of a lower-limb exoskeleton. This control approach was tested and evaluated on an exoskeleton for sit-to-stand motions.</p><p>Compensating the dynamics of exoskeletons becomes important when they enter daily life where the user wants to be in charge. Controllers capable of compensating the exoskeleton rely on extensive modelling the exoskeleton and the contacts with the environment. These contacts play a major role in this controller, as they largely affect the exoskeleton dynamics. The sit-to-stand motion is a good example to demonstrate the importance of good contact modelling: the stool contact changes, which greatly influenced the exoskeleton dynamics. While on the stool, the exoskeleton is supported and the actuators do not need to compensate the weight of the exoskeleton. When the exoskeleton leaves the stool, it needs to compensate its whole dynamics.</p><p>To aid in developing such exoskeleton dynamics compensation controllers, a modelling procedure and control scheme are presented in this work. The control scheme breaks down the controller in four different control levels in support of the modelling steps. Starting from the dynamic model of the exoskeleton, the exoskeleton compensation controller is designed. The outputs of the exoskeleton compensation controller are the exoskeleton compensation torques, which are enforced by a position controlled Series Elastic Actuator. The proposed model-based feedforward signal improves the tracking of the position control loop. A change of the contact model also contributes to the feedforward signal.</p><p>The effectiveness of the controller was demonstrated by validating it on non-disabled participants. The controller was able to follow the fast changing torque demands, except when motor saturation occurred (at the hips). Comparing the results between the passive exoskeleton and the transparent controller showed significantly larger human joint torques and more muscle effort for the passive exoskeleton. On the other hand, comparing the transparent controller and the condition without exoskeleton showed no significant difference in results for the human torque and muscle effort.</p><p>The saturation of the actuators during the assisted condition, prevented a proper evaluation of the control methods while giving assistance. Future work will include validating the controller on an exoskeleton with more powerful actuators and testing and validating the control methods on walking exoskeletons.</p></sec></body><back><glossary><title>Abbreviations</title><def-list><def-item><term>A</term><def><p>Assistance-as-needed condition</p></def></def-item><def-item><term>AAN</term><def><p>Assistance-as-needed</p></def></def-item><def-item><term>ADL</term><def><p>Activities of daily living</p></def></def-item><def-item><term>ANN</term><def><p>Artificial neural networks</p></def></def-item><def-item><term>CAD</term><def><p>Computer aided design</p></def></def-item><def-item><term>dof</term><def><p>Degree of freedom</p></def></def-item><def-item><term>EMG</term><def><p>Electromyography</p></def></def-item><def-item><term>FSM</term><def><p>Finite state machine</p></def></def-item><def-item><term>IMU</term><def><p>Inertial measurement unit</p></def></def-item><def-item><term>MACCEPA</term><def><p>Mechanically adjustable compliance and controllable equilibrium position actuator</p></def></def-item><def-item><term>N</term><def><p>Condition without exoskeleton</p></def></def-item><def-item><term>P</term><def><p>Passive condition</p></def></def-item><def-item><term>SEA</term><def><p>Series elastic actuator</p></def></def-item><def-item><term>STS</term><def><p>Sit-to-stand</p></def></def-item><def-item><term>T</term><def><p>Transparent condition</p></def></def-item></def-list></glossary><ack><title>Acknowledgements</title><p>The Robotics Research Group and the Robotics and Multibody Mechanics Research Group are both core labs of Flanders Make.. Jonas Vantilt and Karen Junius are research fellows of the Flemish agency for Innovation by Science and Technology (IWT-SBO). Maarten Afschrift is a research fellow of the Flemish agency for scientific research (FWO-Vlaanderen). The authors gratefully acknowledge the financial support by the agency Flanders Innovation &#x00026; Entrepreneurship (VLAIO) through a project grant (MIRAD, IWT-SBO 120057). The authors cordially thank all participants of the study.</p><sec id="d29e5881"><title>Funding</title><p>The MIRAD exoskeleton is funded by the agency Flanders Innovation &#x00026; Entrepreneurship (VLAIO) through a project grant (MIRAD, IWT-SBO 120057). Jonas Vantilt and Karen Junius are research fellows of the Flemish agency for Innovation by Science and Technology (IWT-SBO). Maarten Afschrift is a research fellow of the Flemish agency for scientific research (FWO-Vlaanderen).</p></sec><sec id="d29e5886" sec-type="data-availability"><title>Availability of data and materials</title><p>The datasets generated and/or analysed during the current study are not publicly available due time and effort spent for data collection. Access to the software of the exoskeleton are available from the corresponding author on reasonable request.</p></sec></ack><notes notes-type="author-contribution"><title>Authors&#x02019; contributions</title><p>JV and KT developed the control algorithms for the exoskeleton. JV conducted all modelling work of the exoskeleton. KJ and JG designed the exoskeleton and actuators. AKBD recruited the participants. JV, KT and AKBD conducted the validation experiments with the participants. MA, AKBD and JV analysed the data. JDS, FDG, EA, IJ and DL provided supervision and proofread the paper. All authors read and approved the final manuscript.</p></notes><notes><title>Ethics approval and consent to participate</title><p>All subjects gave informed consent (study S55281) in accordance to the Ethical Committee of UZ/KU Leuven (EC Onderzoek UZ/KU Leuven) before participating in the study.</p></notes><notes><title>Consent for publication</title><p>The consent of all participants was obtained before publication.</p></notes><notes notes-type="COI-statement"><title>Competing interests</title><p>The authors declare that they have no competing interests.</p></notes><notes><title>Publisher&#x02019;s Note</title><p>Springer Nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.</p></notes><ref-list id="Bib1"><title>References</title><ref id="CR1"><label>1</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Young</surname><given-names>AJ</given-names></name><name><surname>Ferris</surname><given-names>DP</given-names></name></person-group><article-title>State of the art and future directions for lower limb robotic exoskeletons</article-title><source>IEEE Trans Neural Syst Rehabil Engineer</source><year>2017</year><volume>25</volume><issue>2</issue><fpage>171</fpage><lpage>82</lpage><pub-id pub-id-type="doi">10.1109/TNSRE.2016.2521160</pub-id></element-citation></ref><ref id="CR2"><label>2</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Yan</surname><given-names>T</given-names></name><name><surname>Cempini</surname><given-names>M</given-names></name><name><surname>Oddo</surname><given-names>CM</given-names></name><name><surname>Vitiello</surname><given-names>N</given-names></name></person-group><article-title>Review of assistive strategies in powered lower-limb orthoses and exoskeletons</article-title><source>Robot Auton Syst</source><year>2015</year><volume>64</volume><fpage>120</fpage><lpage>36</lpage><pub-id pub-id-type="doi">10.1016/j.robot.2014.09.032</pub-id></element-citation></ref><ref id="CR3"><label>3</label><mixed-citation publication-type="other">Kolakowsky-Hayner S, Crew J, Moran S, Shah A. Safety and feasibility of using the ekso bionic exoskeleton to aid ambulation after spinal cord injury. J Spine. 2013;4(3).</mixed-citation></ref><ref id="CR4"><label>4</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wang</surname><given-names>S</given-names></name><etal/></person-group><article-title>Design and control of the mindwalker exoskeleton</article-title><source>IEEE Trans Neural Syst Rehabil Engineer</source><year>2015</year><volume>23</volume><issue>2</issue><fpage>277</fpage><lpage>86</lpage><pub-id pub-id-type="doi">10.1109/TNSRE.2014.2365697</pub-id></element-citation></ref><ref id="CR5"><label>5</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jezernik</surname><given-names>S</given-names></name><name><surname>Colombo</surname><given-names>G</given-names></name><name><surname>Morari</surname><given-names>M</given-names></name></person-group><article-title>Automatic gait-pattern adaptation algorithms for rehabilitation with a 4-dof robotic orthosis</article-title><source>IEEE Trans Robot Autom</source><year>2004</year><volume>20</volume><issue>3</issue><fpage>574</fpage><lpage>82</lpage><pub-id pub-id-type="doi">10.1109/TRA.2004.825515</pub-id></element-citation></ref><ref id="CR6"><label>6</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Blaya</surname><given-names>J</given-names></name><name><surname>Herr</surname><given-names>H</given-names></name></person-group><article-title>Adaptive Control of a Variable-Impedance Ankle-Foot Orthosis to Assist Drop-Foot Gait</article-title><source>IEEE Trans Neural Syst Rehabil Engineer</source><year>2004</year><volume>12</volume><issue>1</issue><fpage>24</fpage><lpage>31</lpage><pub-id pub-id-type="doi">10.1109/TNSRE.2003.823266</pub-id></element-citation></ref><ref id="CR7"><label>7</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Jim&#x000e9;nez-Fabi&#x000e1;n</surname><given-names>R</given-names></name><name><surname>Verlinden</surname><given-names>O</given-names></name></person-group><article-title>Review of control algorithms for robotic ankle systems in lower-limb orthoses, prostheses, and exoskeletons</article-title><source>Med Engineer &#x00026; Phys</source><year>2012</year><volume>34</volume><issue>4</issue><fpage>397</fpage><lpage>408</lpage><pub-id pub-id-type="doi">10.1016/j.medengphy.2011.11.018</pub-id></element-citation></ref><ref id="CR8"><label>8</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Aguirre-Ollinger</surname><given-names>G</given-names></name><name><surname>Colgate</surname><given-names>JE</given-names></name><name><surname>Peshkin</surname><given-names>MA</given-names></name><name><surname>Goswami</surname><given-names>A</given-names></name></person-group><article-title>Active-impedance control of a lower-limb assistive exoskeleton</article-title><source>Proceedings of the 2007 IEEE 10th International Conference on Rehabilitation Robotics</source><year>2007</year><publisher-loc>The Netherlands</publisher-loc><publisher-name>Noordwijk</publisher-name></element-citation></ref><ref id="CR9"><label>9</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Bernhardt</surname><given-names>M</given-names></name><name><surname>Frey</surname><given-names>M</given-names></name><name><surname>Colombo</surname><given-names>G</given-names></name><name><surname>Riener</surname><given-names>R</given-names></name></person-group><article-title>Hybrid force-position control yields cooperative behaviour of the rehabilitation robot lokomat</article-title><source>9th International Conference on Rehabilitation Robotics, 2005</source><year>2005</year><publisher-loc>Chicago</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR10"><label>10</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Duschau-Wicke</surname><given-names>A</given-names></name><name><surname>Zitzewitz</surname><given-names>Jv</given-names></name><name><surname>Caprez</surname><given-names>A</given-names></name><name><surname>L&#x000fc;nenburger</surname><given-names>L</given-names></name><name><surname>Riener</surname><given-names>R</given-names></name></person-group><article-title>Path control: A method for patient-cooperative robot-aided gait rehabilitation</article-title><source>IEEE Trans Neural Syst Rehabil Engineer</source><year>2010</year><volume>18</volume><issue>1</issue><fpage>38</fpage><lpage>48</lpage><pub-id pub-id-type="doi">10.1109/TNSRE.2009.2033061</pub-id></element-citation></ref><ref id="CR11"><label>11</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>He</surname><given-names>H</given-names></name><name><surname>Kiguchi</surname><given-names>K</given-names></name></person-group><article-title>A study on emg-based control of exoskeleton robots for human lower-limb motion assist</article-title><source>2007 6th International Special Topic Conference on Information Technology Applications in Biomedicine</source><year>2007</year><publisher-loc>Tokyo</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR12"><label>12</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Kawamoto</surname><given-names>H</given-names></name><name><surname>Taal</surname><given-names>S</given-names></name><name><surname>Niniss</surname><given-names>H</given-names></name><name><surname>Hayashi</surname><given-names>T</given-names></name><name><surname>Kamibayashi</surname><given-names>K</given-names></name><name><surname>Eguchi</surname><given-names>K</given-names></name><name><surname>Sankai</surname><given-names>Y</given-names></name></person-group><article-title>Voluntary motion support control of robot suit hal triggered by bioelectrical signal for hemiplegia</article-title><source>2010 Annual International Conference of the IEEE Engineering in Medicine and Biology</source><year>2010</year><publisher-loc>Buenos Aires</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR13"><label>13</label><mixed-citation publication-type="other">van Asseldonk EHF, van der Kooij H. Robot-Aided Gait Training with LOPES In: In: Dietz V, Nef T., Rymer WZ, editors. Londen: Springer: 2012. p. 379&#x02013;96.</mixed-citation></ref><ref id="CR14"><label>14</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Kazerooni</surname><given-names>H</given-names></name><name><surname>Steger</surname><given-names>R</given-names></name><name><surname>Huang</surname><given-names>L</given-names></name></person-group><article-title>Hybrid control of the berkeley lower extremity exoskeleton (bleex)</article-title><source>Int J Robot Res</source><year>2006</year><volume>25</volume><issue>5/6</issue><fpage>561</fpage><lpage>73</lpage><pub-id pub-id-type="doi">10.1177/0278364906065505</pub-id></element-citation></ref><ref id="CR15"><label>15</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Ajayi</surname><given-names>MO</given-names></name><name><surname>Djouani</surname><given-names>K</given-names></name><name><surname>Hamam</surname><given-names>Y</given-names></name></person-group><article-title>Shank-foot trajectory control: A forward dynamics approach using computed-torque control</article-title><source>IEEE-RAS International Conference on Humanoid Robots</source><year>2014</year><publisher-loc>Madrid</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR16"><label>16</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vallery</surname><given-names>H</given-names></name><name><surname>Veneman</surname><given-names>J</given-names></name><name><surname>van Asseldonk</surname><given-names>E</given-names></name><name><surname>Ekkelenkamp</surname><given-names>R</given-names></name><name><surname>Buss</surname><given-names>M</given-names></name><name><surname>van Der Kooij</surname><given-names>H</given-names></name></person-group><article-title>Compliant actuation of rehabilitation robots</article-title><source>IEEE Robot &#x00026; Autom Mag</source><year>2008</year><volume>15</volume><issue>3</issue><fpage>60</fpage><lpage>9</lpage><pub-id pub-id-type="doi">10.1109/MRA.2008.927689</pub-id></element-citation></ref><ref id="CR17"><label>17</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Pratt</surname><given-names>GA</given-names></name><name><surname>Williamson</surname><given-names>MM</given-names></name></person-group><article-title>Series elastic actuators</article-title><source>Proceedings 1995 IEEE/RSJ International Conference on Intelligent Robots and Systems</source><year>1995</year><publisher-loc>Pittsburgh</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR18"><label>18</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Pratt</surname><given-names>GA</given-names></name><name><surname>Willisson</surname><given-names>P</given-names></name><name><surname>Bolton</surname><given-names>C</given-names></name><name><surname>Hofman</surname><given-names>A</given-names></name></person-group><article-title>Late motor processing in low-impedance robots: impedance control of series-elastic actuators</article-title><source>Proceedings of the 2004 American Control Conference</source><year>2004</year><publisher-loc>Boston</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR19"><label>19</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mathijssen</surname><given-names>G</given-names></name><name><surname>Cherelle</surname><given-names>P</given-names></name><name><surname>Lefeber</surname><given-names>D</given-names></name><name><surname>Vanderborght</surname><given-names>B</given-names></name></person-group><article-title>Concept of a series-parallel elastic actuator for a powered transtibial prosthesis</article-title><source>Actuators</source><year>2013</year><volume>2</volume><issue>3</issue><fpage>59</fpage><lpage>73</lpage><pub-id pub-id-type="doi">10.3390/act2030059</pub-id></element-citation></ref><ref id="CR20"><label>20</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Quinlivan</surname><given-names>B. T.</given-names></name><name><surname>Lee</surname><given-names>S.</given-names></name><name><surname>Malcolm</surname><given-names>P.</given-names></name><name><surname>Rossi</surname><given-names>D. M.</given-names></name><name><surname>Grimmer</surname><given-names>M.</given-names></name><name><surname>Siviy</surname><given-names>C.</given-names></name><name><surname>Karavas</surname><given-names>N.</given-names></name><name><surname>Wagner</surname><given-names>D.</given-names></name><name><surname>Asbeck</surname><given-names>A.</given-names></name><name><surname>Galiana</surname><given-names>I.</given-names></name><name><surname>Walsh</surname><given-names>C. J.</given-names></name></person-group><article-title>Assistance magnitude versus metabolic cost reductions for a tethered multiarticular soft exosuit</article-title><source>Science Robotics</source><year>2017</year><volume>2</volume><issue>2</issue><fpage>eaah4416</fpage><pub-id pub-id-type="doi">10.1126/scirobotics.aah4416</pub-id></element-citation></ref><ref id="CR21"><label>21</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Zhang</surname><given-names>J</given-names></name><name><surname>Fiers</surname><given-names>P</given-names></name><name><surname>Witte</surname><given-names>KA</given-names></name><name><surname>Jackson</surname><given-names>RW</given-names></name><name><surname>Poggensee</surname><given-names>KL</given-names></name><name><surname>Atkeson</surname><given-names>CG</given-names></name><name><surname>Collins</surname><given-names>SH</given-names></name></person-group><article-title>Human-in-the-loop optimization of exoskeleton assistance during walking</article-title><source>Science</source><year>2017</year><volume>356</volume><issue>6344</issue><fpage>1280</fpage><lpage>4</lpage><pub-id pub-id-type="doi">10.1126/science.aal5054</pub-id><pub-id pub-id-type="pmid">28642437</pub-id></element-citation></ref><ref id="CR22"><label>22</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Collins</surname><given-names>SH</given-names></name><name><surname>Wiggin</surname><given-names>MB</given-names></name><name><surname>Sawicki</surname><given-names>GS</given-names></name></person-group><article-title>Reducing the energy cost of human walking using an unpowered exoskeleton</article-title><source>Nature</source><year>2015</year><volume>522</volume><issue>7555</issue><fpage>212</fpage><lpage>5</lpage><pub-id pub-id-type="doi">10.1038/nature14288</pub-id><pub-id pub-id-type="pmid">25830889</pub-id></element-citation></ref><ref id="CR23"><label>23</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Feng</surname><given-names>S</given-names></name><name><surname>Whitman</surname><given-names>E</given-names></name><name><surname>Xinjilefu</surname><given-names>X</given-names></name><name><surname>Atkeson</surname><given-names>CG</given-names></name></person-group><article-title>Optimization Based Full Body Control for the ATLAS Robot</article-title><source>2014 IEEE-RAS International Conference on Humanoid Robots</source><year>2014</year><publisher-loc>Madrid</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR24"><label>24</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Herzog</surname><given-names>A</given-names></name><name><surname>Righetti</surname><given-names>L</given-names></name><name><surname>Grimminger</surname><given-names>F</given-names></name><name><surname>Pastor</surname><given-names>P</given-names></name><name><surname>Schaal</surname><given-names>S</given-names></name></person-group><article-title>Balancing experiments on a torque-controlled humanoid with hierarchical inverse dynamics</article-title><source>2014 IEEE/RSJ International Conference on Intelligent Robots and Systems</source><year>2014</year><publisher-loc>Chicago</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR25"><label>25</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Sherikov</surname><given-names>A</given-names></name><name><surname>Dimitrov</surname><given-names>D</given-names></name><name><surname>Wieber</surname><given-names>P. -B.</given-names></name></person-group><article-title>Whole Body Motion Controller with Long-Term Balance Constraints</article-title><source>14th IEEE-RAS International Conference on Humanoid Robots (Humanoids)</source><year>2014</year><publisher-loc>Madrid</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR26"><label>26</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Ott</surname><given-names>C</given-names></name><name><surname>Roa</surname><given-names>MA</given-names></name><name><surname>Hirzinger</surname><given-names>G</given-names></name></person-group><article-title>Posture and balance control for biped robots based on contact force optimization</article-title><source>11th IEEE-RAS International Conference on Humanoid Robots</source><year>2011</year><publisher-loc>Bled</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR27"><label>27</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Righetti</surname><given-names>L</given-names></name><name><surname>Buchli</surname><given-names>J</given-names></name><name><surname>Mistry</surname><given-names>M</given-names></name><name><surname>Kalakrishnan</surname><given-names>M</given-names></name><name><surname>Schaal</surname><given-names>S</given-names></name></person-group><article-title>Optimal distribution of contact forces with inverse-dynamics control</article-title><source>Int J Robot Res</source><year>2013</year><volume>32</volume><issue>3</issue><fpage>280</fpage><lpage>98</lpage><pub-id pub-id-type="doi">10.1177/0278364912469821</pub-id></element-citation></ref><ref id="CR28"><label>28</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Carmichael</surname><given-names>MG</given-names></name><name><surname>Liu</surname><given-names>D</given-names></name></person-group><article-title>Estimating physical assistance need using a musculoskeletal model</article-title><source>IEEE Trans Biomed Engineer</source><year>2013</year><volume>60</volume><issue>7</issue><fpage>1912</fpage><lpage>9</lpage><pub-id pub-id-type="doi">10.1109/TBME.2013.2244889</pub-id></element-citation></ref><ref id="CR29"><label>29</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tucker</surname><given-names>MR</given-names></name><name><surname>Olivier</surname><given-names>J</given-names></name><name><surname>Pagel</surname><given-names>A</given-names></name><name><surname>Bleuler</surname><given-names>H</given-names></name><name><surname>Bouri</surname><given-names>M</given-names></name><name><surname>Lambercy</surname><given-names>O</given-names></name><name><surname>Mill&#x000e1;n</surname><given-names>JdR</given-names></name><name><surname>Riener</surname><given-names>R</given-names></name><name><surname>Gassert</surname><given-names>R</given-names></name></person-group><article-title>Control strategies for active lower extremity prosthetics and orthotics: a review</article-title><source>J NeuroEngineering Rehabil</source><year>2015</year><volume>12</volume><issue>1</issue><fpage>1</fpage><lpage>29</lpage><pub-id pub-id-type="doi">10.1186/1743-0003-12-1</pub-id></element-citation></ref><ref id="CR30"><label>30</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Afschrift</surname><given-names>Maarten</given-names></name><name><surname>De Groote</surname><given-names>Friedl</given-names></name><name><surname>De Schutter</surname><given-names>Joris</given-names></name><name><surname>Jonkers</surname><given-names>Ilse</given-names></name></person-group><article-title>The effect of muscle weakness on the capability gap during gross motor function: a simulation study supporting design criteria for exoskeletons of the lower limb</article-title><source>BioMedical Engineering OnLine</source><year>2014</year><volume>13</volume><issue>1</issue><fpage>111</fpage><pub-id pub-id-type="doi">10.1186/1475-925X-13-111</pub-id><pub-id pub-id-type="pmid">25092209</pub-id></element-citation></ref><ref id="CR31"><label>31</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Unluhisarcikli</surname><given-names>O</given-names></name><name><surname>Pietrusinski</surname><given-names>M</given-names></name><name><surname>Weinberg</surname><given-names>B</given-names></name><name><surname>Bonato</surname><given-names>P</given-names></name><name><surname>Mavroidis</surname><given-names>C</given-names></name></person-group><article-title>Design and control of a robotic lower extremity exoskeleton for gait rehabilitation</article-title><source>2011 IEEE/RSJ International Conference on Intelligent Robots and Systems</source><year>2011</year><publisher-loc>San Francisco</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR32"><label>32</label><mixed-citation publication-type="other">Featherstone R. Rigid Body Dynamics Algorithms In: In: Featherstone R, editor. 1st. New York: Springer: 2008. p. 171&#x02013;93.</mixed-citation></ref><ref id="CR33"><label>33</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Spong</surname><given-names>MW</given-names></name></person-group><article-title>Modeling and control of elastic joint robots</article-title><source>Trans ASME J Dynam Syst Meas Control</source><year>1987</year><volume>109</volume><issue>4</issue><fpage>310</fpage><lpage>8</lpage><pub-id pub-id-type="doi">10.1115/1.3143860</pub-id></element-citation></ref><ref id="CR34"><label>34</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Swevers</surname><given-names>J</given-names></name><name><surname>Ganseman</surname><given-names>C</given-names></name><name><surname>T&#x000fc;kel</surname><given-names>DB</given-names></name><name><surname>De Schutter</surname><given-names>J</given-names></name><name><surname>Van Brussel</surname><given-names>H</given-names></name></person-group><article-title>Optimal robot excitation and identification</article-title><source>IEEE Trans Robot Autom</source><year>1997</year><volume>13</volume><issue>5</issue><fpage>730</fpage><lpage>9</lpage><pub-id pub-id-type="doi">10.1109/70.631234</pub-id></element-citation></ref><ref id="CR35"><label>35</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Vantilt</surname><given-names>J</given-names></name><name><surname>Aertbeli&#x000eb;n</surname><given-names>E</given-names></name><name><surname>De Groote</surname><given-names>F</given-names></name><name><surname>De Schutter</surname><given-names>J</given-names></name></person-group><article-title>Optimal excitation and identification of the dynamic model of robotic systems with compliant actuators</article-title><source>2015 IEEE International Conference on Robotics and Automation</source><year>2015</year><publisher-loc>Seattle</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR36"><label>36</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Palli</surname><given-names>G</given-names></name><name><surname>Melchiorri</surname><given-names>C</given-names></name><name><surname>Luca</surname><given-names>AD</given-names></name></person-group><article-title>On the feedback linearization of robots with variable joint stiffness</article-title><source>2008 IEEE International Conference on Robotics and Automation</source><year>2008</year><publisher-loc>Pasadena</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR37"><label>37</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Chung</surname><given-names>W</given-names></name><name><surname>Fu</surname><given-names>L-C</given-names></name><name><surname>Hsu</surname><given-names>S-H</given-names></name></person-group><person-group person-group-type="editor"><name><surname>In: Siciliano</surname><given-names>B</given-names></name><name><surname>Khatib</surname><given-names>O.</given-names></name></person-group><article-title>Motion control</article-title><source>Springer Handbook of Robotics</source><year>2008</year><publisher-loc>Berlin</publisher-loc><publisher-name>Springer</publisher-name></element-citation></ref><ref id="CR38"><label>38</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>An</surname><given-names>CH</given-names></name><name><surname>Atkeson</surname><given-names>CG</given-names></name><name><surname>Griffiths</surname><given-names>JD</given-names></name><name><surname>Hollerbach</surname><given-names>JM</given-names></name></person-group><article-title>Experimental evaluation of feedforward and computed torque control</article-title><source>IEEE Trans Robot Autom</source><year>1989</year><volume>5</volume><issue>3</issue><fpage>368</fpage><lpage>73</lpage><pub-id pub-id-type="doi">10.1109/70.34773</pub-id></element-citation></ref><ref id="CR39"><label>39</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Ronsse</surname><given-names>R</given-names></name><name><surname>Rossi</surname><given-names>SMMD</given-names></name><name><surname>Vitiello</surname><given-names>N</given-names></name><name><surname>Lenzi</surname><given-names>T</given-names></name><name><surname>Carrozza</surname><given-names>MC</given-names></name><name><surname>Ijspeert</surname><given-names>AJ</given-names></name></person-group><article-title>Real-time estimate of velocity and acceleration of quasi-periodic signals using adaptive oscillators</article-title><source>IEEE Trans Robot</source><year>2013</year><volume>29</volume><issue>3</issue><fpage>783</fpage><lpage>91</lpage><pub-id pub-id-type="doi">10.1109/TRO.2013.2240173</pub-id></element-citation></ref><ref id="CR40"><label>40</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tanghe</surname><given-names>K</given-names></name><name><surname>Aertbeli&#x000eb;n</surname><given-names>E</given-names></name><name><surname>Vantilt</surname><given-names>J</given-names></name><name><surname>Moltedo</surname><given-names>M</given-names></name><name><surname>Bacek</surname><given-names>T</given-names></name><name><surname>De Schutter</surname><given-names>J</given-names></name></person-group><article-title>Realtime delayless estimation of derivatives of noisy sensor signals for quasi-cyclic motions with application to joint acceleration estimation on an exoskeleton</article-title><source>IEEE Robotics and Automation Letters (RA-L)(accepted)</source><year>2018</year><volume>3</volume><issue>3</issue><fpage>1647</fpage><lpage>54</lpage><pub-id pub-id-type="doi">10.1109/LRA.2018.2801473</pub-id></element-citation></ref><ref id="CR41"><label>41</label><mixed-citation publication-type="other">Wyeth G. Australasian Conference on Robotics and Automation In: In: MacDonald B, editor. Auckland: Australian Robotics and Automation Association Inc: 2006.</mixed-citation></ref><ref id="CR42"><label>42</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>der Kooij</surname><given-names>H. van</given-names></name><name><surname>Veneman</surname><given-names>J.F.</given-names></name><name><surname>Ekkelenkamp</surname><given-names>R.</given-names></name></person-group><article-title>Compliant Actuation of Exoskeletons</article-title><source>Mobile Robots: towards New Applications</source><year>2006</year></element-citation></ref><ref id="CR43"><label>43</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Vallery</surname><given-names>H</given-names></name><name><surname>Ekkelenkamp</surname><given-names>R</given-names></name><name><surname>van der Kooij</surname><given-names>H</given-names></name><name><surname>Buss</surname><given-names>M</given-names></name></person-group><article-title>Passive and accurate torque control of series elastic actuators</article-title><source>Proceedings of the 2007 IEEE/RSJ International Conference on Intelligent Robots and Systems</source><year>2007</year><publisher-loc>San Diego</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR44"><label>44</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Vantilt</surname><given-names>J</given-names></name><name><surname>Giraddi</surname><given-names>C</given-names></name><name><surname>Aertbeli&#x000eb;n</surname><given-names>E</given-names></name><name><surname>De Groote</surname><given-names>F</given-names></name><name><surname>De Schutter</surname><given-names>J</given-names></name></person-group><article-title>Estimating contact forces and moments for walking robots and exoskeletons using complementary energy methods</article-title><source>IEEE Robot Autom Lett</source><year>2018</year><volume>3</volume><issue>4</issue><fpage>3410</fpage><lpage>7</lpage><pub-id pub-id-type="doi">10.1109/LRA.2018.2852776</pub-id></element-citation></ref><ref id="CR45"><label>45</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Paine</surname><given-names>N</given-names></name><name><surname>Oh</surname><given-names>S</given-names></name><name><surname>Sentis</surname><given-names>L</given-names></name></person-group><article-title>Design and control considerations for high-performance series elastic actuators</article-title><source>IEEE/ASME Trans Mechatron</source><year>2014</year><volume>19</volume><issue>3</issue><fpage>1080</fpage><lpage>91</lpage><pub-id pub-id-type="doi">10.1109/TMECH.2013.2270435</pub-id></element-citation></ref><ref id="CR46"><label>46</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Junius</surname><given-names>K</given-names></name><name><surname>Brackx</surname><given-names>B</given-names></name><name><surname>Grosu</surname><given-names>V</given-names></name><name><surname>Cuypers</surname><given-names>H</given-names></name><name><surname>Geeroms</surname><given-names>J</given-names></name><name><surname>Moltedo</surname><given-names>M</given-names></name><name><surname>Vanderborght</surname><given-names>B</given-names></name><name><surname>Lefeber</surname><given-names>D</given-names></name></person-group><article-title>Mechatronic design of a sit-to-stance exoskeleton</article-title><source>Proceedings of the 5th IEEE RAS/EMBS International Conference on Biomedical Robotics and Biomechatronics</source><year>2014</year><publisher-loc>S&#x000e3;o Paulo</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR47"><label>47</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Roebroeck</surname><given-names>ME</given-names></name><name><surname>Doorenbosch</surname><given-names>CAM</given-names></name><name><surname>Harlaar</surname><given-names>J</given-names></name><name><surname>Jacobs</surname><given-names>R</given-names></name><name><surname>Lankhorst</surname><given-names>GJ</given-names></name></person-group><article-title>Biomechanics and muscular activity during sit-to-stand transfer</article-title><source>Clinic Biomech</source><year>1994</year><volume>9</volume><issue>4</issue><fpage>235</fpage><lpage>44</lpage><pub-id pub-id-type="doi">10.1016/0268-0033(94)90004-3</pub-id></element-citation></ref><ref id="CR48"><label>48</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Brackx</surname><given-names>B</given-names></name><etal/></person-group><article-title>Design of a modular add-on compliant actuator to convert an orthosis into an assistive exoskeleton</article-title><source>Proceedings of the 5th IEEE RAS/EMBS International Conference on Biomedical Robotics and Biomechatronics</source><year>2014</year><publisher-loc>S&#x000e3;o Paulo</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR49"><label>49</label><mixed-citation publication-type="other">EtherCAT Technology Group. EtherCAT. <ext-link ext-link-type="uri" xlink:href="https://www.ethercat.org/default.htm">https://www.ethercat.org/default.htm</ext-link>.</mixed-citation></ref><ref id="CR50"><label>50</label><mixed-citation publication-type="other">Xsens Technologies BV. Xsens. <ext-link ext-link-type="uri" xlink:href="https://www.xsens.com">https://www.xsens.com</ext-link>.</mixed-citation></ref><ref id="CR51"><label>51</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tsukahara</surname><given-names>A</given-names></name><name><surname>Kawanishi</surname><given-names>R</given-names></name><name><surname>Hasegawa</surname><given-names>Y</given-names></name><name><surname>Sankai</surname><given-names>Y</given-names></name></person-group><article-title>Sit-to-stand and stand-to-sit transfer support for complete paraplegic patients with robot suit hal</article-title><source>Adv Robot</source><year>2010</year><volume>24</volume><issue>11</issue><fpage>1615</fpage><lpage>38</lpage><pub-id pub-id-type="doi">10.1163/016918610X512622</pub-id></element-citation></ref><ref id="CR52"><label>52</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Mori</surname><given-names>Y</given-names></name><name><surname>Okada</surname><given-names>J</given-names></name><name><surname>Takayama</surname><given-names>K</given-names></name></person-group><article-title>Development of a standing style transfer system &#x0201c;able&#x0201d; for disabled lower limbs</article-title><source>IEEE/ASME Trans Mechatron</source><year>2006</year><volume>11</volume><issue>4</issue><fpage>372</fpage><lpage>80</lpage><pub-id pub-id-type="doi">10.1109/TMECH.2006.878558</pub-id></element-citation></ref><ref id="CR53"><label>53</label><element-citation publication-type="book"><person-group person-group-type="author"><name><surname>Nakamura</surname><given-names>T</given-names></name><name><surname>Saito</surname><given-names>K</given-names></name><name><surname>Wang</surname><given-names>Z</given-names></name><name><surname>Kosuge</surname><given-names>K</given-names></name></person-group><article-title>Realizing model-based wearable antigravity muscles support with dynamics terms</article-title><source>2005 IEEE/RSJ International Conference on Intelligent Robots and Systems</source><year>2005</year><publisher-loc>Edmonton</publisher-loc><publisher-name>IEEE</publisher-name></element-citation></ref><ref id="CR54"><label>54</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Tanghe</surname><given-names>K</given-names></name><name><surname>Harutyunyan</surname><given-names>A</given-names></name><name><surname>Aertbelien</surname><given-names>E</given-names></name><name><surname>De Groote</surname><given-names>F</given-names></name><name><surname>De Schutter</surname><given-names>J</given-names></name><name><surname>Vrancx</surname><given-names>P</given-names></name><name><surname>Nowe</surname><given-names>A</given-names></name></person-group><article-title>Predicting seat-off and detecting start-of- assistance events for assisting sit-to-stand with an exoskeleton</article-title><source>IEEE Robot Autom Lett</source><year>2016</year><volume>1</volume><issue>2</issue><fpage>792</fpage><lpage>9</lpage><pub-id pub-id-type="doi">10.1109/LRA.2016.2530165</pub-id></element-citation></ref><ref id="CR55"><label>55</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Delp</surname><given-names>SL</given-names></name><name><surname>Anderson</surname><given-names>FC</given-names></name><name><surname>Arnold</surname><given-names>AS</given-names></name><name><surname>Loan</surname><given-names>P</given-names></name><name><surname>Habib</surname><given-names>A</given-names></name><name><surname>John</surname><given-names>CT</given-names></name><name><surname>Guendelman</surname><given-names>E</given-names></name><name><surname>Thelen</surname><given-names>DG</given-names></name></person-group><article-title>Opensim: Open-source software to create and analyze dynamic simulations of movement</article-title><source>IEEE Trans Biomed Engineer</source><year>2007</year><volume>54</volume><issue>11</issue><fpage>1940</fpage><lpage>50</lpage><pub-id pub-id-type="doi">10.1109/TBME.2007.901024</pub-id></element-citation></ref><ref id="CR56"><label>56</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Hermens</surname><given-names>HJ</given-names></name><name><surname>Freriks</surname><given-names>B</given-names></name><name><surname>Disselhorst-Klug</surname><given-names>C</given-names></name><name><surname>Rau</surname><given-names>G</given-names></name></person-group><article-title>Development of recommendations for semg sensors and sensor placement procedures</article-title><source>J Electromyography Kinesiol</source><year>2000</year><volume>10</volume><issue>5</issue><fpage>361</fpage><lpage>74</lpage><pub-id pub-id-type="doi">10.1016/S1050-6411(00)00027-4</pub-id></element-citation></ref><ref id="CR57"><label>57</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Wilcoxon</surname><given-names>F</given-names></name></person-group><article-title>Individual comparisons by ranking methods</article-title><source>Biomet Bullet</source><year>1945</year><volume>1</volume><issue>6</issue><fpage>80</fpage><lpage>3</lpage><pub-id pub-id-type="doi">10.2307/3001968</pub-id></element-citation></ref><ref id="CR58"><label>58</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Holm</surname><given-names>S</given-names></name></person-group><article-title>A simple sequentially rejective multiple test procedure</article-title><source>Scandinavian J Stat</source><year>1979</year><volume>6</volume><issue>2</issue><fpage>65</fpage><lpage>70</lpage></element-citation></ref><ref id="CR59"><label>59</label><element-citation publication-type="journal"><person-group person-group-type="author"><name><surname>Pataky</surname><given-names>PC</given-names></name><name><surname>Robinson</surname><given-names>MA</given-names></name><name><surname>Vanrenterghem</surname><given-names>J</given-names></name></person-group><article-title>Vector field statistical analysis of kinematic and force trajectories</article-title><source>J Biomech</source><year>2013</year><volume>46</volume><issue>14</issue><fpage>2394</fpage><lpage>401</lpage><pub-id pub-id-type="doi">10.1016/j.jbiomech.2013.07.031</pub-id><pub-id pub-id-type="pmid">23948374</pub-id></element-citation></ref></ref-list></back></article>