<?xml version="1.0" encoding="UTF-8"?>
<sec sec-type="methods" id="s2" class="sec">
 <span class="label" xmlns="http://www.w3.org/1999/xhtml">2.</span>
 <div class="title" xmlns="http://www.w3.org/1999/xhtml">Material and methods</div>
 <sec id="s2a" class="sec">
  <span class="label" xmlns="http://www.w3.org/1999/xhtml">2.1.</span>
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Biogeographic data</div>
  <p xmlns="http://www.w3.org/1999/xhtml">When implementing ENM, most studies have focused on analyses of individual species [
   <a rid="RSOS182111C20" ref-type="bibr" href="#RSOS182111C20">20</a>,
   <a rid="RSOS182111C30" ref-type="bibr" href="#RSOS182111C30">30</a>–
   <a rid="RSOS182111C33" ref-type="bibr" href="#RSOS182111C33">33</a>]. However, due to the relative rarity of fossil occurrence data at global scale, we use occurrence data at ecotype level (i.e. a group which shares specific environmental preferences). The responses of modern coral reefs to environmental variables are broadly similar at a global level, recognized as being limited to warm, clear and shallow water habitats [
   <a rid="RSOS182111C34" ref-type="bibr" href="#RSOS182111C34">34</a>].
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">Modern coral occurrences were downloaded on 5 July 2017 from the Ocean Biogeographic Information System (OBIS; 
   <span xlink:href="www.iobis.org" class="uri" xmlns:xlink="http://www.w3.org/1999/xlink">www.iobis.org</span>) using the search criteria ‘Scleractinia’, yielding 589 817 occurrences. Fossil coral occurrence data were accessed on 19 July 2017 through the Paleobiology Database (PBDB; 
   <span xlink:href="www.paleobiodb.org" class="uri" xmlns:xlink="http://www.w3.org/1999/xlink">www.paleobiodb.org</span>). The PBDB returned 8021 occurrences for Pleistocene Scleractinia. These datasets were then filtered to exclude data not identified to species level, as well as further quality control checks (e.g. synonymizations). We based our analyses on zooxanthellate corals, herein referred to as reef corals, which host unicellular organisms known as zooxanthellae in their tissue, forming a photosymbiotic relationship [
   <a rid="RSOS182111C35" ref-type="bibr" href="#RSOS182111C35">35</a>]. Assignment to zooxanthellate class focused on the principle of uniformitarianism for fossil coral taxa. Azooxanthellate (those without a photosymbiotic relationship) and apozooxanthellate (those which may or may not sustain a photosymbiotic relationship) corals were excluded from both databases. Further, quality control was performed on the OBIS dataset, whereby occurrences found to occur on land or at depths greater than 100 m were removed under the assumption that there were errors in their geographical coordinates, species identification or are in fact fossil occurrences. In addition, we omitted data collected from rapid ecological assessments to improve the credibility of species-level identification, as well as those from coral transplant studies. The PBDB data were filtered to exclude occurrences which cannot be reliably assigned to the LIG. Duplicate occurrence records of the same species from exactly the same coordinates were also removed from both datasets.
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">The resultant modern occurrence dataset contains 700 zooxanthellate species, comprising 48 577 occurrences with 3553 unique coordinates, while the LIG dataset contains 190 zooxanthellate species, comprising 1337 occurrences (from 301 collections) with 166 unique coordinates (
   <a ref-type="fig" rid="RSOS182111F1" href="#RSOS182111F1">figure 1</a>; electronic supplementary material, SM1). In preparation of modelling, we clipped all occurrences by environmental layers to correspond with the environmental data. To account for species that have become extinct since the LIG, or that lack modern occurrence records in the OBIS, we excluded species which do not occur in both the clipped fossil and modern datasets. The final modern and fossil datasets comprise 157 shared species, composed of 22 726 modern reef coral occurrences and 1022 LIG reef coral fossil occurrences. Finally, point occurrences were spatially subsampled at a raster resolution of 1.25° × 1.25° to account for sampling bias. Subsampling resulted in the retention of 295 presence sites for modern reef corals and 56 for LIG reef corals (note that this does not affect the overall distribution, but prevents multiple records being excessively weighted during model training) (
   <a ref-type="fig" rid="RSOS182111F1" href="#RSOS182111F1">figure 1</a>). 
   <div id="RSOS182111F1" orientation="portrait" position="float" class="fig">
    <span class="label">Figure 1.</span>
    <div class="caption">
     <p>Latitudinal and global distribution of modern and LIG reef coral occurrences. (
      <span class="italic">a,b</span>) Frequency of occurrence records (Occ), species diversity (SIB) and shared species (species present in both time slices (sSIB)) of reef corals binned at 5° latitudinal zones. (
      <span class="italic">c</span>) World distribution map of shared species (subsampled at 1.25° × 1.25° and clipped to environmental data) between the modern and the LIG. Grey shaded area represents the extent of the tropics in the present day. Dashed lines indicate the Equator, the Northern Tropic and the Southern Tropic.
     </p>
    </div>
    <div xlink:href="rsos182111-g1" class="graphic" xmlns:xlink="http://www.w3.org/1999/xlink"/>
   </div>
  </p>
 </sec>
 <sec id="s2b" class="sec">
  <span class="label" xmlns="http://www.w3.org/1999/xhtml">2.2.</span>
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Environmental data</div>
  <p xmlns="http://www.w3.org/1999/xhtml">Climate variables for the modern (pre-industrial), LIG and two future (2100 AD) climate scenario simulations were derived from HadCM3M2.1N [
   <a rid="RSOS182111C36" ref-type="bibr" href="#RSOS182111C36">36</a>], a version of UK Met Office HadCM3, a coupled atmosphere–ocean General Circulation Model (GCM). HadCM3 has been heavily used as part of the Intergovernmental Panel on Climate Change (IPCC) 4th and 5th assessment reports [
   <a rid="RSOS182111C37" ref-type="bibr" href="#RSOS182111C37">37</a>] and successfully applied to studies of both present-day and LIG climate and biodiversity [
   <a rid="RSOS182111C30" ref-type="bibr" href="#RSOS182111C30">30</a>,
   <a rid="RSOS182111C36" ref-type="bibr" href="#RSOS182111C36">36</a>,
   <a rid="RSOS182111C38" ref-type="bibr" href="#RSOS182111C38">38</a>–
   <a rid="RSOS182111C42" ref-type="bibr" href="#RSOS182111C42">42</a>]. Here, we use IPCC representative concentration pathways (RCP) 4.5 and 8.5 for our future climate scenario simulations [
   <a rid="RSOS182111C43" ref-type="bibr" href="#RSOS182111C43">43</a>]; a description of both is provided in electronic supplementary material, SM2. To further improve our ENMs, bathymetric data were extracted from Getech's present-day digital elevation model (DEM), which provides gridded representations of both the Earth's topography and bathymetry. A description of both the GCM and DEM used in this study is provided in electronic supplementary material, SM2, along with data preparation protocols.
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">Environmental variables known to be ecologically limiting for modern corals (i.e. SST, salinity, irradiance and bathymetry) [
   <a rid="RSOS182111C14" ref-type="bibr" href="#RSOS182111C14">14</a>,
   <a rid="RSOS182111C34" ref-type="bibr" href="#RSOS182111C34">34</a>,
   <a rid="RSOS182111C35" ref-type="bibr" href="#RSOS182111C35">35</a>], and that can be viably determined for the fossil record from GCM outputs, were chosen to reflect abiotic niche characteristics (electronic supplementary material, SM2: table SM2). Initially, these variables were considered at several temporal levels: annual, seasonal and monthly. However, to reduce co-linearity between variables and prevent over-fitting, we retained the combinations of climate variables with a Pearson's pairwise correlation coefficient of less than 0.7 (electronic supplementary material, SM2: figures SM2–SM7). After enquiry, five environmental variables were used for final niche analysis: (i) mean annual SST; (ii) mean December–February irradiance; (iii) mean June–August irradiance; (iv) mean annual salinity; and (v) bathymetry. While we acknowledge that additional variables, in particular, aragonite saturation state, might be valuable for estimating reef coral distribution, not all variables can be viably approximated for the geological past. Despite this, several biophysical studies have shown that the fundamental niche of an organism can be reasonably approximated by a limited set of biologically important variables (e.g. [
   <a rid="RSOS182111C44" ref-type="bibr" href="#RSOS182111C44">44</a>]). In addition, Couce 
   <span class="italic">et al</span>. [
   <a rid="RSOS182111C14" ref-type="bibr" href="#RSOS182111C14">14</a>,
   <a rid="RSOS182111C15" ref-type="bibr" href="#RSOS182111C15">15</a>] demonstrated that high SST was the primary control on coral reef distribution, with high light availability, salinity, aragonite saturation state and low nutrient concentrations being of secondary significance. Nevertheless, we ran sensitivity analyses to compare modern projections from modern-trained models with and without aragonite saturation state to gauge the potential impact upon our results (provided in electronic supplementary material, SM2).
  </p>
 </sec>
 <sec id="s2c" class="sec">
  <span class="label" xmlns="http://www.w3.org/1999/xhtml">2.3.</span>
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Niche modelling and quantifying range dynamics</div>
  <sec id="s2c1" class="sec">
   <span class="label" xmlns="http://www.w3.org/1999/xhtml">2.3.1.</span>
   <div class="title" xmlns="http://www.w3.org/1999/xhtml">Niche comparisons</div>
   <p xmlns="http://www.w3.org/1999/xhtml">As previously noted, short-term observations of distribution dynamics can be inherently biased by a taxon not occupying its full geographical or environmental space. However, an additional fundamental question is whether environmental niches are conserved over evolutionary time scales [
    <a rid="RSOS182111C45" ref-type="bibr" href="#RSOS182111C45">45</a>]. To evaluate this, we used the R-package ECOSPAT [
    <a rid="RSOS182111C46" ref-type="bibr" href="#RSOS182111C46">46</a>] to quantify measures of niche margin dynamics (unfilling, expansion and stability). We also performed niche overlap analyses, testing for niche equivalency and similarity of the reef coral niches occupied across two temporal windows (LIG and modern). The ECOSPAT niche overlap analysis applies kernel smoothers to the densities of species occurrences in gridded environmental space, using a randomization test framework to compare observed equivalency and similarity to that anticipated under a null hypothesis [
    <a rid="RSOS182111C46" ref-type="bibr" href="#RSOS182111C46">46</a>]. Both niche equivalency and similarity are quantified in terms of Schoener's 
    <span class="italic">D</span> [
    <a rid="RSOS182111C47" ref-type="bibr" href="#RSOS182111C47">47</a>], with values ranging from 0 (least equivalent or similar) to 1 (most equivalent or similar). We compared the subsampled occupied niches of LIG and modern reef corals using a principal component analysis (PCA-env), testing the null hypothesis by randomly sampling 5000 replicates of both LIG and modern niches. The PCA-env was calibrated with all five environmental variables implemented in the construction of our ENMs, and allowed us to assess differences in the occupied niche of reef corals from the LIG and modern (see [
    <a rid="RSOS182111C48" ref-type="bibr" href="#RSOS182111C48">48</a>] for detailed descriptions of the ECOSPAT package).
   </p>
  </sec>
  <sec id="s2c2" class="sec">
   <span class="label" xmlns="http://www.w3.org/1999/xhtml">2.3.2.</span>
   <div class="title" xmlns="http://www.w3.org/1999/xhtml">Ecological niche modelling</div>
   <p xmlns="http://www.w3.org/1999/xhtml">To map the potential distribution of reef corals in the modern, LIG and under future climate change scenarios (RCP4.5 and RCP8.5), we implemented three ENM methods: BIOCLIM [
    <a rid="RSOS182111C49" ref-type="bibr" href="#RSOS182111C49">49</a>], randomForest [
    <a rid="RSOS182111C50" ref-type="bibr" href="#RSOS182111C50">50</a>] and MaxEnt v. 3.4.1 [
    <a rid="RSOS182111C51" ref-type="bibr" href="#RSOS182111C51">51</a>]. In particular, MaxEnt has been shown to perform well in previous studies on coral reefs, as well as those using the fossil record for other taxonomic groups [
    <a rid="RSOS182111C14" ref-type="bibr" href="#RSOS182111C14">14</a>,
    <a rid="RSOS182111C16" ref-type="bibr" href="#RSOS182111C16">16</a>,
    <a rid="RSOS182111C30" ref-type="bibr" href="#RSOS182111C30">30</a>,
    <a rid="RSOS182111C32" ref-type="bibr" href="#RSOS182111C32">32</a>,
    <a rid="RSOS182111C52" ref-type="bibr" href="#RSOS182111C52">52</a>,
    <a rid="RSOS182111C53" ref-type="bibr" href="#RSOS182111C53">53</a>]. ENMs were generated using the R-package ‘biomod2’ v. 3.3-7 [
    <a rid="RSOS182111C54" ref-type="bibr" href="#RSOS182111C54">54</a>,
    <a rid="RSOS182111C55" ref-type="bibr" href="#RSOS182111C55">55</a>], running 100 subsample replicates with 75% of occurrences for model training, while 25% were reserved (randomly seeded) for model testing. We generated two model classes, training the ENM with both the LIG and modern occurrences, offering insights into the occupied niche and distribution under two diverse climate states. Using the three ENM methods, we produced an ensemble model based on mean projections from all modelling algorithms for each climate scenario, and for each model class (LIG- and modern-trained). As reef corals reside at the upper thermal limit of the oceans, we also built clamping masks for model projections to identify geographical areas which indicate environmental variable values outside of the training range.
   </p>
  </sec>
  <sec id="s2c3" class="sec">
   <span class="label" xmlns="http://www.w3.org/1999/xhtml">2.3.3.</span>
   <div class="title" xmlns="http://www.w3.org/1999/xhtml">Range comparisons</div>
   <p xmlns="http://www.w3.org/1999/xhtml">In order to measure distribution dynamics, we first generated 24 binary maps from the ensemble models using two different training datasets (LIG reef corals and modern reef corals) and three different binary thresholds for the four climate scenarios (LIG, modern, RCP4.5 and RCP8.5). We selected three thresholds for binary conversion: the 5th-, 10th- and 20th-percentiles of the lowest tail of habitat suitability values (5LPT, 10LPT, 20LPT) associated with the occurrence data for each model to provide insight into habitability dynamics (see electronic supplementary material, SM2, for further details). As short-term observations are intrinsically biased and perhaps incomplete in both environmental and geographical space, we combined binary predictions generated from both LIG and modern training datasets. This was done for each time-slice/climate scenario to establish a multi-temporal approach, estimating the full geographical localities reef corals may occupy. We then assessed whether this approach improved the models' capability to predict the occurrence of both LIG and modern localities, which would have implications for forecasting under future climate scenarios. The latitudinal range and habitability of reef corals for past, present and future climatic scenarios were computed as a function of the sum of suitable cells, within 5° latitudinal bins, for each model class’ projections (LIG, modern and combined).</p>
  </sec>
 </sec>
 <sec id="s2d" class="sec">
  <span class="label" xmlns="http://www.w3.org/1999/xhtml">2.4.</span>
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Model validation</div>
  <p xmlns="http://www.w3.org/1999/xhtml">Model performance was assessed using the area under the curve (AUC) statistic [
   <a rid="RSOS182111C56" ref-type="bibr" href="#RSOS182111C56">56</a>], derived from receiver operating characteristic (ROC) analyses, and the true skill statistic (TSS) [
   <a rid="RSOS182111C57" ref-type="bibr" href="#RSOS182111C57">57</a>]. In general, evaluation criteria for AUC values have been interpreted as excellent (0.90–1.00), very good (0.8–0.9), good (0.7–0.8), fair (0.6–0.7) and poor (0.5–0.6), whereas a score of less than 0.5 is worse than one would expect from a random model [
   <a rid="RSOS182111C58" ref-type="bibr" href="#RSOS182111C58">58</a>]. Evaluation scores for TSS range from −1 to 1, where a score of 1 demonstrates perfect model performance, while less than 0 is considered worse than a random model [
   <a rid="RSOS182111C57" ref-type="bibr" href="#RSOS182111C57">57</a>]. As we used two ENM constructs (LIG- and modern-trained), and generated respective forecasting and hindcasting (backtesting) projections, we calculated the AUC scores using LIG occurrences and modern occurrences as an evaluation dataset for model projections to other climate scenarios (i.e. modern-trained and LIG projection; LIG-trained and modern projection).
  </p>
 </sec>
</sec>
