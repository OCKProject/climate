<?xml version="1.0" encoding="UTF-8"?>
<sec id="Sec9" class="sec">
 <div class="title" xmlns="http://www.w3.org/1999/xhtml">Stochastic dynamic programming (SDP)</div>
 <p id="Par35" xmlns="http://www.w3.org/1999/xhtml">Stochastic dynamic programming is an optimization approach and control method that represents decision-making under uncertainty using multiple stages or time periods. The result is optimal policies, representing the best possible action as a function of the system state and time period. In our non-stationary formulation, it can also be understood as a form of closed-loop stochastic control, in which new information about the system feeds back into updated estimates for system state transitions over time. This is analogous to existing approaches in ecology, which have defined SDP transition probabilities with probability density functions that include the current system state as an input
  <span class="sup">
   <a ref-type="bibr" rid="CR45" href="#CR45">45</a>,
   <a ref-type="bibr" rid="CR46" href="#CR46">46</a>
  </span>.
 </p>
 <p id="Par36" xmlns="http://www.w3.org/1999/xhtml">Optimal policies are derived by recursively solving the Bellman equation:
  <div id="Equ8" class="disp-formula">
   <span class="label">8</span>
   <div class="alternatives">
    <span id="M19" class="tex-math">\documentclass[12pt]{minimal} \usepackage{amsmath} \usepackage{wasysym} \usepackage{amsfonts} \usepackage{amssymb} \usepackage{amsbsy} \usepackage{mathrsfs} \usepackage{upgreek} \setlength{\oddsidemargin}{-69pt} \begin{document}$${\mathbf{V}}_t\left( {{\mathbf{s}}_t} \right) = {\mathrm{argmin}}_{a \in {\mathbf{A}}}C\left( {{\mathbf{s}}_t,a_t,t} \right) + \gamma \ast \Sigma _{s \in {\mathbf{S}}}{\mathrm{P}}\left( {s_{t + {1}}|s_t,a_t} \right) \ast {\mathbf{V}}_{t + {1}}\left( {{\mathbf{s}}_{t + {1}}} \right)$$\end{document}</span>
    <div id="M20" class="math">
     <div class="msub">
      <div class="mrow">
       <span mathvariant="bold" class="mi">V</span>
      </div>
      <div class="mrow">
       <span class="mi">t</span>
      </div>
     </div>
     <div close=")" open="(" separators="" class="mfenced">
      <div class="mrow">
       <div class="msub">
        <div class="mrow">
         <span mathvariant="bold" class="mi">s</span>
        </div>
        <div class="mrow">
         <span class="mi">t</span>
        </div>
       </div>
      </div>
     </div>
     <span class="mo">=</span>
     <div class="msub">
      <div class="mrow">
       <span mathvariant="normal" class="mi">argmin</span>
      </div>
      <div class="mrow">
       <span class="mi">a</span>
       <span class="mo">∈</span>
       <span mathvariant="bold" class="mi">A</span>
      </div>
     </div>
     <span class="mi">C</span>
     <div close=")" open="(" separators="" class="mfenced">
      <div class="mrow">
       <div class="msub">
        <div class="mrow">
         <span mathvariant="bold" class="mi">s</span>
        </div>
        <div class="mrow">
         <span class="mi">t</span>
        </div>
       </div>
       <span class="mo">,</span>
       <div class="msub">
        <div class="mrow">
         <span class="mi">a</span>
        </div>
        <div class="mrow">
         <span class="mi">t</span>
        </div>
       </div>
       <span class="mo">,</span>
       <span class="mi">t</span>
      </div>
     </div>
     <span class="mo">+</span>
     <span class="mi">γ</span>
     <span class="mo">*</span>
     <div class="msub">
      <div class="mrow">
       <span class="mi">Σ</span>
      </div>
      <div class="mrow">
       <span class="mi">s</span>
       <span class="mo">∈</span>
       <span mathvariant="bold" class="mi">S</span>
      </div>
     </div>
     <span mathvariant="normal" class="mi">P</span>
     <div close=")" open="(" separators="" class="mfenced">
      <div class="mrow">
       <div class="msub">
        <div class="mrow">
         <span class="mi">s</span>
        </div>
        <div class="mrow">
         <span class="mi">t</span>
         <span class="mo">+</span>
         <span class="mn">1</span>
        </div>
       </div>
       <span class="mo">∣</span>
       <div class="msub">
        <div class="mrow">
         <span class="mi">s</span>
        </div>
        <div class="mrow">
         <span class="mi">t</span>
        </div>
       </div>
       <span class="mo">,</span>
       <div class="msub">
        <div class="mrow">
         <span class="mi">a</span>
        </div>
        <div class="mrow">
         <span class="mi">t</span>
        </div>
       </div>
      </div>
     </div>
     <span class="mo">*</span>
     <div class="msub">
      <div class="mrow">
       <span mathvariant="bold" class="mi">V</span>
      </div>
      <div class="mrow">
       <span class="mi">t</span>
       <span class="mo">+</span>
       <span class="mn">1</span>
      </div>
     </div>
     <div close=")" open="(" separators="" class="mfenced">
      <div class="mrow">
       <div class="msub">
        <div class="mrow">
         <span mathvariant="bold" class="mi">s</span>
        </div>
        <div class="mrow">
         <span class="mi">t</span>
         <span class="mo">+</span>
         <span class="mn">1</span>
        </div>
       </div>
      </div>
     </div>
    </div>
    <div xlink:href="41467_2019_9677_Article_Equ8.gif" position="anchor" class="graphic" xmlns:xlink="http://www.w3.org/1999/xlink"/>
   </div>
  </div>
 </p>
 <p id="Par37" xmlns="http://www.w3.org/1999/xhtml">Where 
  <span class="italic">t</span> ∈ {1… 5} is a 20-year time period ranging from 2001–2020 for 
  <span class="italic">t</span> = 1 to 2081–2100 for 
  <span class="italic">t</span> = 5. 
  <span class="bold">S</span> is the state space, or set of possible state values, which includes: mean temperature 
  <span class="bold">S</span>
  <span class="sup">T</span> (which ranges from 25 to 33 °C at 0.05 °C increments) and mean precipitation 
  <span class="bold">
   <span class="italic">S</span>
  </span>
  <span class="sup">
   <span class="bold">
    <span class="italic">P</span>
   </span>
  </span> averaged over a 20-year period (which ranges from 66 to 97 mm month
  <span class="sup">−1</span> at 1 mm month
  <span class="sup">−1</span> increments) and available infrastructure 
  <span class="bold">S</span>
  <span class="sup">Z</span>. 
  <span class="bold">S</span>
  <span class="sup">Z</span> = {1,…,4} which correspond, respectively, to a small infrastructure alternative, large infrastructure alternative, flexible unexpanded alternative, and flexible expanded alternative. The alternatives include a set of dams (planning scenarios A and B) or a set of desalination plants (planning scenario C). 
  <span class="bold">s</span>
  <sub>
   <span class="italic">t</span>
  </sub> ∈ 
  <span class="bold">S</span> is the system state at time 
  <span class="italic">t</span> comprised of 
  <span class="italic">T</span>
  <sub>
   <span class="italic">t</span>
  </sub> (temperature state at time 
  <span class="italic">t</span>), 
  <span class="italic">P</span>
  <sub>
   <span class="italic">t</span>
  </sub> (precipitation state at time 
  <span class="italic">t</span>), and 
  <span class="italic">Z</span>
  <sub>
   <span class="italic">t</span>
  </sub> (infrastructure state at time 
  <span class="italic">t</span>). 
  <span class="italic">T</span>
  <sub>
   <span class="italic">t</span>
  </sub>, 
  <span class="italic">P</span>
  <sub>
   <span class="italic">t</span>
  </sub> and 
  <span class="italic">Z</span>
  <sub>
   <span class="italic">t</span>
  </sub> are assumed independent. Therefore, the transition probabilities, P(
  <span class="bold">s</span>
  <sub>
   <span class="italic">t</span>+1
  </sub> | 
  <span class="bold">s</span>
  <sub>
   <span class="italic">t</span>
  </sub>, 
  <span class="italic">a</span>
  <sub>
   <span class="italic">t</span>
  </sub>) * 
  <span class="bold">V</span>
  <sub>
   <span class="italic">t</span>+1
  </sub>(
  <span class="bold">s</span>
  <sub>
   <span class="italic">t</span>+1
  </sub>), are estimated as three independent transition vectors: the transition vector for 
  <span class="italic">T</span>
  <sub>
   <span class="italic">t</span>
  </sub> is described in Eqs. (
  <a rid="Equ4" ref-type="" href="#Equ4">4</a>) and (
  <a rid="Equ5" ref-type="" href="#Equ5">5</a>) and independent of 
  <span class="bold">a</span>
  <sub>
   <span class="italic">t</span>
  </sub> and 
  <span class="italic">P</span>
  <sub>
   <span class="italic">t</span>
  </sub> is analogous to 
  <span class="italic">T</span>
  <sub>
   <span class="italic">t</span>
  </sub>. 
  <span class="italic">Z</span>
  <sub>
   <span class="italic">t</span>
  </sub> transitions are deterministic based on the current capacity and action to add capacity as described hereafter.
 </p>
 <p id="Par38" xmlns="http://www.w3.org/1999/xhtml">
  <span class="bold">A</span> is the action space, or set of possible actions. 
  <span class="italic">a</span>
  <sub>
   <span class="italic">t</span>
  </sub> ∈ 
  <span class="bold">A</span> is an action at time 
  <span class="italic">t</span>, The action 
  <span class="italic">a</span>
  <sub>
   <span class="italic">t</span>
  </sub> describes whether a static or flexible dam is chosen, and whether infrastructure capacity is expanded in later time periods. 
  <span class="bold">A</span> = {0,…,4} which correspond, respectively, to no change, adding a small static alternative, adding a large static alternative, adding a flexible alternative, and expanding the flexible alternative. The choices are constrained by time period and available infrastructure such that 
  <span class="italic">a</span>
  <sub>
   <span class="italic">t=1</span>
  </sub> ∈ {1,…,3} ∀ 
  <span class="italic">Z</span>
  <sub>
   <span class="italic">t</span>
  </sub>; 
  <span class="italic">a</span>
  <sub>
   <span class="italic">t</span>
  </sub> ∈ {0,4} when 
  <span class="italic">Z</span>
  <sub>
   <span class="italic">t</span>
  </sub> = 3 ∀ 
  <span class="italic">t</span> = 2,…,5; 
  <span class="italic">a</span>
  <sub>
   <span class="italic">t</span>
  </sub> ∈ {0}∀ 
  <span class="italic">Z</span>
  <sub>
   <span class="italic">t</span>
  </sub> = {1,2,4}, 
  <span class="italic">t</span> = 2,…,5.
 </p>
 <p id="Par39" xmlns="http://www.w3.org/1999/xhtml">
  <span class="bold">
   <span class="italic">V</span>
  </span> is the optimal policy or choice of action. 
  <span class="italic">γ</span> is the discount rate. Costs 
  <span class="italic">C</span> include the capital costs of infrastructure and damages if the infrastructure fails to meet reliability targets such that 
  <span class="italic">C</span> 
  <span class="bold">
   <span class="italic">=</span>
  </span> 
  <span class="italic">I</span> (
  <span class="bold">
   <span class="italic">s</span>
  </span>
  <sub>
   <span class="bold">
    <span class="italic">t</span>
   </span>
  </sub>, 
  <span class="italic">a</span>
  <sub>
   <span class="italic">t</span>
  </sub>) + 
  <span class="italic">D</span>
  <span class="sup">∗</span>
  <span class="italic">U</span>(
  <span class="bold">
   <span class="italic">s</span>
  </span>
  <sub>
   <span class="bold">
    <span class="italic">t</span>
   </span>
  </sub>, 
  <span class="italic">a</span>
  <sub>
   <span class="italic">t</span>
  </sub>), where 
  <span class="italic">I</span> is the cost of the infrastructure including capital costs (capex) and operating costs (opex). Desalination opex in planning scenario A is a function of the water produced in each time period. 
  <span class="italic">D</span> is unit cost of damages incurred for unmet water demand, set at 15$ m
  <span class="sup">−3</span> in our base case based on estimates of water productivity in Kenya from the World Bank
  <span class="sup">
   <a ref-type="bibr" rid="CR47" href="#CR47">47</a>
  </span>. 
  <span class="italic">U</span> is the volume of unmet demand as a function of the climate states, existing infrastructure, and any new infrastructure brought online in time t. 
  <span class="italic">U</span> = 0 in 
  <span class="italic">t</span> = 1, reflecting that 
  <span class="italic">t</span> = 1 is a planning and construction period and performance is not measured until the beginning of the second 20-year time period.
 </p>
</sec>
