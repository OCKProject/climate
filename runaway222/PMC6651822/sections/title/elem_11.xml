<?xml version="1.0" encoding="UTF-8"?>
<sec id="sec3dot3-sensors-19-02940" class="sec">
 <div class="title" xmlns="http://www.w3.org/1999/xhtml">3.3. The System Components</div>
 <p xmlns="http://www.w3.org/1999/xhtml">The overall system proposed comprises two main components: the PulsAir mobile application and the platform or processing data ecosystem. Design iterations are transversal to the system components development, allowing an incremental buildout progress. In the following sections, the system components, which naturally emerged during the iterative and co-creation design processes, are described in detail.</p>
 <sec id="sec3dot3dot1-sensors-19-02940" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">3.3.1. PulsAir Mobile Application</div>
  <p xmlns="http://www.w3.org/1999/xhtml">The mobile application was developed enabling perception and sensing to be monitored and evolve over time. It collects and integrates environmental data and health information including patterns, demographics, and health and weather statistics, in order to provide citizens and authorities with a decision-making tool. The application was conceived as an engine to support valuable data interaction, data consumption, data capturing, and data sharing. The use of wearables linked to the application enables participatory sensing by using these devices as tools to collect and share health and air quality data obtained from personal sensing units. The application also gathers and provides personalised information by scheduling different type of questionnaires related to health and air quality, educational contents, and feedback to the users; the contents are personalized according to the usage of the app, the answered questions, and the profile of the user. 
   <a rid="sensors-19-02940-t001" ref-type="table" href="#sensors-19-02940-t001">Table 1</a> presents a list of the selected questionnaires.
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">The mobile application is composed of two main modules:
   <div list-type="bullet" class="list">
    <div class="list-item">
     <p>“Me” module contains information about the citizen. It gathers all the specific information regarding the user, from questionnaires and from the wearable devices (e.g., Fitbit band). It also provides specific educational content to promote healthy lifestyles and feedback about the health risks using state of the art models for cardiovascular risk (Framingham, [
      <a rid="B30-sensors-19-02940" ref-type="bibr" href="#B30-sensors-19-02940">30</a>]), TD2M (FindRisk, [
      <a rid="B34-sensors-19-02940" ref-type="bibr" href="#B34-sensors-19-02940">34</a>]), and asthma (Verlato, [
      <a rid="B35-sensors-19-02940" ref-type="bibr" href="#B35-sensors-19-02940">35</a>]). The “Me” module shows the daily physical activity (steps) of the user and historical data of total activity from the previous days. The wearable device information is integrated in the app. The user can also access the “Health tips” to learn how to improve lifestyle based on the results of the answered questionnaires.
     </p>
    </div>
    <div class="list-item">
     <p>“My city” module contains all the data related to the city and neighbourhood of the user. Through this module, the user has access to a page that summarizes the status of the city (i.e., pollution levels), specific contents about the city, the pollutants, and possible more sustainable mobility and household habits that can contribute to the reduction of polluted emissions. The module provides a detailed map to show pollution levels in different areas of the city. In addition, it allows the user to tag or input data through questionnaires to inform about the status of the neighbourhood. The information is personalized for each user, aiming at empowering the citizens with personal tools that estimate and manage their pollution exposure, and thus take healthier actions (i.e., less polluted routes when walking).</p>
    </div>
   </div>
  </p>
  <sec class="sec">
   <div class="title" xmlns="http://www.w3.org/1999/xhtml">Mobile Application Interface</div>
   <p xmlns="http://www.w3.org/1999/xhtml">
    <a ref-type="fig" rid="sensors-19-02940-f003" href="#sensors-19-02940-f003">Figure 3</a> shows the final interface design of the application, specifically the following main elements:
   </p>
   <div list-type="bullet" class="list" xmlns="http://www.w3.org/1999/xhtml">
    <div class="list-item">
     <p>Homepage, final design follows a card layout style with a simple and clean background. The cards give access to the different modules of the application, as shown in 
      <a ref-type="fig" rid="sensors-19-02940-f003" href="#sensors-19-02940-f003">Figure 3</a>a. From top to bottom, the cards show the following elements:
     </p>
     <div list-type="order" class="list">
      <div class="list-item">
       <p>“Me” card, shows the information about the number of questionnaires completed and the risk of developing cardiovascular disease, type 2 diabetes, or asthma, based on the results of the questionnaires completed.</p>
      </div>
      <div class="list-item">
       <p>“My City” card, presents a summary of the air quality and weather conditions at the current location of the user.</p>
      </div>
      <div class="list-item">
       <p>“Weekly Activity” card, presents the summary of the activities performed in terms of calories burnt, steps, and kilometres travelled. This information is collected through the activity tracker device.</p>
      </div>
     </div>
    </div>
   </div>
   <div list-type="bullet" class="list" xmlns="http://www.w3.org/1999/xhtml">
    <div class="list-item">
     <p>The “Me” module screen shows the information gathered from the users; the wearable data and the health risks (
      <a ref-type="fig" rid="sensors-19-02940-f003" href="#sensors-19-02940-f003">Figure 3</a>b). The menu, at the bottom of the screen, is used to access the answered questionnaires and suggested educational content and recommendations.
     </p>
    </div>
    <div class="list-item">
     <p>The “My City” module shows the air quality and weather information about the city and the current user’s GPS position (
      <a ref-type="fig" rid="sensors-19-02940-f003" href="#sensors-19-02940-f003">Figure 3</a>c). The menu, at the button on the screen, gives access to a pollution map and content related to air pollution.
     </p>
    </div>
    <div class="list-item">
     <p>The usage of the application triggers the gamification engine, allowing users to earn points to level up through the five levels available (
      <a ref-type="fig" rid="sensors-19-02940-f003" href="#sensors-19-02940-f003">Figure 3</a>d). The application starts with a sad avatar living in a dirty city; if the users perform the suggested activity within the application (i.e., questionnaire, educational contents, changes in habits), they will be taken to the next level until they reach the final level that shows a happy avatar living in a clean city (
      <a ref-type="fig" rid="sensors-19-02940-f003" href="#sensors-19-02940-f003">Figure 3</a>e). The Leaderboard screen shows the user’s collected points (
      <a ref-type="fig" rid="sensors-19-02940-f003" href="#sensors-19-02940-f003">Figure 3</a>f) in order to boost competitions among the citizens.
     </p>
    </div>
   </div>
  </sec>
  <sec class="sec">
   <div class="title" xmlns="http://www.w3.org/1999/xhtml">Mobile Application Workflow</div>
   <p xmlns="http://www.w3.org/1999/xhtml">The application workflow was conceived as a bidirectional interactive path. On one hand, the user shares gathered data with the platform, from physical activity measurements through wearable activity trackers and by answering the questionnaires. On the other hand, users receive back general or customized interventions depending on their profile. This intervention is composed of educational health and environmental guidelines or content, health risk awareness, geo-localized air pollution exposure and data, as well as gamification-oriented information and rewards based on their performance. This intervention aims at making data relevant to citizens to support greener and healthier sustainable behaviours. The process was defined using an incremental strategy, which comprises the following steps:
    <div list-type="order" class="list">
     <div class="list-item">
      <p>Monitor: the application tracks GPS position and integrates data of wellness sensor (e.g., Fitbit) and air quality. From time to time, some questionnaire are triggered to the users. The application also tracks the degree of use of the application.</p>
     </div>
     <div class="list-item">
      <p>Assess: the gathered information is used to assess the citizens in terms of health risks (risk of the onset of T2D, asthma, and cardiovascular disease).</p>
     </div>
     <div class="list-item">
      <p>Personalize: according to the assessment, the application triggers specific contents and recommendations to the users. The application can identify healthy or green behaviour that needs to be improved and prepare a set of tips to help the user to be aware and understand the importance of modifying a specific behaviour.</p>
     </div>
     <div class="list-item">
      <p>Act: the application promotes specific healthy habits by proposing a specific goal to the users (e.g., 8000 daily steps). According to this goal, the application creates a follow-up procedure to check if the goal is achieved in the proposed time (e.g., one day).</p>
     </div>
     <div class="list-item">
      <p>Support and reward: when the user finish the proposed activity, the application triggers a mechanism of reward and supports the user to be motivated.</p>
     </div>
    </div>
   </p>
   <p xmlns="http://www.w3.org/1999/xhtml">
    <a ref-type="fig" rid="sensors-19-02940-f004" href="#sensors-19-02940-f004">Figure 4</a> shows an example of the workflow of a specific case: health risk.
   </p>
  </sec>
 </sec>
 <sec id="sec3dot3dot2-sensors-19-02940" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">3.3.2. Data Acquisition</div>
  <p xmlns="http://www.w3.org/1999/xhtml">The proposed approach gathers multilevel data coming from heterogeneous sources represented by structured or unstructured data, including citizen science. The data acquisition process is supported by both the mobile application and the data ecosystem, which have an embedded functional model that acquires scientifically sound information to further support predictive outputs and changes of environmental and health risks that could affect citizens and support policy making. The system continuously monitors pollution, as well as health and citizens’ data through data collection protocols and questionnaires (
   <a ref-type="fig" rid="sensors-19-02940-f004" href="#sensors-19-02940-f004">Figure 4</a>) to provide evidence of the importance of detecting long-term environmental-health risks and ecosystem changes. 
   <a rid="sensors-19-02940-t002" ref-type="table" href="#sensors-19-02940-t002">Table 2</a> summarizes the types of information that are gathered in each data flow step (
   <a ref-type="sec" rid="sec2dot2dot2-sensors-19-02940" href="#sec2dot2dot2-sensors-19-02940">Section 2.2.2</a>) within the proposed technical context.
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">The proposed approach gives the opportunity to create a data science approach to understand the relationship of the urban environment with the health of the citizens. The combination of different contextual data (i.e., mobile, user, environmental, and big data) generates new opportunities to merge different qualitative and quantitative methods, subjective and objective data, as well as sensitive and aggregated data to build new preventive strategies based on citizens’ needs.</p>
 </sec>
 <sec id="sec3dot3dot3-sensors-19-02940" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">3.3.3. Big Data-Oriented Ecosystem</div>
  <p xmlns="http://www.w3.org/1999/xhtml">The big data-oriented ecosystem integrates the heterogeneous datasets and resources in a data lake, the urban data lake, under a big data architecture paradigm that allows the production and consumption of data flows. The ecosystem is the operational and transactional backend that supports all resources, open source toolsets, and operational data for developing and packaging services that support the modelling and real-time data provision/consumption from the mobile application. The data ecosystem acts as a backend that houses different physical nodes servers where information is stored, processed, and retrieved. This backend facilitates the delivery of services through the provision of distributed technologies, integration of standards, further scalability for science growth, and resource component management based in a distributed computing paradigm [
   <a rid="B36-sensors-19-02940" ref-type="bibr" href="#B36-sensors-19-02940">36</a>].
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">The data ecosystem responds to four levels of applications or contexts of information where data are gathered and processed: the mobile context (data interaction gathering), user context (citizen science data gathering), environmental context (data sampling and collection), and big data context (data fusion). These contexts provide different interlinked spaces, which ensure the integration of data collection and processing protocols needed to adhere to scientific standards, especially for publicly collected data. 
   <a ref-type="fig" rid="sensors-19-02940-f005" href="#sensors-19-02940-f005">Figure 5</a> shows a diagram of the data ecosystem.
  </p>
  <sec class="sec">
   <div class="title" xmlns="http://www.w3.org/1999/xhtml">Mobile Context</div>
   <p xmlns="http://www.w3.org/1999/xhtml">This represents the data layer that supports the data consumption and interaction through the application. It provides a tool that hides the complexity of the data flows and provides the information in one coherent integrated visualization layer. This layer allows the user to capture, gather, and share personal data from the socio-demographic, health status, neighbourhood perception, geolocation, quality of life, and so on. Furthermore, the user can share the activity data of a health tracker device (e.g., Fitbit) and the GPS position. The application continuously displays information to the user, including health risks (e.g., asthma, cardiovascular, and type 2 diabetes risks) [
    <a rid="B37-sensors-19-02940" ref-type="bibr" href="#B37-sensors-19-02940">37</a>], feedback information, sensing services from the wearable activity tracker (e.g., steps, calories burnt, and kilometres walked), current location, and current pollution exposure values, among others. It is based on the following software artefacts able to run in different the different smartphones brand types (iOS and Android):
    <div list-type="bullet" class="list">
     <div class="list-item">
      <p>Graphical User Interfaces (GUI): they represent all the screens as described in 
       <a ref-type="sec" rid="sec3dot3dot1-sensors-19-02940" href="#sec3dot3dot1-sensors-19-02940">Section 3.3.1</a>. They refer to four main activities for the users: the Citizen module that refers to the individual information and ways to promote healthy habits. The City module contains all the screens related to the health, green behavior, and pollution maps. “Preferences” contains all the screens for user’s preferences, and the “Home” page is the initial interaction flow.
      </p>
     </div>
     <div class="list-item">
      <p>Intervention Engine (IE): this is a mechanism to provide the intervention in the application. It is based on a scheduler that executes a questionnaire engine able to process the intervention by proposing a set of activities to the user to promote green and healthy habits.</p>
     </div>
     <div class="list-item">
      <p>Feedback Engine (FE): this is the logic that triggers the proper feedback to the users. There are multi modalities of feedbacks depending on the context and nature of the data. Feedback can be in form of charts (e.g., evolution of the daily steps from the health tracker), educational content (in form of texts, infographics, web pages, or videos), personalized feedbacks (messages build based on rules of a decision support system), or notifications or reminders that are triggered to push users to perform an activity.</p>
     </div>
     <div class="list-item">
      <p>Sensing Service (SE): the artefact abstracts the complexity of the sensor connection and provides access to the internal sensor of the mobile phone (currently the GPS), sensors that are available on the WiFi network of the users, and third-party services.</p>
     </div>
     <div class="list-item">
      <p>Synchronization Service (SS): this service communicates with the big data context to transfer the citizen data to the citizen database; the position of the user is then used (if available) to assess the environmental context and enrich the feedback to the users (e.g., pollution maps).</p>
     </div>
     <div class="list-item">
      <p>App Database (AD): the service offers full data persistence inside the smartphone. The database is securely encrypted and stored in a non-accessible area of the smartphone.</p>
     </div>
    </div>
   </p>
  </sec>
  <sec class="sec">
   <div class="title" xmlns="http://www.w3.org/1999/xhtml">User Context</div>
   <p xmlns="http://www.w3.org/1999/xhtml">This represents the world of IoT devices and wearable devices that can be used to get information about health status, presence, geolocation, and trajectories followed in space and time by single citizens using the application or a specific service. Users can decide to connect a specific device (e.g., Fitbit) and share the activity data with the platform. This research considered the use of a health tracker (i.e., Fitbit), but the types of devices can be extended to other health devices like holters, blood pressure monitors, and so on. This architectural layer allows citizen science data gathering that is uploaded in the cloud infrastructure.</p>
  </sec>
  <sec class="sec">
   <div class="title" xmlns="http://www.w3.org/1999/xhtml">Environmental Context </div>
   <p xmlns="http://www.w3.org/1999/xhtml">This provides relevant information on the environment in the city area where the user is located. Data are captured from public information measurement nodes or infrastructure; mainly produced by the city sensors’ network (i.e., fixed or mobile sensors) or satellites (e.g., satellite optical or hyperspectral images). Additionally, these data are coupled with public services data (e.g., public health data) and resources, such as transportation, police, or other related public services aiming at supporting mobility.</p>
   <p xmlns="http://www.w3.org/1999/xhtml">Furthermore, this layer supports the data sampling and collection process. The data obtained comes from public access sources, which allows the most relevant information to be integrated in a single system for the user, and thus uploaded to the cloud infrastructure. The most relevant data gathered within the environmental and public services context comprise the following:
    <div list-type="bullet" class="list">
     <div class="list-item">
      <p>Air Quality (AQ): Air quality data of the area where the user is located, coming from fixed and mobile sensors or measurement stations deployed throughout the city or satellites, among others.</p>
     </div>
     <div class="list-item">
      <p>Weather: updated information of the weather in the user’s location.</p>
     </div>
     <div class="list-item">
      <p>Mobility: public transport stops, pedestrian routes, bike lanes, public rental bicycles, and other types of green transportation.</p>
     </div>
     <div class="list-item">
      <p>Public Services: information of police and firemen stations, public health organizations, hospitals, and schools, among others.</p>
     </div>
    </div>
   </p>
  </sec>
  <sec class="sec">
   <div class="title" xmlns="http://www.w3.org/1999/xhtml">Big Data Context</div>
   <p xmlns="http://www.w3.org/1999/xhtml">This represents the core business logic that gathers all the contextual information of the user and uses it to assess the individual health risk and pollution exposure. This layer supports data fusion, which provides personalized interventions that are implemented considering a context for risk and resilience, which results from the local policies and directives‘ assessment on urban health and resilience [
    <a rid="B38-sensors-19-02940" ref-type="bibr" href="#B38-sensors-19-02940">38</a>]. The intervention is then personalized according to the available local resources in terms of educational materials, events to join, recommended places, or challenging activities to adopt specific household or healthy behaviours.
   </p>
   <p xmlns="http://www.w3.org/1999/xhtml">Furthermore, this layer enables data fusion, which supports the integration of data and knowledge from several sources. Three data fusion schemes are used: (i) data association, (ii) state estimation, and (iii) decision fusion. These schemes support the combination of data from multisensory environments and data modelling, and allow parameter estimation from the multiple sources by providing resources that enable multi-level process dealing with the association, correlation, and combination of data and information from single and multiple sources to complete and provide timely assessments of situations and their significance.</p>
   <p xmlns="http://www.w3.org/1999/xhtml">The big data context, presented in 
    <a ref-type="fig" rid="sensors-19-02940-f005" href="#sensors-19-02940-f005">Figure 5</a>, comprises three main components: storage infrastructure, modelling and predictive resources, and visualization (presentation) resources. The storage infrastructure component stores all readings in a central repository, named an “urban data lake”. Data are harvested and semantically treated to allow interoperability. 
   </p>
   <p xmlns="http://www.w3.org/1999/xhtml">The model and intervention resources allow data modelling and abstraction over the collected data enabling data consumption; aiming at linking health, citizens’, and environmental data to detect and predict risk factors. Spatio-temporal and risk stratification models, as well as statistical analysis (such as regression and correlation analysis), are used to personalize environmental and health risk estimations, support interpolation of data, estimate pollution concentrations on urban spaces, or enable individual assessments in these domains [
    <a rid="B39-sensors-19-02940" ref-type="bibr" href="#B39-sensors-19-02940">39</a>]. In this context, the models comprise the data production and fusion stage, in order to support personalized interventions and information for the app, such as air pollution level and exposure to be presented in the maps (e.g., users’ data consumption) [
    <a rid="B40-sensors-19-02940" ref-type="bibr" href="#B40-sensors-19-02940">40</a>]. The presentation resources push produces data to the mobile application, enabling data and information presentation, and interaction trough the mobile application modules and maps. This allows the user to input data, sense-based air quality inputs, and present data to application modules (e.g., pollution value points for the pollution exposure map).
   </p>
  </sec>
 </sec>
</sec>
