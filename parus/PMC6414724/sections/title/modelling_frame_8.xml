<?xml version="1.0" encoding="UTF-8"?>
<sec id="Sec9" class="sec">
 <div class="title" xmlns="http://www.w3.org/1999/xhtml">Modelling framework</div>
 <p id="Par17" xmlns="http://www.w3.org/1999/xhtml">We first developed three sets of trivariate models based exclusively upon each type of environmental predictor (henceforth ‘individual’ models): (1) Climate, (2) Land cover, and (3) EFAs (see Fig. 
  <a rid="Fig2" ref-type="fig" href="#Fig2">2</a> for a flow diagram of the modelling approach and steps). We also developed an additional set of models by using the environmental suitability predicted from the ‘individual’ models as predictor variables to integrate in a balanced way all possible combinations of these three environmental drivers within the modelling framework (henceforth ‘combined’ models) (see e.g.
  <span class="sup">
   <a ref-type="bibr" rid="CR30" href="#CR30">30</a>,
   <a ref-type="bibr" rid="CR48" href="#CR48">48</a>,
   <a ref-type="bibr" rid="CR49" href="#CR49">49</a>
  </span>): (4) Climate + Land cover, (5) Climate + EFAs; (6) Land cover + EFAs, and (7) Climate + Land cover + EFAs (Fig. 
  <a rid="Fig2" ref-type="fig" href="#Fig2">2</a>). Both individual and combined ENMs were fitted with a maximum number of three variables to control model complexity, increase model transferability
  <span class="sup">
   <a ref-type="bibr" rid="CR17" href="#CR17">17</a>,
   <a ref-type="bibr" rid="CR61" href="#CR61">61</a>
  </span>, and make model performance and transferability comparable
  <span class="sup">
   <a ref-type="bibr" rid="CR61" href="#CR61">61</a>
  </span> (Fig. 
  <a rid="Fig2" ref-type="fig" href="#Fig2">2</a>). Climate models were calibrated at local (Gerês-Xurés) scale at 230 m resolution (henceforth ‘local climate models’) and then combined with the environmental suitability predicted from ENMs based upon land cover and/or EFAs (henceforth ‘non-hierarchical approach’). Climate models were also calibrated at the Iberian Peninsula scale (henceforth ‘regional climate models’) at 10-km resolution. These regional climate models were then directly projected (‘direct downscaling approach’, see
  <span class="sup">
   <a ref-type="bibr" rid="CR62" href="#CR62">62</a>–
   <a ref-type="bibr" rid="CR64" href="#CR64">64</a>
  </span>) to the extent and resolution of Gerês-Xurés Mountains for both 2000 and 2010. These local climate projections were used as predictor variables into combined models to hierarchically integrate climate suitability calibrated at regional scale with the environmental suitability predicted from ENMs based upon land cover and/or EFAs at local scale (henceforth ‘hierarchical approach’, 
  <span class="italic">sensu</span>
  <span class="sup">
   <a ref-type="bibr" rid="CR41" href="#CR41">41</a>,
   <a ref-type="bibr" rid="CR42" href="#CR42">42</a>
  </span>).
  <div id="Fig2" class="fig">
   <span class="label">Figure 2</span>
   <div class="caption">
    <p>Flow diagram of the modelling approach and steps (see Material and Methods for a detailed description of each step).</p>
   </div>
   <div xlink:href="41598_2019_40766_Fig2_HTML" id="d29e1655" class="graphic" xmlns:xlink="http://www.w3.org/1999/xlink"/>
  </div>
 </p>
 <p id="Par18" xmlns="http://www.w3.org/1999/xhtml">All ENMs were calibrated using seven modelling algorithms available in the R package ‘Biomod2’, version 3.3–7
  <span class="sup">
   <a ref-type="bibr" rid="CR65" href="#CR65">65</a>
  </span>: generalized linear models (GLM), generalized additive models (GAM), generalized boosted regression models (GBM), random forest (RF), factorized distribution algorithm (FDA), multivariate adaptive regression splines (MARS) and artificial neural networks (ANN). For each technique, we used the default settings in biomod2 because these settings are optimized for SDMs (see
  <span class="sup">
   <a ref-type="bibr" rid="CR66" href="#CR66">66</a>
  </span>). Presence-background modelling techniques such as MaxEnt or GARP were not considered as they are designed to cope with the lack of absence data
  <span class="sup">
   <a ref-type="bibr" rid="CR67" href="#CR67">67</a>
  </span>, which is not the case, and did not show significant improvement in terms of predictive accuracy. We applied a 30-fold split-sample procedure by randomly selecting 70% of the data for calibration and the remaining 30% for model evaluation (hereafter ‘crossvalitation’). Our results for the area under the curve (AUC) of the receiver-operating characteristic (ROC), true skill statistic (TSS), the Cohen’s kappa coefficient were highly correlated (see Supplementary Table 
  <a rid="MOESM3" ref-type="media" href="#MOESM3">S3.1</a>), and consequently, we only present results on AUC − a threshold-independent method − as a means of evaluating model performance
  <span class="sup">
   <a ref-type="bibr" rid="CR68" href="#CR68">68</a>
  </span>. In order to quantify model ability to accurately predict presences, we also computed sensitivity (i.e. the proportion of presences that were correctly predicted) as indicator of omission errors
  <span class="sup">
   <a ref-type="bibr" rid="CR68" href="#CR68">68</a>
  </span>. We applied the weighted average approach for computing a consensus (hereafter ‘ensemble model’) of the single models by calculating the weighted average of all single models with AUC &gt; 0.65, using AUC values as model weights. This consensus method provides significantly more robust predictions than all the single-models and other consensus methods
  <span class="sup">
   <a ref-type="bibr" rid="CR69" href="#CR69">69</a>
  </span>. Models with AUC higher than 0.65 (instead of the more usual 0.7)
  <span class="sup">
   <a ref-type="bibr" rid="CR70" href="#CR70">70</a>
  </span> were considered in the consensus method in order to obtain an ensemble model for all species, thereby ensuring a meaningful set of results to test our hypotheses and avoiding misleading conclusions that might result from considering only AUC values for those species with the highest model accuracies.
 </p>
</sec>
