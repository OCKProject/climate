<?xml version="1.0" encoding="UTF-8"?>
<sec disp-level="1" class="sec">
 <div class="title" xmlns="http://www.w3.org/1999/xhtml">Methods</div>
 <sec disp-level="2" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Plant material and sampling design</div>
  <p xmlns="http://www.w3.org/1999/xhtml">We obtained silica-dried leaf material from 38 populations of 
   <span class="italic">Emmenopterys henryi</span> throughout its range (
   <a ref-type="supplementary-material" rid="S1" href="#S1">Table S1</a>, 
   <a ref-type="fig" rid="f1" href="#f1">Fig. 1A</a>; see 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Method S1</a> for more details of the study species). In each population, representative samples of 10–20 plants were taken, resulting in a total of 433 individuals. Total genomic DNA was extracted from the dried leaf tissue using a DNeasy plant tissue kit (Qiagen). All samples were sequenced at three intergenic spacer (IGS) regions of chloroplast DNA (cpDNA), while a subset of individuals (
   <span class="italic">n</span> = 212) was also sequenced at the entire internal transcribed spacer (ITS) region of nuclear ribosomal DNA (nrDNA). Of these 433 individuals, 394 (representing 37 populations; population S23 with 1 individual was excluded) were surveyed for AFLPs (
   <a ref-type="supplementary-material" rid="S1" href="#S1">Table S1</a>; 
   <a ref-type="fig" rid="f1" href="#f1">Fig. 1A</a>). 
   <span class="italic">Pinckneya bracteata</span> (Bartram) Raf., collected from the JC Raulston Arboretum (Raleigh, NC, USA), was selected as an outgroup for the phylogenetic analyses based on a previous molecular phylogenetic study of Rubiaceae
   <a ref-type="bibr" rid="b33" href="#b33">33</a>. Voucher specimens of this species and all sampled populations of 
   <span class="italic">E. henryi</span> are stored at the Herbarium of Zhejiang University (HZU; Hangzhou, Zhejiang, China).
  </p>
 </sec>
 <sec disp-level="2" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">DNA extraction, DNA sequencing and AFLP fingerprinting</div>
  <p xmlns="http://www.w3.org/1999/xhtml">For the phylogeographic DNA analyses, we sequenced three cpDNA-IGS regions (
   <span class="italic">psb</span>A–
   <span class="italic">trn</span>H, 
   <span class="italic">trn</span>L–
   <span class="italic">trn</span>F, 
   <span class="italic">trn</span>T–
   <span class="italic">trn</span>L) and the ITS region (i.e. ITS1 + 5.8S + ITS2). The primers and methodology for amplification of these four DNA regions were described in Shaw 
   <span class="italic">et al</span>.
   <a ref-type="bibr" rid="b57" href="#b57">57</a> and Gielly 
   <span class="italic">et al</span>.
   <a ref-type="bibr" rid="b58" href="#b58">58</a>. Sequences were generated on an ABI 377XL DNA sequencer and were edited, assembled, and aligned in 
   <span class="sc">geneious</span> v.4.8.5
   <a ref-type="bibr" rid="b59" href="#b59">59</a>. All sequences were deposited in GenBank (see 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Table S2</a> for accession numbers).
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">The AFLP protocol followed the procedure described by Vos 
   <span class="italic">et al</span>.
   <a ref-type="bibr" rid="b60" href="#b60">60</a>, with minor modifications that included the use of fluorescent-dye-labeled primers (Applied Biosystems, Foster City, California, USA) for selective amplification in multiplex analysis. Selective primer pairs were initially screened on 50 individuals from 25 populations. Of the 64 primer pair combinations tested, nine pairs that gave the best results with respect to polymorphism and clarity of AFLP profiles (
   <a ref-type="supplementary-material" rid="S1" href="#S1">Table S3</a>) were chosen for the full survey (further details in 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Method S2</a>). We also performed four separate test runs with 15 individuals and each chosen primer combination. These test runs confirmed that AFLP fragments were reproducible, resulting in an average error rate of 0.21% (±0.07) per fragment (see also Knowles &amp; Richards
   <a ref-type="bibr" rid="b61" href="#b61">61</a>). The AFLP data matrix is available in 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Dataset</a>.
  </p>
 </sec>
 <sec disp-level="2" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Phylogeographical and population genetic data analyses</div>
  <p xmlns="http://www.w3.org/1999/xhtml">For both cpDNA and ITS, haplotype (
   <span class="italic">h</span>) and nucleotide (
   <span class="italic">π</span>) diversities were calculated for each population and the species overall using 
   <span class="sc">dnasp</span> v.5.10
   <a ref-type="bibr" rid="b62" href="#b62">62</a>. Genealogical relationships of the haplotypes identified were inferred from a 95% statistical parsimony network constructed in 
   <span class="sc">tcs</span> v.1.21
   <a ref-type="bibr" rid="b63" href="#b63">63</a>, with gaps (indels) coded as substitutions (A or T). For cpDNA, the permutation test implemented in 
   <span class="sc">permut</span> was employed to compare parameters of population differentiation with unordered and ordered alleles (
   <span class="italic">G</span>
   <sub>ST</sub> and 
   <span class="italic">N</span>
   <sub>ST</sub>, respectively) based on 1000 random permutations
   <a ref-type="bibr" rid="b64" href="#b64">64</a>. Spatial analysis of molecular variance (SAMOVA), as implemented in 
   <span class="sc">samova</span> v.1.0
   <a ref-type="bibr" rid="b65" href="#b65">65</a>, was used to identify regional groups of populations that are geographically homogeneous and maximally differentiated from each other. For cpDNA data, isolation by distance (IBD) effects
   <a ref-type="bibr" rid="b21" href="#b21">21</a> were assessed by regressions of 
   <span class="italic">F</span>
   <sub>ST</sub>/(1 − 
   <span class="italic">F</span>
   <sub>ST</sub>) against the logarithm (log
   <sub>10</sub>) of geographic distance for all pairs of populations, or subsets thereof, following Rousset
   <a ref-type="bibr" rid="b66" href="#b66">66</a>.
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">For the AFLP dataset, we calculated the total number of AFLP fragments per population (
   <span class="italic">F</span>
   <sub>T</sub>), the percentage of fragments that are polymorphic within each population (
   <span class="italic">PPF</span>), Nei’s (1973) gene diversity (
   <span class="italic">H</span>
   <sub>E</sub>), and Shannon’s information index 
   <span class="italic">I</span> following the method of Lynch &amp; Milligan
   <a ref-type="bibr" rid="b67" href="#b67">67</a> using 
   <span class="sc">aflpsurv</span> v.1.0
   <a ref-type="bibr" rid="b68" href="#b68">68</a>. In addition, ‘frequency-down-weighted-marker values’ (
   <span class="italic">DW</span>; according to Schönswetter &amp; Tribsch
   <a ref-type="bibr" rid="b69" href="#b69">69</a>), were calculated for each population. To infer the most likely number of population genetic clusters (
   <span class="italic">K</span>) in the AFLP dataset, we used three approaches. First, we used 
   <span class="sc">baps</span> v.6.0
   <a ref-type="bibr" rid="b70" href="#b70">70</a> to detect clusters of genetically similar populations and to estimate individual coefficients of ancestry (
   <span class="italic">q</span>) with regard to the detected clusters. Second, we utilized 
   <span class="sc">genalex</span> v.6.4
   <a ref-type="bibr" rid="b71" href="#b71">71</a> to run a principal coordinates analysis (PCoA), which non-hierarchically grouped the samples without prior knowledge of their source location. Third, we constructed an unrooted neighbour-joining (NJ) tree using the 
   <span class="sc">phylip</span> package 3.6 with 1000 bootstraps (see 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Method S3</a> for more details). To quantify variation in cpDNA sequences and AFLPs among populations and genetic clusters (as identified by SAMOVA), we performed analyses of molecular variance (AMOVAs) in 
   <span class="sc">arlequin</span> v.3.5
   <a ref-type="bibr" rid="b72" href="#b72">72</a> using 
   <span class="italic">Φ</span>- statistics, respectively. The significance of fixation indices was tested using 10,000 permutations
   <a ref-type="bibr" rid="b73" href="#b73">73</a>.
  </p>
 </sec>
 <sec disp-level="2" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Divergence time estimation and demographic analyses based on cpDNA sequences</div>
  <p xmlns="http://www.w3.org/1999/xhtml">To relate differentiation among cpDNA haplotypes of 
   <span class="italic">E. henryi</span> to pre-Quaternary and Quaternary events, we estimated divergence time under a Bayesian approach as implemented in 
   <span class="sc">beast</span> v.1.8.0
   <a ref-type="bibr" rid="b74" href="#b74">74</a>. We estimated the divergence time using an unlinked substitution model (
   <span class="italic">psb</span>A–
   <span class="italic">trn</span>H: HKY; 
   <span class="italic">trn</span>L–
   <span class="italic">trn</span>F: HKY; 
   <span class="italic">trn</span>T–
   <span class="italic">trn</span>L: GTR+I) selected by 
   <span class="sc">jmodeltest</span> v.
   <span class="sc">2.0</span>
   <a ref-type="bibr" rid="b75" href="#b75">75</a>. Given the intraspecific nature of our data, an uncorrelated lognormal distributed relaxed clock (
   <span class="sc">ucld</span>) model, and a coalescent model assuming constant population size were used to model the tree prior. Since no reliable fossils of 
   <span class="italic">E. henryi</span> are currently known (see Introduction), we used the divergence time between 
   <span class="italic">E. henryi</span> and 
   <span class="italic">P. bracteata</span>, inferred from a fossil-calibrated cpDNA phylogeny of Rubiaceae, as a secondary calibration point to calibrate the stem node of 
   <span class="italic">E. henryi</span>
   <a ref-type="bibr" rid="b33" href="#b33">33</a> (node 1 in 
   <a ref-type="fig" rid="f1" href="#f1">Fig. 1B</a>: mean = 21.77 Ma; SD = 5.0 Ma; 95% CI = 7.92–33.64 Ma). For divergence time estimations, the Markov chain Monte Carlo (MCMC) was run for three independent 50 million generation chains, sampling from the chain every 5000 generations. The output was visualized using 
   <span class="sc">tracer</span> v.1.5 (
   <span ext-link-type="uri" xlink:href="http://tree.bio.ed.ac.uk/software/tracer/" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">http://tree.bio.ed.ac.uk/software/tracer/</span>) to ensure that parameter values were fluctuating at stable levels. Based on these results, the first 5000 trees were discarded as burn-in, and the remaining samples were summarized as a maximum clade credibility (MCC) tree with mean divergence times and 95% highest posterior density (HPD) intervals of age estimates in 
   <span class="sc">treeannotator</span> v.1.8.0
   <a ref-type="bibr" rid="b76" href="#b76">76</a>. Finally, these results were summarized in a single tree visualized in 
   <span class="sc">figtree</span> v.1.3.1 (
   <span ext-link-type="uri" xlink:href="http://tree.bio.ed.ac.uk/software/figtree/" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">http://tree.bio.ed.ac.uk/software/figtree/</span>).
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">Tajima’s 
   <span class="italic">D</span>
   <a ref-type="bibr" rid="b77" href="#b77">77</a> and Fu’s 
   <span class="italic">F</span>
   <sub>S</sub>
   <a ref-type="bibr" rid="b78" href="#b78">78</a> neutrality tests were used to assess population demographic history. We also used 
   <span class="sc">arlequin</span> to infer the demographic history of two main lineages identified (‘Northern’ vs. ’Southern’; see the Results Section) from their combined cpDNA-IGS sequences by mismatch distribution analysis (MDA) (further details in 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Method S4</a>).
  </p>
 </sec>
 <sec disp-level="2" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Present, past and future distribution modelling</div>
  <p xmlns="http://www.w3.org/1999/xhtml">Assuming 
   <span class="italic">E. henryi</span> has not changed (and will not change) its climatic preference over at least the last glacial/interglacial cycle and into the future
   <a ref-type="bibr" rid="b79" href="#b79">79</a>, we reconstructed ENMs to determine the potential distribution of 
   <span class="italic">E. henryi</span> across its range under present (1950
   <span class="italic">–</span>2000), past [the Last Glacial Maximum (LGM, 
   <span class="italic">c</span>. 21 kya)
   <a ref-type="bibr" rid="b80" href="#b80">80</a>
   <a ref-type="bibr" rid="b81" href="#b81">81</a> and the Last Interglacial (LIG, 
   <span class="italic">c</span>. 130–114 kya)
   <a ref-type="bibr" rid="b82" href="#b82">82</a>] and future (2080) climatic conditions using the maximum entropy method implemented in 
   <span class="sc">maxent</span> v.3.2.1. In addition to the 38 distribution records included in this study, 76 herbarium-recorded presences were sourced from the Chinese Virtual Herbarium (
   <span ext-link-type="uri" xlink:href="http://www.cvh.org.cn" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">www.cvh.org.cn</span>) and the National Specimen Information Infrastructure of China (
   <span ext-link-type="uri" xlink:href="http://www.nsii.org.cn" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">www.nsii.org.cn</span>). Based on a total of 114 records, a current distribution model was developed using six bioclimatic data layers (annual mean temperature, annual precipitation, precipitation of wettest, driest, warmest and coldest quarter) available from the WorldClim database (
   <span ext-link-type="uri" xlink:href="http://www.worldclim.org" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">www.worldclim.org</span>)
   <a ref-type="bibr" rid="b83" href="#b83">83</a> at 2.5 arc-min resolution for the present (1950–2000), assumed to be important for temperate species in East Asia
   <a ref-type="bibr" rid="b39" href="#b39">39</a>
   <a ref-type="bibr" rid="b49" href="#b49">49</a>. This restricted dataset was used to avoid including highly correlated variables (data not shown), and thus to prevent potential over-fitting
   <a ref-type="bibr" rid="b84" href="#b84">84</a>. The established model was then projected onto the set of climatic variables simulated by the Model for Interdisciplinary Research on Climate (MIROC)
   <a ref-type="bibr" rid="b85" href="#b85">85</a> to infer the extent of suitable habitat during the LGM and the LIG (see above). Future projections for 2080 were performed based on the Canadian Centre for Climate Modelling and Analysis model (CCCMA-CGCM31) under the A2 scenario that were provided by the CIAT downscaled GCM Data Portal (
   <span ext-link-type="uri" xlink:href="http://gisweb.ciat.cgiar.org/GCMPage/" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">http://gisweb.ciat.cgiar.org/GCMPage/</span>) with 30 arc-second resolution.
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">Model performance was evaluated using receiver operating characteristic (ROC) analyses in 
   <span class="sc">maxent</span>. Values of the area under the ROC curve (AUC) between 0.7 and 0.9 indicate good fit
   <a ref-type="bibr" rid="b86" href="#b86">86</a>. We modelled the modern distribution 10 times, using different subsets of 70% of the localities to train the model and 30% to test the model, and visually compared AUC scores and jackknife tests of variable importance to assess consistency between runs.
  </p>
 </sec>
 <sec disp-level="2" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">IBD and IBE analyses</div>
  <p xmlns="http://www.w3.org/1999/xhtml">To quantify the roles of geography and ecology in spatial genetic divergence, we quantified isolation by distance (IBD)
   <a ref-type="bibr" rid="b21" href="#b21">21</a> and isolation by environment (IBE)
   <a ref-type="bibr" rid="b87" href="#b87">87</a> using our AFLP dataset, because multi-locus datasets with highly variable markers are ideal for this purpose
   <a ref-type="bibr" rid="b5" href="#b5">5</a>
   <a ref-type="bibr" rid="b88" href="#b88">88</a>
   <a ref-type="bibr" rid="b89" href="#b89">89</a>. We computed population pairwise genetic distances (
   <span class="italic">F</span>
   <sub>ST</sub>) with 
   <span class="sc">arlequin</span> using all putatively neutral (non-outlier) AFLP loci (i.e. 451 loci) described above. We obtained a total of 21 environmental and geographical variables for our study area, including 19 bioclimatic variables with 30 arc-second resolution (
   <span ext-link-type="uri" xlink:href="http://www.bioclim.org" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">http://www.bioclim.org</span>), a slope layer based on a digital elevation model with 1-km resolution from the USGS EROS database (
   <span ext-link-type="uri" xlink:href="http://eros.usgs.gov" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">http://eros.usgs.gov</span>), and soil type from the Chinese soil taxonomy record
   <a ref-type="bibr" rid="b90" href="#b90">90</a>. We used resistance-based distances, to reflect biological connectivity between populations, instead of direct geographical distances
   <a ref-type="bibr" rid="b89" href="#b89">89</a> (see 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Method S5</a> for more details).
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">We then employed two related methods to quantify IBD and IBE: multiple matrix regression with randomization (MMRR)
   <a ref-type="bibr" rid="b88" href="#b88">88</a> and structural equation modelling (SEM)
   <a ref-type="bibr" rid="b89" href="#b89">89</a>. Both methods use a series of regression-based analyses to quantify the effects of multiple explanatory variables on a single response variable, in this case genetic distance (
   <span class="italic">F</span>
   <sub>ST</sub>). MMRR provides a straightforward method for estimating linear regressions among distance matrices, while SEM allows for flexibility in defining the relationships among variables and utilizes latent variable modelling. For the MMRR analysis, we constructed an environmental distance matrix by taking the population pairwise Euclidian distances across all 21 environmental variables. We then analyzed the effects of environmental distance and geographic distance, as explanatory variables, on genetic distance, as the response variable, using the ‘MMRR’ function in R
   <a ref-type="bibr" rid="b88" href="#b88">88</a> with 10,000 permutations. For the SEM analysis, we used all 21 environmental variables to construct an environmental distance latent variable, and then quantified the relationships between environmental distance, geographic distance, and genetic distance using the ‘lavaan’ package in R (
   <span ext-link-type="uri" xlink:href="http://cran.r-project.org/web/packages/lavaan/" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">http://cran.r-project.org/web/packages/lavaan/</span>). Prior to analysis, all environmental, geographic, and genetic distance matrices were standardized. In each case, the analysis was used to test three alternative hypotheses: (1) only geographical distance contributes significantly to genetic distance, (2) only environmental distance contributes significantly to genetic distance, and (3) geographical distance and environmental distance each contribute significantly to genetic distance. We performed both analyses on AFLP pairwise genetic distances (
   <span class="italic">F</span>
   <sub>ST</sub>) for all populations.
  </p>
 </sec>
 <sec disp-level="2" class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Potential AFLP loci under selection: detection of outlier loci and associations between allele frequencies and environmental variables</div>
  <p xmlns="http://www.w3.org/1999/xhtml">Two different basic approaches allow screening for AFLP loci that are putatively under selection: (i) a genome scan test procedure based on 
   <span class="italic">F</span>
   <sub>ST</sub> comparisons to identify the loci that are significantly different than expected under neutrality and a given demographic model; and (ii) correlative methods that look for associations between genetic variation and environmental variables. The key to using these approaches together is that they identify links between putative loci under selection and individual environmental variables. Hence, our primary purpose for using these tests was to identify the specific environmental variables that are potential drivers of genetic differentiation via divergent natural selection (e.g. IBE resulting from selection in divergent environments).
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">For the genome scan test, both the 
   <span class="sc">fdist</span>
   <a ref-type="bibr" rid="b91" href="#b91">91</a> and 
   <span class="sc">bayescan</span>
   <a ref-type="bibr" rid="b92" href="#b92">92</a> approaches were implemented on 457 polymorphic AFLP loci using the nine genetic clusters defined in the 
   <span class="sc">baps</span> analysis (
   <span class="italic">K</span> = 9). Then, to detect associations between allele frequencies and environmental variables, we used Multiple Linear Regression (MLR)
   <a ref-type="bibr" rid="b93" href="#b93">93</a> in R v.3.1.1 (R Development Core Team 2011) to identify potential adaptive loci that are under selection from current environmental factors. For outlier loci confirmed by both 
   <span class="sc">fdist</span> and 
   <span class="sc">bayescan</span>, we computed their population pairwise frequencies of AFLP alleles at the 37 sampling sites. We extracted values for the geographical coordinates of each population from 19 bioclimatic GIS data layers with 30 arc-second resolution (1950–2000; 
   <span ext-link-type="uri" xlink:href="http://www.bioclim.org" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">http://www.bioclim.org</span>). We then regressed the allele frequencies of the retained outlier loci (dependent variables) on the selected environmental variables (explanatory variables; standardized) using the MLR model (see 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Table S4</a> for the retained allele frequencies and the selected environmental variables). Potential adaptive loci were identified as 
   <div id="d33e1610" class="inline-formula">
    <span id="d33e1611" xlink:href="srep24041-m2.jpg" class="inline-graphic" xmlns:xlink="http://www.w3.org/1999/xlink"/>
   </div> &gt; 0.5 and significantly correlated to at least one explanatory variable
   <a ref-type="bibr" rid="b13" href="#b13">13</a>. Univariate regressions were then conducted for each variable individually to estimate its significance (see 
   <a ref-type="supplementary-material" rid="S1" href="#S1">Supplementary Method S6</a> for more details).
  </p>
 </sec>
</sec>
