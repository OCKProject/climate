<?xml version="1.0" encoding="UTF-8"?>
<sec disp-level="2" class="sec">
 <div class="title" xmlns="http://www.w3.org/1999/xhtml">Sequence alignment and genotyping</div>
 <p xmlns="http://www.w3.org/1999/xhtml">Data processing was performed using the following workflow: (i) 
  <span class="italic">Sequence demultiplexing.</span> Read quality assessment was made in FastQC (
  <span ext-link-type="uri" xlink:href="http://www.bioinformatics.babraham.ac.uk/projects/fastqc/" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">http://www.bioinformatics.babraham.ac.uk/projects/fastqc/</span>). Samples were de-multiplexed according to in-line barcodes using Stacks v1.20 (ref. 
  <a ref-type="bibr" rid="b44" href="#b44">44</a>), low-quality reads were discarded and sequences trimmed to 95 bp. (ii) 
  <span class="italic">Read mapping and filtering</span>. Demultiplexed fastq files were mapped to the published contigs of the Emperor penguin genome
  <a ref-type="bibr" rid="b45" href="#b45">45</a> using Bowtie2 2.2.3 (ref. 
  <a ref-type="bibr" rid="b46" href="#b46">46</a>), with standard settings, allowing only end-to-end mapping. Resulting SAM files were filtered using Samtools 0.1.19 (ref. 
  <a ref-type="bibr" rid="b47" href="#b47">47</a>), PicardTools 1.113 (
  <span ext-link-type="uri" xlink:href="http://picard.sorceforge.net" class="ext-link" xmlns:xlink="http://www.w3.org/1999/xlink">http://picard.sorceforge.net</span>), and custom R and shell scripts in order to discard unpaired reads and full read pairs where at least one mate has a mapping quality score below 30. The resulting BAM files were then filtered for PCR and optical duplicates by comparing mapping position and CIGAR string, using Picard MarkDuplicates. This process also allowed to filter out most sequencing errors, as MarkDuplicates only retains the read with the highest average Phred score in each duplicate cluster. (iii) 
  <span class="italic">SNP calling and genotyping</span>. Three independent algorithms were used for SNP and genotype calling, all of them built on a maximum-likelihood framework. (i) First-in-pair reads were exported as BAM files for the maximum-likelihood-based genotype caller built in the Stacks pipeline (ref_map.pl), with a maximum of five mismatches allowed between alleles at a single locus (both within and between individuals), correcting genotype calls using the information from the whole data set in the rxstacks programme. (ii) We used the same cleaned BAM files to simultaneously call both mismatch and indel polymorphisms in all samples using the GATK HaplotypeCaller pipeline
  <a ref-type="bibr" rid="b48" href="#b48">48</a>, with standard parameters, except for population heterozygosity which was set to 0.01. (iii) ANGSD 0.900 (ref. 
  <a ref-type="bibr" rid="b49" href="#b49">49</a>) was used to call SNPs and genotypes using a maximum-likelihood process with the Samtools mpileup/bcftools algorithm, using the complete sample allele frequency information as a prior. Genotype calls were only retained for comparison purposes with Stacks and GATK, however, downstream analysis was performed directly on raw genotype likelihoods, as this approach has been shown to be much more sensitive to weak structure than classical SNP-calling analysis
  <a ref-type="bibr" rid="b50" href="#b50">50</a>. Genotype calls from all three processes were formatted into VCF format using software-specific (Stacks and GATK) or custom scripts (ANGSD); further filtering and manipulation were done using VCFtools 0.1.12 (ref. 
  <a ref-type="bibr" rid="b51" href="#b51">51</a>). For analyses relying on SNP calls, an additional filtering step was performed by (i) extracting the list of consensus loci called as SNPs by all three independent algorithms, (ii) discarding genotypes with a coverage under 3 × for analyses sensitive to sequencing depth, (iii) removing loci genotyped in less than 75% of all individuals, and finally (iv) thinning down loci to keep only polymorphism distant of at least 1 kb, in order to minimize linkage between markers. (iv) 
  <span class="italic">Sex-linked marker analysis</span>. To check for sex-specific dispersal or structure patterns, we repeated analyses for each sex separately, using either autosomal loci only or Z-linked loci only. We used the published genome annotations for bird gametologs
  <a ref-type="bibr" rid="b52" href="#b52">52</a> to identify potentially Z-linked scaffolds. As females are heterogametic in birds, we expect non pseudo-autosomal Z-linked regions to be fully homozygous in females, but to be neutrally heterozygous in males. We therefore retained only scaffolds that had a clearly bimodal distribution of heterozygosity, with one mode at or close to 0 (a slight tolerance was allowed to account for misalignment, sequencing errors mistyped as SNPs due to low coverage, or the presence of a transposable elements with autosomal homologues). Fifteen scaffolds were ultimately retained. Scaffolds containing candidate Z-linked coding DNA sequences, but with no visible bimodal heterozygosity distribution, were excluded altogether from the analysis. Sex assignment was performed independently from each of the non-recombining Z scaffolds, and consistency of sex calls between scaffolds was checked manually.
 </p>
</sec>
