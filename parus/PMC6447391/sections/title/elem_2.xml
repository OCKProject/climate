<?xml version="1.0" encoding="UTF-8"?>
<sec class="sec">
 <div class="title" xmlns="http://www.w3.org/1999/xhtml">Materials and Methods</div>
 <sec class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Experimental Design</div>
  <p xmlns="http://www.w3.org/1999/xhtml">This study included samples (see “Blood sample collection”) from female great tits that are part of a large-scale experiment where females are artificially selected for early or late reproduction using genomic selection. The experimental design for this artificial selection experiment is described in more detail in Verhagen I, Gienapp P, Laine VN, Mateman AC, van Oers K, Visser ME (unpublished data). In short, offspring (F1) from a wild parental generation (P) from the Hoge Veluwe (the Netherlands) with either early (early line) or late (late line) lay dates were collected and genotyped with a 650k single nucleotide polymorphism (SNP) chip to calculate genomic estimated breeding values (GEBVs), the value of an individual in the breeding scheme based on the estimated genomic marker (i.e., SNPs) effects throughout the genome (see Verhagen I, Gienapp P, Laine VN, Mateman AC, van Oers K, Visser ME unpublished data; Gienapp P, Calus MPL, Laine VN, Visser ME, unpublished data, for details). Based on their GEBVs, birds were selected within the early or late reproducing selection line in such a way that birds with the most extreme GEBVs were housed in pairs in outdoor aviaries to generate the F1-generation. Birds from the F1-generation, in their turn, were genotyped and selected for extreme GEBVs within the two selection lines to produce the F2-generation. From these F2 birds, pairs were put in climate-controlled aviaries and subjected to two contrasting temperature treatments from January until July. The two temperature treatments mimicked a cold and warm year in the Netherlands using observed temperatures from the year 2013 and 2014, respectively (see Verhagen I, Laine VN, Mateman AC, Pijl A, de Wit R, van Lith B, Kamphuis W, Viitaniemi HM, Williams TD, Caro SP, Meddle SL, Gienapp P, van Oers K &amp; Visser ME (unpublished data)). Photoperiod changed daily following the natural photoperiod. Aviaries were provided with three nest boxes and from March onward, nesting material was provided.</p>
 </sec>
 <sec class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Blood Sample Collection</div>
  <p xmlns="http://www.w3.org/1999/xhtml">A detailed blood sampling scheme is described in Mäkinen et al. (forthcoming) but briefly, birds were divided in two sampling groups representing both temperature treatments and selection lines (see above). Blood was sampled every other week from each individual between January and July. Every pair was sampled within 10 min after capture and then put back in their climate-controlled aviary. During a sampling day, birds (
   <span class="italic">n</span> = 36) were sampled between 8:30 AM and 14:30 PM. Individual birds were randomized by treatment and line to three sampling groups and individuals were sampled around the same time of day every time they were blood sampled. Red blood cells were separated from plasma by centrifuging at 14,000 rpm for 10 min and were stored in Queens buffer at room temperature until being processed. This treatment is sufficient to enrich the sample for red blood cells as the ratio between white to red blood cells in a whole blood sample is normally 1:800 (
   <a rid="evz044-B74" ref-type="bibr" href="#evz044-B74">Vinkler et al. 2010</a>). For the analysis, four time points were chosen based on realized first egg lay dates of the females as described in Mäkinen et al. (forthcoming): 1) the day when day light length &gt;12 h (time point 1), 2) the day when 25% of the females from the warm environment had initiated laying (time point 2), 3) the day when 25% and 50% of the females from the cold and warm environment respectively had initiated laying (time point 3), and 4) the day when 50% of the females from the cold treatment had initiated laying. As our chosen time points did not always coincide with the days of blood sampling scheme, we chose blood samples that were sampled closest to (±7 days) the four chosen time points. This resulted in a total of 63 samples, because we were unable to take one blood sample for time point 4, because one female (warm treatment) was incubating her eggs during the sampling.
  </p>
 </sec>
 <sec class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Sample Processing for Reduced Representation Bisulfite Sequencing</div>
  <p xmlns="http://www.w3.org/1999/xhtml">The detailed description of the sample processing can be found in Mäkinen et al. (forthcoming). In short, DNA was extracted from red blood cell samples using FavorPrepT M 96-well Genomic DNA Kit (Favorgen). Quantity and quality of the extraction was assessed with Nanodrop 2000 (Agilent Biotechnologies) and by gel electrophoresis by running the samples on a 1% agarose gel. Library preparation and sequencing were done at Roy J. Carver Biotechnology Center, University of Illinois at Urbana-Champaign, USA. Samples were individually barcoded and pooled together in four pools of 16 samples, thereby randomizing individuals, sampling days, and treatments for each pool. To obtain enough coverage, each pool was sequenced on two lanes for 100-bp single-end. To avoid effects due to difference in flow cells, the four pools, which were all ran twice, were ran on the same flow cell.</p>
  <p xmlns="http://www.w3.org/1999/xhtml">The control and bisulfite-treated libraries were prepared with the Hyper Library Construction kit from Kapa Biosystems, according to the “Reduced Representation Bisulfite Sequencing For Methylation Analysis” protocol (Illumina). Briefly, samples were digested with MspI, which generates CCGG overhangs, prior to bisulfite treatment and library building. The libraries were size selected for fragments of 20–200 bp in length. The libraries were quantified by quantitative PCR and pools were sequenced on a HiSeq2500 using a HiSeq SBS sequencing kit version 4 (Illumina). All pools were sequenced on the same flow cells. Fastq files were generated and demultiplexed with the bcl2fastq v2.17.1.14 Conversion Software (Illumina). Lanes were spiked with PhiX to provide nucleotide diversity and to measure bisulfite conversion success. PhiX reads were subsequently removed from the data set. Adaptors and individual barcodes were also trimmed from the reads. All the reduced representation bisulfite sequencing (RRBS) samples are deposited in Short Read Archive under Biosample accession SAMN07692587 and are described in detail in Mäkinen et al. (forthcoming).</p>
 </sec>
 <sec class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Sequence Alignment and CpG Site Identification</div>
  <p xmlns="http://www.w3.org/1999/xhtml">The sequence processing and alignment has been described in detail in Mäkinen et al. (forthcoming) . In short, prior to alignment, the obtained sequences were adaptively trimmed and quality filtered to a minimum of 20 bp and a quality of 25 using Trim Galore! 0.4.2. Genome alignment and methylation site identification were performed with Bismark v0.16.3 using Bowtie2 v2.2.3 in the alignment step. Reads were aligned against the Parus_major1.1 genome (NCBI) using single-end mode and default settings in Bismark (
   <span class="italic">L</span> = 20 and 
   <span class="italic">N</span> = 0). CpG sites were then identified from each sample; a site was accepted for downstream analysis when it had a minimum coverage of 10× and when it was identified across all samples. In total, the final data set for downstream analysis consisted of 522,645 CpG sites (
   <a ref-type="supplementary-material" rid="sup1" href="#sup1">supplementary table S2</a>, 
   <a ref-type="supplementary-material" rid="sup1" href="#sup1">Supplementary Material</a> online).
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">We first performed hierarchical clustering on the final data set as well as for a reduced data set with only unrelated individuals using the “cluster” (
   <a rid="evz044-B37" ref-type="bibr" href="#evz044-B37">Maechler et al. 2016</a>) and “factoextra” (
   <a rid="evz044-B22" ref-type="bibr" href="#evz044-B22">Kassambara and Mundt 2017</a>) packages in R. The distance method used was Euclidian and the clustering method Ward.D2. We also calculated mean methylation values over the 522,645 CpG sites for the whole data set, and for each time point, each individual and for both treatments separately.
  </p>
 </sec>
 <sec class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Methylation Patterns over Time</div>
  <p xmlns="http://www.w3.org/1999/xhtml">To examine temporal changes in DNA methylation across the four time points, we used GPrank (
   <a rid="evz044-B69" ref-type="bibr" href="#evz044-B69">Topa and Honkela 2018</a>). GPrank uses Gaussian process modeling to rank and identify temporal patterns and has previously been applied to both temporal transcriptome data (
   <a rid="evz044-B68" ref-type="bibr" href="#evz044-B68">Topa and Honkela 2016</a>) as well as temporal genotype data (
   <a rid="evz044-B70" ref-type="bibr" href="#evz044-B70">Topa et al. 2015</a>). By utilizing beta-binomial Gaussian process regression in a Bayesian framework, this allows for modeling any form of temporal variation in DNA methylation (linear as well as highly nonlinear dynamics) and is therefore well suited and frequently used to analyze data from sequencing-based genetic time series.
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">Our main interest was to detect changes in DNA methylation across the breeding season and between the two contrasting temperature treatments. In GPrank, the effect of time is modeled using a Gaussian process (
   <a rid="evz044-B52" ref-type="bibr" href="#evz044-B52">Rasmussen and Williams 2006</a>). For each CpG site, we fitted a time-independent model without a temporal change (model 0, i.e., null model) and two different time-dependent models, allowing for a temporal change in DNA methylation (model 1 and model 2; see below). Both the time-independent and time-dependent models included a fixed variance component from the beta-binomial model that captures the uncertainty due to finite sequencing depth (
   <a rid="evz044-B70" ref-type="bibr" href="#evz044-B70">Topa et al. 2015</a>), and an additive white noise, which represents random background noise. In the time-dependent models (model 1 and model 2), methylation levels are allowed to change between sampling time points, which was modeled using a squared exponential covariance in the Gaussian process: it tests correlation between two data points to estimate length scale and amplitude in the data (i.e., how fast the change is in time) to improve point estimate fit with the Gaussian process function. In the time-dependent model 2, we additionally allowed for differences between treatment groups in the pattern of temporal change (compared with model 1) by allowing the treatment groups to have separate time-dependent components and thereby capture possible treatment-specific temporal trajectories. We made comparisons between model 1 and model 0 to test for time dependence and between model 2 and model 0 to test for time dependence with treatment-specific trajectories and between model 2 and model 1 to test for treatment-specific trajectories of the time-dependent sites. Thus, sites were classified as time independent, time dependent, or as time dependent with treatment-specific trajectories (
   <a rid="evz044-T1" ref-type="table" href="#evz044-T1">table 1</a>). All three model comparisons were run separately for each CpG site and we selected the best fitting model based on the log-Bayes factor values (log BF), using log BF ≥ 3 which in the log-Bayes factor scale is considered as positive evidence in favor of the alternative model (
   <a rid="evz044-B51" ref-type="bibr" href="#evz044-B51">Raftery and Kass 1995</a>). We also clustered the data set using only time-dependent sites (without or with treatment effect). 
   <div id="evz044-T1" orientation="portrait" position="float" class="table-wrap">
    <span class="label">Table 1</span>
    <div class="caption">
     <p>Model Selection Criteria and Classification of CpG Sites</p>
    </div>
    <table frame="hsides" rules="groups">
     <colgroup span="1">
      <col valign="top" align="left" span="1"/>
      <col valign="top" align="left" span="1"/>
     </colgroup>
     <thead>
      <tr>
       <th rowspan="1" colspan="1">Model Comparison Criteria</th>
       <th rowspan="1" colspan="1">Classification of CpG Site</th>
      </tr>
     </thead>
     <tbody>
      <tr>
       <td rowspan="1" colspan="1">
        <div list-type="simple" class="list">
         <div class="list-item">
          <p>Model 1–Model 0 &lt; 3</p>
         </div>
         <div class="list-item">
          <p>Model 2–Model 0 &lt; 3</p>
         </div>
         <div class="list-item">
          <p>Model 2–Model 1 &lt; 3</p>
         </div>
        </div>
       </td>
       <td rowspan="1" colspan="1">Time independent</td>
      </tr>
      <tr>
       <td rowspan="1" colspan="1">
        <div list-type="simple" class="list">
         <div class="list-item">
          <p>Model 1–Model 0 &gt; 3</p>
         </div>
         <div class="list-item">
          <p>Model 2–Model 0 &lt; / &gt; 3</p>
         </div>
         <div class="list-item">
          <p>Model 2–Model 1 &lt; 3</p>
         </div>
        </div>
       </td>
       <td rowspan="1" colspan="1">Time dependent</td>
      </tr>
      <tr>
       <td rowspan="1" colspan="1">
        <div list-type="simple" class="list">
         <div class="list-item">
          <p>Model 1–Model 0 &lt; 3</p>
         </div>
         <div class="list-item">
          <p>Model 2–Model 0 &gt; 3</p>
         </div>
         <div class="list-item">
          <p>Model 2–Model 1 &gt; 3</p>
         </div>
        </div>
       </td>
       <td rowspan="1" colspan="1">Time dependent with treatment</td>
      </tr>
     </tbody>
    </table>
    <div class="table-wrap-foot">
     <fn id="tblfn1" class="fn" xmlns="">
      <p xmlns="http://www.w3.org/1999/xhtml">
       <span class="sc">Note</span>.—Left-hand side describes the criteria for the model comparisons, based on log BF, which needed to be fulfilled for a CpG site to be classified as time independent, time dependent, or time dependent with treatment (right-hand side).
      </p>
     </fn>
    </div>
   </div>
  </p>
  <p xmlns="http://www.w3.org/1999/xhtml">Because the GP models cannot take relatedness into account, we examined 5,000 sites across the log BF range of 49–3 and identified as temporally changing based on GPrank model 1 with GLMM using R packages lme4 (
   <a rid="evz044-B3" ref-type="bibr" href="#evz044-B3">Bates et al. 2015</a>) and lme4qtl (
   <a rid="evz044-B86" ref-type="bibr" href="#evz044-B86">Ziyatdinov et al. 2017</a>). We included the IBD matrix (
   <a ref-type="supplementary-material" rid="sup1" href="#sup1">supplementary table 2</a>, 
   <a ref-type="supplementary-material" rid="sup1" href="#sup1">Supplementary Material</a> online) as a random effect in lme4qtl to control for potential differences in methylation due to shared sibship. Otherwise, both models used methylation count as the response, time point as a fixed effect and individual repeated measure was added as random effect (for both lme4 and lme4qtl). We compared the estimates between the two models for time point and intercept. As the estimates for both models, with and without controlling fore relatedness were highly congruent (
   <a ref-type="supplementary-material" rid="sup1" href="#sup1">supplementary fig. S1</a>, 
   <a ref-type="supplementary-material" rid="sup1" href="#sup1">Supplementary Material</a> online), we conclude that relatedness per se did not influence our analysis when looking at temporal change in DNA methylation patterns. Ideally however, the analyses would be done in a GP model where both relatedness and the repeated measures structure of the data could be considered.
  </p>
 </sec>
 <sec class="sec">
  <div class="title" xmlns="http://www.w3.org/1999/xhtml">Genomic Locations and Gene Annotation</div>
  <p xmlns="http://www.w3.org/1999/xhtml">Genomic locations of identified CpG sites were annotated using the Great tit genome v1.1 (NCBI). We divided the sites into whether they were located in exons, introns, TSS regions (defined as the region spanning 300-bp upstream and 50-bp downstream of the annotated gene start), or promoters (defined as the region 3 kb upstream of gene start excluding the TSS) using the R packages “GenomicFeatures” (
   <a rid="evz044-B29" ref-type="bibr" href="#evz044-B29">Lawrence et al. 2013</a>) and “rtracklayer” (
   <a rid="evz044-B28" ref-type="bibr" href="#evz044-B28">Lawrence et al. 2009</a>). CpG islands were identified from the great tit genome using CpGplot v EMBOSS: 6.6.0.0 (Alan Bleasby, European Bioinformatics Institute, Wellcome Trust Genome Campus, Hinxton, Cambridge CB10 1SD, UK) using default settings: window size 100, minimum island length 200, minimum observed/expected 0.6, minimum percentage 50. Overlap between identified CpG sites and specified regions, was obtained with BEDtools v.2.26.0. (
   <a rid="evz044-B50" ref-type="bibr" href="#evz044-B50">Quinlan and Hall 2010</a>) and the sites were assigned to their specific genomic regions. We used the annotation from genomic locations (promoter, TSS, and within gene body as defined above) for assigning the CpG sites to genes for functional analysis, which was done using Cytoscape plugin ClueGo (
   <a rid="evz044-B6" ref-type="bibr" href="#evz044-B6">Bindea et al. 2009</a>) with chicken (EBI-Quick 31.1.2018) annotation. ClueGo identifies functional groups of genes based on Gene Ontology (GO) terms and enrichment analysis. As the reference set in the functional analysis and enrichment analysis, we used all genes for which at least one CpG site used in the GPrank analysis was associated with. We determined these genes based on the intersections of the CpG sites and the genomic locations described above (i.e., promoter, TSS, intron, and exon of a gene). To account for nonindependence of CpG sites (i.e., genes having many sites and sites supported by different models), genes were categorized to be time dependent or time dependent with treatment-specific trajectories based on what the CpG site with the highest ranking log BF value associated with the gene was classified to be. For a gene to be categorized as time independent, all CpG sites associated with that gene, regardless of the genomic region, had to be classified as time independent.
  </p>
 </sec>
</sec>
